/* 2014-11-26 */ !function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("Fingerprint",this,function(){"use strict";var a=function(a){var b,c;b=Array.prototype.forEach,c=Array.prototype.map,this.each=function(a,c,d){if(null!==a)if(b&&a.forEach===b)a.forEach(c,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)==={})return}else for(var g in a)if(a.hasOwnProperty(g)&&c.call(d,a[g],g,a)==={})return},this.map=function(a,b,d){var e=[];return null==a?e:c&&a.map===c?a.map(b,d):(this.each(a,function(a,c,f){e[e.length]=b.call(d,a,c,f)}),e)},"object"==typeof a?(this.hasher=a.hasher,this.screen_resolution=a.screen_resolution,this.canvas=a.canvas,this.ie_activex=a.ie_activex):"function"==typeof a&&(this.hasher=a)};return a.prototype={get:function(){var a=[];if(a.push(navigator.userAgent),a.push(navigator.language),a.push(screen.colorDepth),this.screen_resolution){var b=this.getScreenResolution();"undefined"!=typeof b&&a.push(this.getScreenResolution().join("x"))}return a.push((new Date).getTimezoneOffset()),a.push(this.hasSessionStorage()),a.push(this.hasLocalStorage()),a.push(!!window.indexedDB),a.push(document.body?typeof document.body.addBehavior:"undefined"),a.push(typeof window.openDatabase),a.push(navigator.cpuClass),a.push(navigator.platform),a.push(navigator.doNotTrack),a.push(this.getPluginsString()),this.canvas&&this.isCanvasSupported()&&a.push(this.getCanvasFingerprint()),this.hasher?this.hasher(a.join("###"),31):this.murmurhash3_32_gc(a.join("###"),31)},murmurhash3_32_gc:function(a,b){var c,d,e,f,g,h,i,j;for(c=3&a.length,d=a.length-c,e=b,g=3432918353,h=461845907,j=0;d>j;)i=255&a.charCodeAt(j)|(255&a.charCodeAt(++j))<<8|(255&a.charCodeAt(++j))<<16|(255&a.charCodeAt(++j))<<24,++j,i=(65535&i)*g+(((i>>>16)*g&65535)<<16)&4294967295,i=i<<15|i>>>17,i=(65535&i)*h+(((i>>>16)*h&65535)<<16)&4294967295,e^=i,e=e<<13|e>>>19,f=5*(65535&e)+((5*(e>>>16)&65535)<<16)&4294967295,e=(65535&f)+27492+(((f>>>16)+58964&65535)<<16);switch(i=0,c){case 3:i^=(255&a.charCodeAt(j+2))<<16;case 2:i^=(255&a.charCodeAt(j+1))<<8;case 1:i^=255&a.charCodeAt(j),i=(65535&i)*g+(((i>>>16)*g&65535)<<16)&4294967295,i=i<<15|i>>>17,i=(65535&i)*h+(((i>>>16)*h&65535)<<16)&4294967295,e^=i}return e^=a.length,e^=e>>>16,e=2246822507*(65535&e)+((2246822507*(e>>>16)&65535)<<16)&4294967295,e^=e>>>13,e=3266489909*(65535&e)+((3266489909*(e>>>16)&65535)<<16)&4294967295,e^=e>>>16,e>>>0},hasLocalStorage:function(){try{return!!window.localStorage}catch(a){return!0}},hasSessionStorage:function(){try{return!!window.sessionStorage}catch(a){return!0}},isCanvasSupported:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName?!0:"Netscape"===navigator.appName&&/Trident/.test(navigator.userAgent)?!0:!1},getPluginsString:function(){return this.isIE()&&this.ie_activex?this.getIEPluginsString():this.getRegularPluginsString()},getRegularPluginsString:function(){return this.map(navigator.plugins,function(a){var b=this.map(a,function(a){return[a.type,a.suffixes].join("~")}).join(",");return[a.name,a.description,b].join("::")},this).join(";")},getIEPluginsString:function(){if(window.ActiveXObject){var a=["ShockwaveFlash.ShockwaveFlash","AcroPDF.PDF","PDF.PdfCtrl","QuickTime.QuickTime","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","RealPlayer","SWCtl.SWCtl","WMPlayer.OCX","AgControl.AgControl","Skype.Detection"];return this.map(a,function(a){try{return new ActiveXObject(a),a}catch(b){return null}}).join(";")}return""},getScreenResolution:function(){return[screen.height,screen.width]},getCanvasFingerprint:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c="http://valve.github.io";return b.textBaseline="top",b.font="14px 'Arial'",b.textBaseline="alphabetic",b.fillStyle="#f60",b.fillRect(125,1,62,20),b.fillStyle="#069",b.fillText(c,2,15),b.fillStyle="rgba(102, 204, 0, 0.7)",b.fillText(c,4,17),a.toDataURL()}},a}),function(a,b,c,d){function e(d,e,f){var g=this;if(this._pluginName=f,this.element=a(d).addClass("ui-widget"),this.options=a.extend({width:425,height:356,swfobject:b.swfobject,playlist:{},showPlaylist:0,showTime:1,videoThumbs:0,randomStart:0,autoStart:0,autoPlay:0,repeat:1,repeatPlaylist:0,shuffle:0,chromeless:1,highDef:0,playlistHeight:5,playlistBuilder:null,playlistBuilderClickHandler:null,playlistAnimation:{height:"show",opacity:"show"},playlistSpeed:550,toolbarAppendTo:null,playlistAppendTo:null,timeAppendTo:null,videoParams:{allowfullscreen:"true",allowScriptAccess:"always",wmode:"transparent"},showToolbar:null,toolbarButtons:{},toolbar:"play,prev,next,shuffle,repeat,mute,playlistToggle",toolbarAnimation:{opacity:1},toolbarSpeed:500},e),this.options.chromeless||1==this.options.showToolbar||(this.options.showToolbar=0),this._states={unstarted:-1,ended:0,play:1,paused:2,buffering:3,cued:5},this._youtubeIdExp=/^[^v]+v.(.{11}).*/,this.buttons=a.extend({},this.defaultToolbarButtons,this.options.toolbarButtons),this.element.is("a")){var h=this.element;this.element=a('<div class="youtube-player"></div>');{var i=a('<div class="youtube-player-video"></div>').appendTo(this.element);a('<div class="youtube-player-object"></div>').appendTo(i),a('<ol class="youtube-player-playlist"><li></li></ol>').find("li").append(h.clone()).end().appendTo(this.element)}h.after(this.element).hide()}this.elements={player:this.element,playerVideo:this.element.find(".youtube-player-video"),playerObject:this.element.find(".youtube-player-object")},this.elements.playerObjectClone=this.elements.playerObject.clone(),this.keys={video:0};var j;do j="jqueryyoutubeplayer"+Math.floor(101*Math.random()).toString();while(c.getElementById(j));this.elements.playerObject[0].id=j,this.options.swfobject.getFlashPlayerVersion().major>=8&&this.loadPlaylist(null,null,null,function(){g._bindYoutubeEventHandlers()._createToolbar()._createTimeArea()._createPlayer()})}a.fn.player=function(b){var c="jquery-youtube-player",f=arguments,g=d;return this.each(function(){var h=a.data(this,c);h&&h[b]?(g=h[b].apply(h,Array.prototype.slice.call(f,1)),g="plugin"==b?g:d):h||"object"!=typeof b&&b||a.data(this,c,new e(this,b,c))}),g||this},e.prototype={_activeStates:[],timer:{},videoIds:[],_trigger:function(b,c,d){var e=typeof c;return d=d||[],"string"===e&&this.options[c]&&a.isFunction(this.options[c])?this.options[c].apply(b,d):void("function"===e&&c.apply(b,d))},_bindYoutubeEventHandlers:function(){function a(a){k.youtubePlayer=c.getElementById(a),k._trigger(k,"onPlayerReady",[a]),k.loadVideo(!1,!0),k.elements.toolbar.container.animate(k.options.toolbarAnimation,k.options.toolbarSpeed,function(){k._trigger(k,"onReady",[a])}),k._showPlaylist(function(){k.keys.play&&k.playVideo()})}function e(){k._trigger(this,"onVideoPaused",[k._getVideo()])}function f(){k.buttons.play.element&&k.buttons.play.element.trigger("off"),k.options.repeat&&k.nextVideo()}function g(a){switch(a){case 100:msg="This video has been removed from Youtube.";break;case 101:case 150:msg="This video does not allow playback outside of Youtube.";break;default:msg="Unknown error"}k._trigger(this,"onError",[msg])===d&&alert("There was an error loading this video. "+msg)}function h(){k._updatePlaylist(),k.elements.toolbar.updateStates(),k._trigger(this,"onVideoCue",arguments)}function i(){k._trigger(this,"onBuffer",[k._getVideo()])}function j(){k._updatePlaylist(),k._addState("play"),k.elements.toolbar.updateStates(),k._updateTime(),k._trigger(this,"onVideoPlay",[k._getVideo()])}var k=this,l=this.elements.playerObject[0].id;return b["onytplayerStateChange"+l]=function(b){switch(k._removeStates([-1,0,1,2,3,5,100,101,150,9]),k._addState(b,!0),b){case 0:f();break;case 1:j();break;case 2:e();break;case 3:i();break;case 9:a(l);break;case 5:h();break;case 100:case 101:case 150:g(b)}k._trigger(k,"onYoutubeStateChange",[b])},b.onYouTubePlayerReady||(b.onYouTubePlayerReady=function(a){var d=c.getElementById(a);d.addEventListener("onStateChange","onytplayerStateChange"+a),d.addEventListener("onError","onytplayerStateChange"+a),b["onytplayerStateChange"+a](9)}),this},_createPlayer:function(){this.elements.player.width(this.options.width),this.elements.playerVideo.height(this.options.height);var a=this.options.playlist.videos[this.keys.video].id,b=this.elements.playerObject[0].id,c=this.options.chromeless?"https://www.youtube.com/apiplayer?enablejsapi=1&version=3&playerapiid="+b+"&hd="+this.options.highDef+"&showinfo=0":"https://www.youtube.com/v/"+a+"?enablejsapi=1&playerapiid="+b+"&version=3";return this._trigger(this,"onBeforePlayerBuild"),this.options.swfobject.embedSWF(c,this.elements.playerObject[0].id,"100%","100%","8",null,null,this.options.videoParams),this},_createToolbar:function(){var b=this;return this.elements.toolbar={container:a("<ul />").addClass("youtube-player-toolbar ui-widget ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").css("opacity",0),updateStates:function(){b.elements.toolbar.container.find("li").each(function(){var c=a(this).removeClass("ui-state-active").data("button");return c?(b._state(c.val)&&c.toggle&&a(this).addClass("ui-state-active"),void(b._state(c.val)&&c.toggleButton&&a(this).trigger("on"))):!0})}},null!=this.options.showToolbar&&!this.options.showToolbar&&this.elements.toolbar.container.hide(),a.each(this.options.toolbar.split(","),function(c,e){var f=b.buttons[e];return f&&f.text?(f.val=e,b._states[e]=b._states[e]||e,void a("<li></li>").addClass("ui-state-default ui-corner-all").append('<span class="ui-icon '+f.icon+'"></span>').attr("title",f.text).data("button",f).bind("mouseenter mouseleave",function(){a(this).toggleClass("ui-state-hover")}).bind("off",function(){var c=a(this),d=c.data("button"),f=1;c.data("toggle",f),b._removeState(e),c.find(".ui-icon").removeClass(d.toggleButton.icon).addClass(d.icon).end().attr("title",d.text),b._trigger(b,d.toggleButton.action,[d])}).bind("on",function(){var c=a(this),d=c.data("button"),f=0;c.data("toggle",f),b._addState(e),c.find(".ui-icon").removeClass(d.icon).addClass(d.toggleButton.icon).end().attr("title",d.toggleButton.text),b._trigger(b,d.action,[d])}).bind("toggle",function(){var b=a(this).data("toggle");a(this).trigger(b||b==d?"on":"off")}).click(function(){var c=a(this).data("button"),d=b._state(e);c.toggleButton?a(this).trigger("toggle"):(b._trigger(b,c.action,[c]),!c.toggle||c.toggle&&d?b._removeState(e):b._addState(e),b.elements.toolbar.updateStates())}).appendTo(b.elements.toolbar.container)):!0}),this.options.toolbarAppendTo?this.elements.toolbar.container.appendTo(this.options.toolbarAppendTo):this.elements.playerVideo.after(this.elements.toolbar.container),this},_createTimeArea:function(){return this.elements.toolbar.time=this.options.timeAppendTo?a("<span />").appendTo(this.options.timeAppendTo):a("<li />").addClass("youtube-player-time").appendTo(this.elements.toolbar.container),this.elements.toolbar.timeCurrent=a("<span />").html("0:00").appendTo(this.elements.toolbar.time),this.elements.toolbar.timeDuration=a("<span />").appendTo(this.elements.toolbar.time),this},_createPlaylist:function(){function b(){var b=a(this).data("video");b&&(d.keys.video=a.inArray(b.id,d.videoIds),d._removeState("play"),d._updatePlaylist(),d.loadVideo(),d.playVideo())}function c(){d.elements.playlist=d.elements.playlist||a("<ol />").addClass("youtube-player-playlist ui-helper-reset"),d.elements.playlistContainer=d.elements.playlistContainer||a("<div />").addClass("youtube-player-playlist-container ui-widget-content ui-corner-all").html(d.elements.playlist)}var d=this;this._addVideosToPlaylist=function(b){var c=b?[d.options.playlist.videos[d.options.playlist.videos.length-1]]:d.options.playlist.videos;b||(d.elements.playlist.empty(),d.videoIds=[]),a.each(c,function(){d.videoIds.push(this.id),a("<li />").data("video",this).append(d.options.videoThumbs?'<img alt="'+this.title+'" title="'+this.title+'" src="https://img.youtube.com/vi/'+this.id+'/2.jpg" />':this.title).addClass("ui-state-default").addClass(d.options.videoThumbs?"youtube-player-thumb":"").bind("mouseenter mouseleave",function(){a(this).toggleClass("ui-state-hover")}).appendTo(d.elements.playlist)}),d._trigger(d,"onAfterVideosAddedToPlaylist")},this._bindPlaylistClickHandler=function(a){a.items.click(function(){d._trigger(this,b,arguments),d._trigger(d,"playlistBuilderClickHandler",arguments)})};var e;a.isFunction(this.options.playlistBuilder)?e=this.options.playlistBuilder:(c(),this._addVideosToPlaylist(),this.options.playlistAppendTo?this.elements.playlistContainer.appendTo(this.options.playlistAppendTo):this.elements.toolbar.container.after(this.elements.playlistContainer),e=function(){return{items:d.elements.playlist.find("li"),container:d.elements.playlistContainer}}),a.each(this.options.playlist.videos,function(){d.videoIds.push(this.id)});var f=e.call(this,this.options.playlist.videos);return this.elements.playlistContainer=f.container,this._bindPlaylistClickHandler(f),this},_updateTime:function(){function a(a){var b=Math.floor(a/60),c=(a%60).toFixed(0);return b+":"+(10>c?"0"+c:c)}if(this.options.showTime){var b=this,c=Number(this.youtubePlayer.getDuration());this.elements.toolbar.timeDuration.html(" / "+a(c)),this.elements.toolbar.time.fadeIn(),this.timeInterval=setInterval(function(){b.youtubePlayer.getCurrentTime?b.elements.toolbar.timeCurrent.html(a(b.youtubePlayer.getCurrentTime())):clearInterval(b.timeInterval)},100)}},_removeStates:function(b){var c=[];a.each(this._activeStates,function(d,e){-1===a.inArray(e,b)&&-1===a.inArray(e,c)&&c.push(e)}),this._activeStates=c},_removeState:function(a){a="string"==typeof a?this._states[a]:a,this._removeStates([a])},_state:function(b){return b=this._states[b],-1!==a.inArray(b,this._activeStates)?!0:!1},_addState:function(b,c){c?-1===a.inArray(b,this._activeStates)&&this._activeStates.push(b):this._states[b]&&-1===a.inArray(this._states[b],this._activeStates)&&this._activeStates.push(this._states[b])},_setVideoKey:function(a){this.keys.video=this.options.shuffle?this.options.randomVideo():a||0},_getVideo:function(){return this.options.playlist.videos[this.keys.video]},_findVideo:function(b){var c=-1;return a.each(this.options.playlist.videos,function(a,d){return b==d.id?(c=a,!1):void 0}),c},_getPlaylistData:function(b,c){function d(d){return d?(e.options.playlist={title:d.feed.title.$t,id:f,videos:[]},a.each(d.feed.entry,function(a,b){e.options.playlist.videos.push({id:b.link[0].href.replace(e._youtubeIdExp,"$1"),title:b.title.$t})}),void e.elements.playerObject.fadeOut(180,function(){b.call(e)})):void c.call(e)}var e=this,f=this.options.playlist;if(f.user||f.playlist){var g=f.user?"https://gdata.youtube.com/feeds/api/videos":"https://gdata.youtube.com/feeds/api/playlists/"+f.playlist;g+="?callback=?";var h={alt:"json",format:"5"};return f.user&&(h.author=f.user),this._trigger(this,"onBeforePlaylistLoaded",[f]),void a.ajax({type:"GET",url:g,data:h,dataType:"json",error:function(){e._trigger(e,"onAfterPlaylistLoaded",[f]),e._trigger(e,c)},success:function(){e._trigger(e,"onAfterPlaylistLoaded",[f]),e._trigger(e,d,arguments)}})}if(!f.videos){var i=this.elements.player.find(".youtube-player-playlist li a");i.length&&(e.options.playlist.videos=[],i.each(function(){e.options.playlist.videos.push({id:this.href.replace(e._youtubeIdExp,"$1"),title:a(this).html(),element:this})}))}e._trigger(e,"onAfterPlaylistLoaded",[f]),e._trigger(e,b)},_updatePlaylist:function(){var b=this;this.elements.playlist&&this.elements.playlist.find("li").removeClass("ui-state-active").each(function(c){if(b.options.playlist.videos[b.keys.video].id==a(this).data("video").id){var d=a(this).addClass("ui-state-active").outerHeight();if(!b.options.videoThumbs){var e=c*d-Math.floor(b.options.playlistHeight/2)*d;b.elements.playlist.scrollTop(e)}return!1}})},_showPlaylist:function(a){var b=this.options.showPlaylist;b&&this.elements.playlistContainer.show();var c=(this.elements.playlist.height(),this.elements.playlist.css("height","auto").height()),d=this.elements.playlist.find("li:first").outerHeight(),e=d*this.options.playlistHeight,f=c>e?e:c;b&&this.elements.playlistContainer.hide(),this.elements.playlist.children().length?f&&(this.elements.playlist.height(f),this.options.showPlaylist||b?this.elements.playlistContainer.animate(this.options.playlistAnimation,this.options.playlistSpeed,a):this._trigger(this,a)):(this.elements.playlistContainer.hide(),this._trigger(this,a))},loadVideo:function(a,b){function c(a){b?d.cueVideo(a):d.youtubePlayer.loadVideoById(a,0),d._trigger(d,"onVideoLoad",[d._getVideo()])}var d=this;if(a&&a.id)a={id:a.id,title:a.title},this.videoIds=b?this.videoIds:[],b?this.options.playlist.videos.push(a):this.options.playlist.videos=a.title?[a]:[],this._addVideosToPlaylist(b),!b&&c(a.id);else if(a){var e=this._findVideo(a);-1!==e&&(this.keys.video=e,c(a))}else c(this.options.playlist.videos[this.keys.video].id)},loadPlaylist:function(a,b,c,e){c=c===d?!0:c,a&&(this.options.playlist=a),this._getPlaylistData(function(){this.keys.video=this.options.randomStart?this.randomVideo():0,this._trigger(this,e),this._createPlaylist(),c&&this._showPlaylist()},function(){var a="There was an error loading the playlist.";this.elements.playerObject.html(a),this._trigger(this,"onError",[a])})},pauseVideo:function(){this.options.socket.emit("stopMovie"),this.youtubePlayer.pauseVideo()},shufflePlaylist:function(){this.randomVideo(),this.playVideo()},muteVideo:function(){this._state("mute")?(this.youtubePlayer.unMute(),this.options.socket.emit("unMuteMovie")):(this.youtubePlayer.mute(),this.options.socket.emit("muteMovie"))},repeat:function(){this.options.repeat=1},playVideo:function(){this.options.socket.emit("startMovie"),this.youtubePlayer.playVideo()},cueVideo:function(a,b){return this.youtubePlayer.cueVideoById(a||this.options.playlist.videos[this.keys.video].id,b||0)},randomVideo:function(){return this.keys.video=Math.floor(Math.random()*this.options.playlist.videos.length),this.keys.video},prevVideo:function(){if(this.keys.video>0)this._setVideoKey(--this.keys.video);else{if(!this.options.repeatPlaylist)return;this._setVideoKey(this.videoIds.length-1)}this.loadVideo(null,this._state("play")||this.options.autoPlay?!1:!0)},nextVideo:function(){if(this.keys.video<this.options.playlist.videos.length-1)this._setVideoKey(++this.keys.video);else{if(!this.options.repeatPlaylist)return;this._trigger(this,"onEndPlaylist"),this._setVideoKey(0)}this.loadVideo(null,this._state("play")||this.options.autoPlay?!1:!0)},playlistToggle:function(){this.elements.playlistContainer.find("li").length&&this.elements.playlistContainer.animate({height:"toggle",opacity:"toggle"},this.options.playlistSpeed)},plugin:function(){return this},state:function(){var b=this,c=[];return a.each(this._activeStates,function(d,e){a.each(b._states,function(a,b){e===b&&c.push(a)})}),c},videos:function(){return this.options.playlist.videos},videoIndex:function(){return this.keys.video},destroy:function(){clearInterval(this.timeInterval),this.element.removeClass("ui-widget").removeAttr("style"),this.elements.playerVideo.removeAttr("style"),this.elements.playlistContainer.remove(),this.elements.toolbar.container.remove(),this.options.swfobject.removeSWF(this.elements.playerObject[0].id),this.elements.playerObjectClone.appendTo(this.elements.playerVideo),a.removeData(this.element[0],this._pluginName)}},e.prototype.defaultToolbarButtons={play:{text:"Play",icon:"ui-icon-play",toggleButton:{text:"Pause",icon:"ui-icon-pause",action:function(){this.pauseVideo()}},action:function(){this.playVideo()}},prev:{text:"Prev",icon:"ui-icon-seek-prev",action:function(){this.prevVideo()}},next:{text:"Next",icon:"ui-icon-seek-next",action:function(){this.nextVideo()}},shuffle:{text:"Shuffle/Random",icon:"ui-icon-shuffle",toggle:1,action:function(){this.shufflePlaylist()}},repeat:{text:"Repeat playlist",icon:"ui-icon-refresh",toggle:1,action:function(){this.repeat()}},mute:{text:"Mute",icon:"ui-icon-volume-on",toggle:1,action:function(a){this.muteVideo(a)}},playlistToggle:{text:"Toggle playlist",icon:"ui-icon-script",action:function(){this.playlistToggle()}}}}(this.jQuery,this,document),angular.module("toaster",[]).service("toaster",function(a){this.pop=function(b,c,d){this.toast={type:b,title:c,body:d},a.$broadcast("toaster-newToast")}}).constant("toasterConfig",{"tap-to-dismiss":!0,"newest-on-top":!0,"time-out":5e3,"icon-classes":{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},"icon-class":"toast-info","position-class":"toast-top-right","title-class":"toast-title","message-class":"toast-message"}).directive("toasterContainer",["$compile","$timeout","toasterConfig","toaster",function(a,b,c,d){return{replace:!0,restrict:"EA",link:function(a,e,f){function g(b){b.type=j["icon-classes"][b.type],b.type||(b.type=j["icon-class"]),i++,angular.extend(b,{id:i}),j["time-out"]>0&&h(b,j["time-out"]),j["newest-on-top"]===!0?a.toasters.unshift(b):a.toasters.push(b)}function h(c,d){c.timeout=b(function(){a.removeToast(c.id)},d)}var i=0,j=c;f.toasterOptions&&angular.extend(j,a.$eval(f.toasterOptions)),a.config={position:j["position-class"],title:j["title-class"],message:j["message-class"],tap:j["tap-to-dismiss"]},a.toasters=[],a.$on("toaster-newToast",function(){g(d.toast)})},controller:function(a){a.stopTimer=function(a){a.timeout&&b.cancel(a.timeout)},a.removeToast=function(b){var c=0;for(c;c<a.toasters.length&&a.toasters[c].id!==b;c++);a.toasters.splice(c,1)},a.remove=function(b){a.config.tap===!0&&a.removeToast(b)}},template:'<div  id="toast-container" ng-class="config.position"><div ng-animate="\'animateToaster\'" ng-repeat="toaster in toasters"><div class="toast" ng-class="toaster.type" ng-click="remove(toaster.id)" ng-mouseover="stopTimer(toaster)"><div ng-class="config.title">{{toaster.title}}</div><div ng-class="config.message">{{toaster.body}}</div></div></div></div>'}}]),function(){var a=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},b=navigator.userAgent,c=a(b),d={};c.browser&&(d[c.browser]=!0,d.version=c.version),d.chrome?d.webkit=!0:d.webkit&&(d.safari=!0),d.windows=/windows/i.test(b),d.mobile=/mobile/i.test(b)||/android/i.test(b),"undefined"!=typeof exports?exports.browser=d:$.browser=d}();var paper=new function(){var Base=new function(){function a(a,b,c){if(n)try{return delete a[b],n(a,b,c)}catch(d){}return(c.get||c.set)&&a.__defineGetter__?(c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)):a[b]=c.value,a}function b(a,b){if(o)try{return o(a,b)}catch(c){}var d=a.__lookupGetter__&&a.__lookupGetter__(b);return d?{get:d,set:a.__lookupSetter__(b),enumerable:!0,configurable:!0}:a.hasOwnProperty(b)?{value:a[b],enumerable:!0,configurable:!0,writable:!0}:null}function c(c,d,e,g,h,i){function k(f,i,k,n){var i=i||(i=b(d,f))&&(i.get?i:i.value),o="function"==typeof i,p=i,q=h||o?i&&i.get?f in c:c[f]:null;if((k||void 0!==i&&d.hasOwnProperty(f))&&(!h||!q)){if(o){if(q&&/\bthis\.base\b/.test(i)){var r=g&&g[f]==q;p=function(){var c=b(this,"base");a(this,"base",{value:r?g[f]:q,configurable:!0});try{return i.apply(this,arguments)}finally{c?a(this,"base",c):delete this.base}},p.toString=function(){return i.toString()},p.valueOf=function(){return i.valueOf()}}l&&0===i.length&&(m=f.match(/^(get|is)(([A-Z])(.*))$/))&&l.push([m[3].toLowerCase()+m[4],m[2]])}p&&!o&&p.get||(p={value:p,writable:!0}),(b(c,f)||{configurable:!0}).configurable&&(p.configurable=!0,p.enumerable=e),a(c,f,p)}!n||!o||h&&n[f]||(n[f]=function(a){return a&&c[f].apply(a,j.call(arguments,1))})}var l,m;if(d){l=[];for(var n in d)d.hasOwnProperty(n)&&!f.test(n)&&k(n,null,!0,i);k("toString"),k("valueOf");for(var o=0,p=l&&l.length;p>o;o++)try{var m=l[o],q=m[1];k(m[0],{get:c["get"+q]||c["is"+q],set:c["set"+q]},!0)}catch(r){}}return c}function d(a,b,c,d){try{a&&(d||void 0===d&&i(a)?k:l).call(a,b,c=c||a)}catch(e){if(e!==Base.stop)throw e}return c}function e(a){return d(a,function(a,b){this[b]=a},new a.constructor)}var f=/^(statics|generics|preserve|enumerable|prototype|toString|valueOf)$/,g=Object.prototype,h=g.toString,g=Array.prototype,i=Array.isArray=Array.isArray||function(a){return"[object Array]"===h.call(a)},j=g.slice,k=g.forEach||function(a,b){for(var c=0,d=this.length;d>c;c++)a.call(b,this[c],c,this)},l=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},m=Object.create||function(a){return{__proto__:a}},n=Object.defineProperty,o=Object.getOwnPropertyDescriptor;return c(function(){},{inject:function(a){if(a){var b=this.prototype,d=Object.getPrototypeOf(b).constructor,e=a.statics===!0?a:a.statics;e!=a&&c(b,a,a.enumerable,d&&d.prototype,a.preserve,a.generics&&this),c(this,e,!0,d,a.preserve)}for(var f=1,g=arguments.length;g>f;f++)this.inject(arguments[f]);return this},extend:function(){var b=function(){return this.initialize?this.initialize.apply(this,arguments):void 0};return b.prototype=m(this.prototype),b.toString=function(){return(this.prototype.initialize||function(){}).toString()},a(b.prototype,"constructor",{value:b,writable:!0,configurable:!0}),c(b,this,!0),arguments.length?this.inject.apply(b,arguments):b}},!0).inject({inject:function(){for(var a=0,b=arguments.length;b>a;a++)c(this,arguments[a],arguments[a].enumerable);return this},extend:function(){var a=m(this);return a.inject.apply(a,arguments)},each:function(a,b){return d(this,a,b)},clone:function(){return e(this)},statics:{each:d,clone:e,define:a,describe:b,create:function(a){return m(a.prototype)},isPlainObject:function(a){var b=null!==a&&"object"==typeof a&&Object.getPrototypeOf(a);return b&&(b===Object.prototype||b===Base.prototype)},check:function(a){return!(!a&&0!==a)},pick:function(){for(var a=0,b=arguments.length;b>a;a++)if(void 0!==arguments[a])return arguments[a];return null},stop:{}}})};this.Base=Base.inject({generics:!0,clone:function(){return new this.constructor(this)},toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+Base.each(this,function(a,b){if(!/^_/.test(b)){var c=typeof a;this.push(b+": "+("number"===c?Formatter.instance.number(a):"string"===c?"'"+a+"'":a))}},[]).join(", ")+" }"},exportJSON:function(a){return Base.exportJSON(this,a)},toJSON:function(){return Base.serialize(this)},_set:function(a){if(a&&Base.isPlainObject(a)){for(var b in a)a.hasOwnProperty(b)&&b in this&&(this[b]=a[b]);return!0}},statics:{_classes:{},extend:function(a){var b=this.base.apply(this,arguments);return a._class&&(Base._classes[a._class]=b),b},equals:function(a,b){function c(a,b){for(var c in a)if(a.hasOwnProperty(c)&&"undefined"==typeof b[c])return!1;return!0}if(a==b)return!0;if(a&&a.equals)return a.equals(b);if(b&&b.equals)return b.equals(a);if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;for(var d=0,e=a.length;e>d;d++)if(!Base.equals(a[d],b[d]))return!1;return!0}if(a&&"object"==typeof a&&b&&"object"==typeof b){if(!c(a,b)||!c(b,a))return!1;for(var d in a)if(a.hasOwnProperty(d)&&!Base.equals(a[d],b[d]))return!1;return!0}return!1},read:function(a,b,c,d,e){if(this===Base){var f=this.peek(a,b);return a._index++,a._read=1,f}var g=this.prototype,h=g._readIndex,i=b||h&&a._index||0;c||(c=a.length-i);var j=a[i];return j instanceof this||e&&null==j&&1>=c?(h&&(a._index=i+1),j&&d?j.clone():j):(j=Base.create(this),h&&(j._read=!0),j=j.initialize.apply(j,i>0||c<a.length?Array.prototype.slice.call(a,i,i+c):a)||j,h&&(a._index=i+j._read,a._read=j._read,delete j._read),j)},peek:function(a,b){return a[a._index=b||a._index||0]},readAll:function(a,b,c){for(var d,e=[],f=b||0,g=a.length;g>f;f++)e.push(Array.isArray(d=a[f])?this.read(d,0,0,c):this.read(a,f,1,c));return e},readNamed:function(a,b,c,d,e,f){var g=this.getNamed(a,b);return this.read(null!=g?[g]:a,c,d,e,f)},getNamed:function(a,b){var c=a[0];return void 0===a._hasObject&&(a._hasObject=1===a.length&&Base.isPlainObject(c)),a._hasObject?b?c[b]:c:void 0},hasNamed:function(a,b){return!!this.getNamed(a,b)},serialize:function(a,b,c,d){b=b||{};var e,f=!d;if(f&&(b.formatter=new Formatter(b.precision),d={length:0,definitions:{},references:{},add:function(a,b){var c="#"+a._id,d=this.references[c];if(!d){this.length++;var e=b.call(a);a._class&&e[0]!==a._class&&e.unshift(a._class),this.definitions[c]=e,d=this.references[c]=[c]}return d}}),a&&a._serialize)e=a._serialize(b,d),a._class&&!c&&e[0]!==a._class&&e.unshift(a._class);else if(Array.isArray(a)){e=[];for(var g=0,h=a.length;h>g;g++)e[g]=Base.serialize(a[g],b,c,d)}else if(Base.isPlainObject(a)){e={};for(var g in a)a.hasOwnProperty(g)&&(e[g]=Base.serialize(a[g],b,c,d))}else e="number"==typeof a?b.formatter.number(a,b.precision):a;return f&&d.length>0?[["dictionary",d.definitions],e]:e},deserialize:function(a,b){var c=a;if(b=b||{},Array.isArray(a)){var d=a[0],e="dictionary"===d;if(!e){if(b.dictionary&&1==a.length&&/^#/.test(d))return b.dictionary[d];d=Base._classes[d]}c=[];for(var f=d?1:0,g=a.length;g>f;f++)c.push(Base.deserialize(a[f],b));if(e)b.dictionary=c[0];else if(d){var h=c;c=Base.create(d),c.initialize.apply(c,h)}}else if(Base.isPlainObject(a)){c={};for(var i in a)c[i]=Base.deserialize(a[i],b)}return c},exportJSON:function(a,b){return JSON.stringify(Base.serialize(a,b))},importJSON:function(a){return Base.deserialize("string"==typeof a?JSON.parse(a):a)},splice:function(a,b,c,d){var e=b&&b.length,f=void 0===c;c=f?a.length:c,c>a.length&&(c=a.length);for(var g=0;e>g;g++)b[g]._index=c+g;if(f)return a.push.apply(a,b),[];var h=[c,d];b&&h.push.apply(h,b);for(var i=a.splice.apply(a,h),g=0,j=i.length;j>g;g++)delete i[g]._index;for(var g=c+e,j=a.length;j>g;g++)a[g]._index=g;return i},merge:function(){return Base.each(arguments,function(a){Base.each(a,function(a,b){this[b]=a},this)},new Base,!0)},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},hyphenate:function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Callback={attach:function(a,b){if("string"!=typeof a)return void Base.each(a,function(a,b){this.attach(b,a)},this);var c=this._eventTypes[a];if(c){var d=this._handlers=this._handlers||{};d=d[a]=d[a]||[],-1==d.indexOf(b)&&(d.push(b),c.install&&1==d.length&&c.install.call(this,a))}},detach:function(a,b){if("string"!=typeof a)return void Base.each(a,function(a,b){this.detach(b,a)},this);var c,d=this._eventTypes[a],e=this._handlers&&this._handlers[a];d&&e&&(!b||-1!=(c=e.indexOf(b))&&1==e.length?(d.uninstall&&d.uninstall.call(this,a),delete this._handlers[a]):-1!=c&&e.splice(c,1))},fire:function(a,b){var c=this._handlers&&this._handlers[a];if(!c)return!1;var d=[].slice.call(arguments,1);return Base.each(c,function(a){a.apply(this,d)===!1&&b&&b.stop&&b.stop()},this),!0},responds:function(a){return!(!this._handlers||!this._handlers[a])},statics:{inject:function(){for(var a=0,b=arguments.length;b>a;a++){var c=arguments[a],d=c._events;if(d){var e={};Base.each(d,function(a,b){var d="string"==typeof a,f=d?a:b,g=Base.capitalize(f),h=f.substring(2).toLowerCase();e[h]=d?{}:a,f="_"+f,c["get"+g]=function(){return this[f]},c["set"+g]=function(a){a?this.attach(h,a):this[f]&&this.detach(h,this[f]),this[f]=a}}),c._eventTypes=e}this.base(c)}return this}}},PaperScope=this.PaperScope=Base.extend({initialize:function(a){if(paper=this,this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=a&&(a.getAttribute("id")||a.src)||"paperscope-"+PaperScope._id++,a&&a.setAttribute("id",this._id),PaperScope._scopes[this._id]=this,!this.support){var b=CanvasProvider.getContext(1,1);PaperScope.prototype.support={nativeDash:"setLineDash"in b||"mozDash"in b},CanvasProvider.release(b)
}},version:.8,getView:function(){return this.project&&this.project.view},getTool:function(){return this._tool||(this._tool=new Tool),this._tool},evaluate:function(a){var b=PaperScript.evaluate(a,this);return View.updateFocus(),b},install:function(a){var b=this;Base.each(["project","view","tool"],function(c){Base.define(a,c,{configurable:!0,writable:!0,get:function(){return b[c]}})});for(var c in this)/^(version|_id)/.test(c)||c in a||(a[c]=this[c])},setup:function(a){return paper=this,this.project=new Project(a),this},clear:function(){for(var a=this.projects.length-1;a>=0;a--)this.projects[a].remove();for(var a=this.tools.length-1;a>=0;a--)this.tools[a].remove();for(var a=this.palettes.length-1;a>=0;a--)this.palettes[a].remove()},remove:function(){this.clear(),delete PaperScope._scopes[this._id]},statics:{_scopes:{},_id:0,get:function(a){return"object"==typeof a&&(a=a.getAttribute("id")),this._scopes[a]||null}}}),PaperScopeItem=Base.extend(Callback,{initialize:function(a){this._scope=paper,this._index=this._scope[this._list].push(this)-1,(a||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var a=this._scope[this._reference];return a&&a!=this&&a.fire("deactivate"),this._scope[this._reference]=this,this.fire("activate",a),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null==this._index?!1:(Base.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),Formatter=Base.extend({initialize:function(a){this.precision=a||5,this.multiplier=Math.pow(10,this.precision)},number:function(a){return Math.round(a*this.multiplier)/this.multiplier},point:function(a,b){return this.number(a.x)+(b||",")+this.number(a.y)},size:function(a,b){return this.number(a.width)+(b||",")+this.number(a.height)},rectangle:function(a,b){return this.point(a,b)+(b||",")+this.size(a,b)}});Formatter.instance=new Formatter(5);var Numerical=this.Numerical=new function(){var a=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],b=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],c=Math.abs,d=Math.sqrt,e=Math.pow,f=Math.cos,g=Math.PI;return{TOLERANCE:1e-5,EPSILON:1e-11,KAPPA:4*(d(2)-1)/3,isZero:function(a){return c(a)<=this.EPSILON},integrate:function(c,d,e,f){for(var g=a[f-2],h=b[f-2],i=.5*(e-d),j=i+d,k=0,l=f+1>>1,m=1&f?h[k++]*c(j):0;l>k;){var n=i*g[k];m+=h[k++]*(c(j+n)+c(j-n))}return i*m},findRoot:function(a,b,d,e,f,g,h){for(var i=0;g>i;i++){var j=a(d),k=j/b(d);if(c(k)<h)return d;var l=d-k;j>0?(f=d,d=e>=l?.5*(e+f):l):(e=d,d=l>=f?.5*(e+f):l)}},solveQuadratic:function(a,b,e,f){var g=this.EPSILON;if(c(a)<g)return c(b)>=g?(f[0]=-e/b,1):c(e)<g?-1:0;var h=b*b-4*a*e;if(0>h)return 0;h=d(h),a*=2;var i=0;return f[i++]=(-b-h)/a,h>0&&(f[i++]=(-b+h)/a),i},solveCubic:function(a,b,h,i,j){var k=this.EPSILON;if(c(a)<k)return Numerical.solveQuadratic(b,h,i,j);b/=a,h/=a,i/=a;var l=b*b,m=(l-3*h)/9,n=(2*l*b-9*b*h+27*i)/54,o=m*m*m,p=n*n-o;if(b/=3,c(p)<k){if(c(n)<k)return j[0]=-b,1;var q=d(m),r=n>0?1:-1;return j[0]=2*-r*q-b,j[1]=r*q-b,2}if(0>p){var q=d(m),s=Math.acos(n/(q*q*q))/3,t=-2*q,u=2*g/3;return j[0]=t*f(s)-b,j[1]=t*f(s+u)-b,j[2]=t*f(s-u)-b,3}var v=(n>0?-1:1)*e(c(n)+d(p),1/3);return j[0]=v+m/v-b,1}}},Point=this.Point=Base.extend({_class:"Point",_readIndex:!0,initialize:function(a,b){var c=typeof a;if("number"===c){var d="number"==typeof b;this.x=a,this.y=d?b:a,this._read&&(this._read=d?2:1)}else"undefined"===c||null===a?(this.x=this.y=0,this._read&&(this._read=null===a?1:0)):(Array.isArray(a)?(this.x=a[0],this.y=a.length>1?a[1]:a[0]):null!=a.x?(this.x=a.x,this.y=a.y):null!=a.width?(this.x=a.width,this.y=a.height):null!=a.angle?(this.x=a.length,this.y=0,this.setAngle(a.angle)):(this.x=this.y=0,this._read&&(this._read=0)),this._read&&(this._read=1))},set:function(a,b){return this.x=a,this.y=b,this},equals:function(a){return a=Point.read(arguments),this.x==a.x&&this.y==a.y},clone:function(){return Point.create(this.x,this.y)},toString:function(){var a=Formatter.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.x),b.number(this.y)]},add:function(a){return a=Point.read(arguments),Point.create(this.x+a.x,this.y+a.y)},subtract:function(a){return a=Point.read(arguments),Point.create(this.x-a.x,this.y-a.y)},multiply:function(a){return a=Point.read(arguments),Point.create(this.x*a.x,this.y*a.y)},divide:function(a){return a=Point.read(arguments),Point.create(this.x/a.x,this.y/a.y)},modulo:function(a){return a=Point.read(arguments),Point.create(this.x%a.x,this.y%a.y)},negate:function(){return Point.create(-this.x,-this.y)},transform:function(a){return a?a._transformPoint(this):this},getDistance:function(a,b){a=Point.read(arguments);var c=a.x-this.x,d=a.y-this.y,e=c*c+d*d;return b?e:Math.sqrt(e)},getLength:function(){var a=this.x*this.x+this.y*this.y;return arguments.length&&arguments[0]?a:Math.sqrt(a)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this.set(Math.cos(b)*a,Math.sin(b)*a)}else{var c=a/this.getLength();0==c&&this.getAngle(),this.set(this.x*c,this.y*c)}return this},normalize:function(a){void 0===a&&(a=1);var b=this.getLength(),c=0!=b?a/b:0,d=Point.create(this.x*c,this.y*c);return d._angle=this._angle,d},getAngle:function(){return 180*this.getAngleInRadians(arguments[0])/Math.PI},setAngle:function(a){if(a=this._angle=a*Math.PI/180,!this.isZero()){var b=this.getLength();this.set(Math.cos(a)*b,Math.sin(a)*b)}return this},getAngleInRadians:function(){if(void 0===arguments[0])return null==this._angle&&(this._angle=Math.atan2(this.y,this.x)),this._angle;var a=Point.read(arguments),b=this.getLength()*a.getLength();return Numerical.isZero(b)?0/0:Math.acos(this.dot(a)/b)},getAngleInDegrees:function(){return this.getAngle(arguments[0])},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3},getDirectedAngle:function(a){return a=Point.read(arguments),180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},rotate:function(a,b){if(0===a)return this.clone();a=a*Math.PI/180;var c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a);return c=Point.create(c.x*e-c.y*d,c.y*e+c.x*d),b?c.add(b):c},isInside:function(a){return a.contains(this)},isClose:function(a,b){return this.getDistance(a)<b},isColinear:function(a){return this.cross(a)<1e-5},isOrthogonal:function(a){return this.dot(a)<1e-5},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(a){return a=Point.read(arguments),this.x*a.x+this.y*a.y},cross:function(a){return a=Point.read(arguments),this.x*a.y-this.y*a.x},project:function(a){if(a=Point.read(arguments),a.isZero())return Point.create(0,0);var b=this.dot(a)/a.dot(a);return Point.create(a.x*b,a.y*b)},statics:{create:function(a,b){var c=Base.create(Point);return c.x=a,c.y=b,c},min:function(){var a=Point.read(arguments);return _point2=Point.read(arguments),Point.create(Math.min(a.x,_point2.x),Math.min(a.y,_point2.y))},max:function(){var a=Point.read(arguments);return _point2=Point.read(arguments),Point.create(Math.max(a.x,_point2.x),Math.max(a.y,_point2.y))},random:function(){return Point.create(Math.random(),Math.random())}}},new function(){return Base.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return Point.create(b(this.x),b(this.y))}},{})}),LinkedPoint=Point.extend({set:function(a,b,c){return this._x=a,this._y=b,c||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(a){this._x=a,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner[this._setter](this)},statics:{create:function(a,b,c,d,e){if(e)return Point.create(c,d);var f=Base.create(LinkedPoint);return f._x=c,f._y=d,f._owner=a,f._setter=b,f}}}),Size=this.Size=Base.extend({_class:"Size",_readIndex:!0,initialize:function(a,b){var c=typeof a;if("number"===c){var d="number"==typeof b;this.width=a,this.height=d?b:a,this._read&&(this._read=d?2:1)}else"undefined"===c||null===a?(this.width=this.height=0,this._read&&(this._read=null===a?1:0)):(Array.isArray(a)?(this.width=a[0],this.height=a.length>1?a[1]:a[0]):null!=a.width?(this.width=a.width,this.height=a.height):null!=a.x?(this.width=a.x,this.height=a.y):(this.width=this.height=0,this._read&&(this._read=0)),this._read&&(this._read=1))},set:function(a,b){return this.width=a,this.height=b,this},equals:function(a){return a=Size.read(arguments),this.width==a.width&&this.height==a.height},clone:function(){return Size.create(this.width,this.height)},toString:function(){var a=Formatter.instance;return"{ width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.width),b.number(this.height)]},add:function(a){return a=Size.read(arguments),Size.create(this.width+a.width,this.height+a.height)},subtract:function(a){return a=Size.read(arguments),Size.create(this.width-a.width,this.height-a.height)},multiply:function(a){return a=Size.read(arguments),Size.create(this.width*a.width,this.height*a.height)},divide:function(a){return a=Size.read(arguments),Size.create(this.width/a.width,this.height/a.height)},modulo:function(a){return a=Size.read(arguments),Size.create(this.width%a.width,this.height%a.height)},negate:function(){return Size.create(-this.width,-this.height)},isZero:function(){return Numerical.isZero(this.width)&&Numerical.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{create:function(a,b){return Base.create(Size).set(a,b)},min:function(a,b){return Size.create(Math.min(a.width,b.width),Math.min(a.height,b.height))},max:function(a,b){return Size.create(Math.max(a.width,b.width),Math.max(a.height,b.height))},random:function(){return Size.create(Math.random(),Math.random())}}},new function(){return Base.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return Size.create(b(this.width),b(this.height))}},{})}),LinkedSize=Size.extend({set:function(a,b,c){return this._width=a,this._height=b,c||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(a){this._width=a,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=a,this._owner[this._setter](this)},statics:{create:function(a,b,c,d,e){if(e)return Size.create(c,d);var f=Base.create(LinkedSize);return f._width=c,f._height=d,f._owner=a,f._setter=b,f}}}),Rectangle=this.Rectangle=Base.extend({_class:"Rectangle",_readIndex:!0,initialize:function(a,b,c,d){var e=typeof a,f=0;if("number"===e?(this.x=a,this.y=b,this.width=c,this.height=d,f=4):"undefined"===e||null===a?(this.x=this.y=this.width=this.height=0,f=null===a?1:0):1===arguments.length&&(Array.isArray(a)?(this.x=a[0],this.y=a[1],this.width=a[2],this.height=a[3],f=1):void 0!==a.x||void 0!==a.width?(this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0,f=1):void 0===a.from&&void 0===a.to&&(this.x=this.y=this.width=this.height=0,this._set(a),f=1)),!f){var g=Point.readNamed(arguments,"from"),h=Base.peek(arguments);if(this.x=g.x,this.y=g.y,h&&void 0!==h.x||Base.hasNamed(arguments,"to")){var i=Point.readNamed(arguments,"to");this.width=i.x-g.x,this.height=i.y-g.y,this.width<0&&(this.x=i.x,this.width=-this.width),this.height<0&&(this.y=i.y,this.height=-this.height)}else{var j=Size.read(arguments);this.width=j.width,this.height=j.height}f=arguments._index}this._read&&(this._read=f)},set:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},clone:function(){return Rectangle.create(this.x,this.y,this.width,this.height)},equals:function(a){return a=Rectangle.read(arguments),this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height},toString:function(){var a=Formatter.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+", width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.x),b.number(this.y),b.number(this.width),b.number(this.height)]},getPoint:function(){return LinkedPoint.create(this,"setPoint",this.x,this.y,arguments[0])},setPoint:function(a){a=Point.read(arguments),this.x=a.x,this.y=a.y},getSize:function(){return LinkedSize.create(this,"setSize",this.width,this.height,arguments[0])},setSize:function(a){a=Size.read(arguments),this.width=a.width,this.height=a.height},getLeft:function(){return this.x},setLeft:function(a){this.width-=a-this.x,this.x=a},getTop:function(){return this.y},setTop:function(a){this.height-=a-this.y,this.y=a},getRight:function(){return this.x+this.width},setRight:function(a){this.width=a-this.x},getBottom:function(){return this.y+this.height},setBottom:function(a){this.height=a-this.y},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(a){this.x=a-.5*this.width},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(a){this.y=a-.5*this.height},getCenter:function(){return LinkedPoint.create(this,"setCenter",this.getCenterX(),this.getCenterY(),arguments[0])},setCenter:function(a){return a=Point.read(arguments),this.setCenterX(a.x),this.setCenterY(a.y),this},isEmpty:function(){return 0==this.width||0==this.height},contains:function(a){return a&&void 0!==a.width||4==(Array.isArray(a)?a:arguments).length?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b<=this.x+this.width&&c<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(a){return a=Rectangle.read(arguments),a.x+a.width>this.x&&a.y+a.height>this.y&&a.x<this.x+this.width&&a.y<this.y+this.height},touches:function(a){return a=Rectangle.read(arguments),a.x+a.width>=this.x&&a.y+a.height>=this.y&&a.x<=this.x+this.width&&a.y<=this.y+this.height},intersect:function(a){a=Rectangle.read(arguments);var b=Math.max(this.x,a.x),c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width),e=Math.min(this.y+this.height,a.y+a.height);return Rectangle.create(b,c,d-b,e-c)},unite:function(a){a=Rectangle.read(arguments);var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),e=Math.max(this.y+this.height,a.y+a.height);return Rectangle.create(b,c,d-b,e-c)},include:function(a){a=Point.read(arguments);var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x),e=Math.max(this.y+this.height,a.y);return Rectangle.create(b,c,d-b,e-c)},expand:function(a,b){return void 0===b&&(b=a),Rectangle.create(this.x-a/2,this.y-b/2,this.width+a,this.height+b)},scale:function(a,b){return this.expand(this.width*a-this.width,this.height*(void 0===b?a:b)-this.height)},statics:{create:function(a,b,c,d){return Base.create(Rectangle).set(a,b,c,d)}}},new function(){return Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,b){var c=a.join(""),d=/^[RL]/.test(c);b>=4&&(a[1]+=d?"Y":"X");var e=a[d?0:1],f=a[d?1:0],g="get"+e,h="get"+f,i="set"+e,j="set"+f,k="get"+c,l="set"+c;this[k]=function(){return LinkedPoint.create(this,l,this[g](),this[h](),arguments[0])},this[l]=function(a){a=Point.read(arguments),this[i](a.x),this[j](a.y)}},{})}),LinkedRectangle=Rectangle.extend({set:function(a,b,c,d,e){return this._x=a,this._y=b,this._width=c,this._height=d,e||this._owner[this._setter](this),this},statics:{create:function(a,b,c,d,e,f){var g=Base.create(LinkedRectangle).set(c,d,e,f,!0);return g._owner=a,g._setter=b,g}}},new function(){var a=Rectangle.prototype;return Base.each(["x","y","width","height"],function(a){var b=Base.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]},this["set"+b]=function(a){this[c]=a,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(b){var c="set"+b;this[c]=function(){this._dontNotify=!0,a[c].apply(this,arguments),delete this._dontNotify,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(a){var b=this._owner;b.setSelected&&(b._boundsSelected=a,b.setSelected(a||b._selectedSegmentState>0))}}))}),Matrix=this.Matrix=Base.extend({_class:"Matrix",initialize:function(a){var b=arguments.length,c=!0;if(6==b?this.set.apply(this,arguments):1==b?a instanceof Matrix?this.set(a._a,a._c,a._b,a._d,a._tx,a._ty):Array.isArray(a)?this.set.apply(this,a):c=!1:0==b?this.reset():c=!1,!c)throw new Error("Unsupported matrix parameters")},set:function(a,b,c,d,e,f){return this._a=a,this._c=b,this._b=c,this._d=d,this._tx=e,this._ty=f,this},_serialize:function(a){return Base.serialize(this.getValues(),a)},clone:function(){return Matrix.create(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(a){return a&&this._a==a._a&&this._b==a._b&&this._c==a._c&&this._d==a._d&&this._tx==a._tx&&this._ty==a._ty},toString:function(){var a=Formatter.instance;return"[["+[a.number(this._a),a.number(this._b),a.number(this._tx)].join(", ")+"], ["+[a.number(this._c),a.number(this._d),a.number(this._ty)].join(", ")+"]]"},reset:function(){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,this},scale:function(){var a=Point.read(arguments),b=Point.read(arguments,0,0,!1,!0);return b&&this.translate(b),this._a*=a.x,this._c*=a.x,this._b*=a.y,this._d*=a.y,b&&this.translate(b.negate()),this},translate:function(a){a=Point.read(arguments);var b=a.x,c=a.y;return this._tx+=b*this._a+c*this._b,this._ty+=b*this._c+c*this._d,this},rotate:function(a,b){b=Point.read(arguments,1),a=a*Math.PI/180;var c=b.x,d=b.y,e=Math.cos(a),f=Math.sin(a),g=c-c*e+d*f,h=d-c*f-d*e,i=this._a,j=this._b,k=this._c,l=this._d;return this._a=e*i+f*j,this._b=-f*i+e*j,this._c=e*k+f*l,this._d=-f*k+e*l,this._tx+=g*i+h*j,this._ty+=g*k+h*l,this},shear:function(){var a=Point.read(arguments),b=Point.read(arguments);b&&this.translate(b);var c=this._a,d=this._c;return this._a+=a.y*this._b,this._c+=a.y*this._d,this._b+=a.x*c,this._d+=a.x*d,b&&this.translate(b.negate()),this},isIdentity:function(){return 1==this._a&&0==this._c&&0==this._b&&1==this._d&&0==this._tx&&0==this._ty},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},concatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d;return this._a=a._a*b+a._c*c,this._b=a._b*b+a._d*c,this._c=a._a*d+a._c*e,this._d=a._b*d+a._d*e,this._tx+=a._tx*b+a._ty*c,this._ty+=a._tx*d+a._ty*e,this},preConcatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,g=this._ty;return this._a=a._a*b+a._b*d,this._b=a._a*c+a._b*e,this._c=a._c*b+a._d*d,this._d=a._c*c+a._d*e,this._tx=a._a*f+a._b*g+a._tx,this._ty=a._c*f+a._d*g+a._ty,this},transform:function(a,b,c,d,e){return arguments.length<5?this._transformPoint(Point.read(arguments)):this._transformCoordinates(a,b,c,d,e)},_transformPoint:function(a,b,c){var d=a.x,e=a.y;return b||(b=Base.create(Point)),b.set(d*this._a+e*this._b+this._tx,d*this._c+e*this._d+this._ty,c)},_transformCoordinates:function(a,b,c,d,e){for(var f=b,g=d,h=b+2*e;h>f;){var i=a[f++],j=a[f++];c[g++]=i*this._a+j*this._b+this._tx,c[g++]=i*this._c+j*this._d+this._ty}return c},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,e=c+a.height,f=[b,c,d,c,d,e,b,e];return this._transformCoordinates(f,0,f,0,4)},_transformBounds:function(a,b,c){for(var d=this._transformCorners(a),e=d.slice(0,2),f=d.slice(),g=2;8>g;g++){var h=d[g],i=1&g;h<e[i]?e[i]=h:h>f[i]&&(f[i]=h)}return b||(b=Base.create(Rectangle)),b.set(e[0],e[1],f[0]-e[0],f[1]-e[1],c)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var a=this._a*this._d-this._b*this._c;return isFinite(a)&&!Numerical.isZero(a)&&isFinite(this._tx)&&isFinite(this._ty)?a:null},_inverseTransform:function(a,b,c){var d=this._getDeterminant();if(!d)return null;var e=a.x-this._tx,f=a.y-this._ty;return b||(b=Base.create(Point)),b.set((e*this._d-f*this._b)/d,(f*this._a-e*this._c)/d,c)},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d;if(Numerical.isZero(a*d-b*c))return null;var e=Math.sqrt(a*a+b*b);a/=e,b/=e;var f=a*c+b*d;c-=a*f,d-=b*f;var g=Math.sqrt(c*c+d*d);return c/=g,d/=g,f/=g,b*c>a*d&&(a=-a,b=-b,f=-f,e=-e),{translation:this.getTranslation(),scaling:Point.create(e,g),rotation:180*-Math.atan2(b,a)/Math.PI,shearing:f}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return Point.create(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var a=this._getDeterminant();return a&&Matrix.create(this._d/a,-this._c/a,-this._b/a,this._a/a,(this._b*this._ty-this._d*this._tx)/a,(this._c*this._tx-this._a*this._ty)/a)},shiftless:function(){return Matrix.create(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(a){a.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)},statics:{create:function(a,b,c,d,e,f){return Base.create(Matrix).set(a,b,c,d,e,f)}}},new function(){return Base.each({scaleX:"_a",scaleY:"_d",translateX:"_tx",translateY:"_ty",shearX:"_b",shearY:"_c"},function(a,b){b=Base.capitalize(b),this["get"+b]=function(){return this[a]},this["set"+b]=function(b){this[a]=b}},{})}),Line=this.Line=Base.extend({initialize:function(){var a=Point.read(arguments),b=Point.read(arguments),c=Base.read(arguments);void 0!==c?(this.point=a,this.vector=b.subtract(a),this.infinite=c):(this.point=a,this.vector=b,this.infinite=!0)},intersect:function(a,b,c){var d=this.vector.cross(a.vector);if(Numerical.isZero(d))return null;var e=a.point.subtract(this.point),f=e.cross(a.vector)/d,g=e.cross(this.vector)/d;return(this.infinite||(b?f>0:f>=0)&&(c?1>f:1>=f))&&(a.infinite||(b?g>0:g>=0)&&(c?1>g:1>=g))?this.point.add(this.vector.multiply(f)):null},getSide:function(a){var b=this.vector,c=a.subtract(this.point),d=c.cross(b);return 0===d&&(d=c.dot(b),d>0&&(d=c.subtract(b).dot(b),0>d&&(d=0))),0>d?-1:d>0?1:0},getDistance:function(a){var b=this.vector.y/this.vector.x,c=this.point.y-b*this.point.x,d=Math.abs(a.y-b*a.x-c)/Math.sqrt(b*b+1);return this.infinite?d:Math.min(d,a.getDistance(this.point),a.getDistance(this.point.add(this.vector)))}}),Project=this.Project=PaperScopeItem.extend({_list:"projects",_reference:"project",initialize:function(a){this.base(!0),this.layers=[],this.symbols=[],this._currentStyle=new Style,this.activeLayer=new Layer,a&&(this.view=a instanceof View?a:View.create(a)),this._selectedItems={},this._selectedItemCount=0,this._drawCount=0,this.options={}},_serialize:function(a,b){return Base.serialize(this.layers,a,!1,b)},_needsRedraw:function(){this.view&&(this.view._redrawNeeded=!0)},clear:function(){for(var a=0;a<this.layers.length;a++)this.layers[a].remove();this.symbols=[]},remove:function(){return this.base()?(this.view&&this.view.remove(),!0):!1},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.initialize(a)},getIndex:function(){return this._index},getSelectedItems:function(){var a=[];for(var b in this._selectedItems){var c=this._selectedItems[b];c._drawCount===this._drawCount&&a.push(c)}return a},_updateSelection:function(a){a._selected?(this._selectedItemCount++,this._selectedItems[a._id]=a,a.isInserted()&&(a._drawCount=this._drawCount)):(this._selectedItemCount--,delete this._selectedItems[a._id])},selectAll:function(){for(var a=0,b=this.layers.length;b>a;a++)this.layers[a].setSelected(!0)},deselectAll:function(){for(var a in this._selectedItems)this._selectedItems[a].setSelected(!1)},hitTest:function(a,b){a=Point.read(arguments),b=HitResult.getOptions(Base.read(arguments));for(var c=this.layers.length-1;c>=0;c--){var d=this.layers[c].hitTest(a,b);if(d)return d}return null},importJSON:function(a){return Base.importJSON(a)},draw:function(a,b){this._drawCount++,a.save(),b.applyToContext(a);for(var c={offset:new Point(0,0),transforms:[b]},d=0,e=this.layers.length;e>d;d++)this.layers[d].draw(a,c);if(a.restore(),this._selectedItemCount>0){a.save(),a.strokeWidth=1,a.strokeStyle=a.fillStyle="#009dec";for(var f in this._selectedItems){var g=this._selectedItems[f];if(g._drawCount===this._drawCount&&(g._drawSelected||g._boundsSelected)){var h=g._globalMatrix;if(g._drawSelected&&g._drawSelected(a,h),g._boundsSelected){var i=h._transformCorners(g._getBounds("getBounds"));a.beginPath();for(var d=0;8>d;d++)a[0===d?"moveTo":"lineTo"](i[d],i[++d]);a.closePath(),a.stroke();for(var d=0;8>d;d++)a.beginPath(),a.rect(i[d]-2,i[++d]-2,4,4),a.fill()}}}a.restore()}}}),Symbol=this.Symbol=Base.extend({_class:"Symbol",initialize:function(a,b){this._id=Symbol._id=(Symbol._id||0)+1,this.project=paper.project,this.project.symbols.push(this),a&&this.setDefinition(a,b),this._instances={}},_serialize:function(a,b){return b.add(this,function(){return Base.serialize([this._class,this._definition],a,!1,b)})},_changed:function(a){Base.each(this._instances,function(b){b._changed(a)})},getDefinition:function(){return this._definition},setDefinition:function(a){a._parentSymbol&&(a=a.clone()),this._definition&&delete this._definition._parentSymbol,this._definition=a,a.remove(),a.setSelected(!1),arguments[1]||a.setPosition(new Point),a._parentSymbol=this,this._changed(5)},place:function(a){return new PlacedSymbol(this,a)},clone:function(){return new Symbol(this._definition.clone())}}),Item=this.Item=Base.extend(Callback,{statics:{extend:function(a){return a._serializeFields&&(a._serializeFields=Base.merge(this.prototype._serializeFields,a._serializeFields)),a._class&&(a._type=Base.hyphenate(a._class)),this.base.apply(this,arguments)}}},{_boundsSelected:!1,_serializeFields:{name:null,matrix:new Matrix,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,clipMask:!1,data:{}},initialize:function(a){if(this._id=Item._id=(Item._id||0)+1,!this._project){var b=paper.project,c=b.activeLayer;c?c.addChild(this):this._setProject(b)}this._style=new Style(this._project._currentStyle),this._style._item=this,this._matrix=new Matrix,a&&this._matrix.translate(a)},_events:new function(){var a={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}},b={install:function(b){var c=this._project.view._eventCounters;if(c)for(var d in a)c[d]=(c[d]||0)+(a[d][b]||0)},uninstall:function(b){var c=this._project.view._eventCounters;if(c)for(var d in a)c[d]-=a[d][b]||0}};return Base.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(a){this[a]=b},{onFrame:{install:function(){this._project.view._animateItem(this,!0)},uninstall:function(){this._project.view._animateItem(this,!1)}},onLoad:{}})},_serialize:function(a,b){function c(c){for(var f in c){var g=e[f];Base.equals(g,c[f])||(d[f]=Base.serialize(g,a,"data"!==f,b))}}var d={},e=this;return c(this._serializeFields),this instanceof Group||c(this._style._defaults),[this._class,d]},_changed:function(a){if(4&a&&(delete this._bounds,delete this._position),this._parent&&12&a&&this._parent._clearBoundsCache(),2&a&&this._clearBoundsCache(),1&a&&this._project._needsRedraw(),this._parentSymbol&&this._parentSymbol._changed(a),this._project._changes){var b=this._project._changesById[this._id];b?b.flags|=a:(b={item:this,flags:a},this._project._changesById[this._id]=b,this._project._changes.push(b))}},set:function(a){return a&&this._set(a),this},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},setName:function(a,b){if(this._name&&this._removeFromNamed(),a&&this._parent){for(var c=this._parent._children,d=this._parent._namedChildren,e=a,f=1;b&&c[a];)a=e+" "+f++;(d[a]=d[a]||[]).push(this),c[a]=this}this._name=a||void 0,this._changed(32)},getStyle:function(){return this._style},setStyle:function(a){this._style.initialize(a)},hasFill:function(){return!!this._style.getFillColor()}},Base.each(["locked","visible","blendMode","opacity","guide"],function(a){var b=Base.capitalize(a),a="_"+a;this["get"+b]=function(){return this[a]},this["set"+b]=function(b){b!=this[a]&&(this[a]=b,this._changed("_locked"===a?32:33))}},{}),{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,applyMatrix:!1,isSelected:function(){if(this._children)for(var a=0,b=this._children.length;b>a;a++)if(this._children[a].isSelected())return!0;return this._selected},setSelected:function(a){if(this._children&&!arguments[1])for(var b=0,c=this._children.length;c>b;b++)this._children[b].setSelected(a);(a=!!a)!=this._selected&&(this._selected=a,this._project._updateSelection(this),this._changed(33))},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var a=0,b=this._children.length;b>a;a++)if(!this._children[a].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(a){if(this._children)for(var b=0,c=this._children.length;c>b;b++)this._children[b].setFullySelected(a);this.setSelected(a,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(a){this._clipMask!=(a=!!a)&&(this._clipMask=a,a&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(33),this._parent&&this._parent._changed(256))
},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(a){this._data=a},getPosition:function(){var a=this._position||(this._position=this.getBounds().getCenter(!0));return arguments[0]?a:LinkedPoint.create(this,"setPosition",a.x,a.y)},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},getMatrix:function(){return this._matrix},setMatrix:function(a){this._matrix.initialize(a),this._changed(5)},isEmpty:function(){return 0==this._children.length}},Base.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(a){this[a]=function(){var b=this._boundsGetter,c=this._getCachedBounds("string"==typeof b?b:b&&b[a]||a,arguments[0]);return"getBounds"==a?LinkedRectangle.create(this,"setBounds",c.x,c.y,c.width,c.height):c}},{_getCachedBounds:function(a,b,c){var d=(!b||b.equals(this._matrix))&&a;if(c&&this._parent){var e=c._id,f=this._parent._boundsCache=this._parent._boundsCache||{ids:{},list:[]};f.ids[e]||(f.list.push(c),f.ids[e]=c)}if(d&&this._bounds&&this._bounds[d])return this._bounds[d].clone();var g=this._matrix.isIdentity();b=!b||b.isIdentity()?g?null:this._matrix:g?b:b.clone().concatenate(this._matrix);var h=this._getBounds(a,b,d?this:c);return d&&(this._bounds||(this._bounds={}),this._bounds[d]=h.clone()),h},_clearBoundsCache:function(){if(this._boundsCache){for(var a=0,b=this._boundsCache.list,c=b.length;c>a;a++){var d=b[a];delete d._bounds,d!=this&&d._boundsCache&&d._clearBoundsCache()}delete this._boundsCache}},_getBounds:function(a,b,c){var d=this._children;if(!d||0==d.length)return new Rectangle;for(var e=1/0,f=-e,g=e,h=f,i=0,j=d.length;j>i;i++){var k=d[i];if(k._visible&&!k.isEmpty()){var l=k._getCachedBounds(a,b,c);e=Math.min(l.x,e),g=Math.min(l.y,g),f=Math.max(l.x+l.width,f),h=Math.max(l.y+l.height,h)}}return isFinite(e)?Rectangle.create(e,g,f-e,h-g):new Rectangle},setBounds:function(a){a=Rectangle.read(arguments);var b=this.getBounds(),c=new Matrix,d=a.getCenter();c.translate(d),(a.width!=b.width||a.height!=b.height)&&c.scale(0!=b.width?a.width/b.width:1,0!=b.height?a.height/b.height:1),d=b.getCenter(),c.translate(-d.x,-d.y),this.transform(c)}}),{getProject:function(){return this._project},_setProject:function(a){if(this._project!=a&&(this._project=a,this._children))for(var b=0,c=this._children.length;c>b;b++)this._children[b]._setProject(a)},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof Layer)return a;return null},getParent:function(){return this._parent},setParent:function(a){return a.addChild(this)},getChildren:function(){return this._children},setChildren:function(a){this.removeChildren(),this.addChildren(a)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},isInserted:function(){return this._parent?this._parent.isInserted():!1},clone:function(){return this._clone(new this.constructor)},_clone:function(a){if(a.setStyle(this._style),this._children)for(var b=0,c=this._children.length;c>b;b++)a.addChild(this._children[b].clone(),!0);for(var d=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide","applyMatrix"],b=0,c=d.length;c>b;b++){var e=d[b];this.hasOwnProperty(e)&&(a[e]=this[e])}return a._matrix.initialize(this._matrix),a.setSelected(this._selected),this._name&&a.setName(this._name,!0),a},copyTo:function(a){var b=this.clone();return a.layers?a.activeLayer.addChild(b):a.addChild(b),b},rasterize:function(a){var b=this.getStrokeBounds(),c=(a||72)/72,d=CanvasProvider.getCanvas(b.getSize().multiply(c)),e=d.getContext("2d"),f=(new Matrix).scale(c).translate(-b.x,-b.y);e.save(),f.applyToContext(e),this.draw(e,{transforms:[f]});var g=new Raster(d);return g.setBounds(b),e.restore(),g},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(a){if(this._children){for(var b=this._children.length-1;b>=0;b--)if(this._children[b].contains(a))return!0;return!1}return a.isInside(this._getBounds("getBounds"))},hitTest:function(a,b){function c(c,d){var g=e["get"+d]();return a.getDistance(g)<b.tolerance?new HitResult(c,f,{name:Base.hyphenate(d),point:g}):void 0}if(this._locked)return null;if(a=Point.read(arguments),b=HitResult.getOptions(Base.read(arguments)),!this._children&&!this.getRoughBounds().expand(b.tolerance)._containsPoint(a))return null;if(a=this._matrix._inverseTransform(a),!(!b.center&&!b.bounds||this instanceof Layer&&!this._parent)){var d,e=this.getBounds(),f=this,g=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"];if(b.center&&(d=c("center","Center")))return d;if(b.bounds)for(var h=0;8>h;h++)if(d=c("bounds",g[h]))return d}return this._children||!(b.guides&&!this._guide||b.selected&&!this._selected)?this._hitTest(a,b):null},_hitTest:function(a,b){if(this._children)for(var c=this._children.length-1;c>=0;c--){var d=this._children[c].hitTest(a,b);if(d)return d}},addChild:function(a,b){return this.insertChild(void 0,a,b)},insertChild:function(a,b){return this._children?(b._remove(!0),Base.splice(this._children,[b],a,0),b._parent=this,b._setProject(this._project),b._name&&b.setName(b._name),this._changed(3),b):null},addChildren:function(a,b){return this.insertChildren(this._children.length,a,b)},insertChildren:function(a,b,c){b=b&&Array.prototype.slice.apply(b);for(var d=this._children,e=d.length,f=a,g=0,h=b&&b.length;h>g;g++)if(this.insertChild(f,b[g],c)){var i=d.length;f+=i-e,e=i}return f!=a},insertAbove:function(a,b){var c=a._index;return a._parent==this._parent&&c<this._index&&c++,a._parent.insertChild(c,this,b)},insertBelow:function(a,b){var c=a._index;return a._parent==this._parent&&c>this._index&&c--,a._parent.insertChild(c,this,b)},sendToBack:function(){return this._parent.insertChild(0,this)},bringToFront:function(){return this._parent.addChild(this)},appendTop:function(a){return this.addChild(a)},appendBottom:function(a){return this.insertChild(0,a)},moveAbove:function(a){return this.insertAbove(a)},moveBelow:function(a){return this.insertBelow(a)},_removeFromNamed:function(){var a=this._parent._children,b=this._parent._namedChildren,c=this._name,d=b[c],e=d?d.indexOf(this):-1;-1!=e&&(a[c]==this&&delete a[c],d.splice(e,1),d.length?a[c]=d[d.length-1]:delete b[c])},_remove:function(a){return this._parent?(this._name&&this._removeFromNamed(),null!=this._index&&Base.splice(this._parent._children,null,this._index,1),a&&this._parent._changed(3),this._parent=null,!0):!1},remove:function(){return this._remove(!0)},removeChildren:function(a,b){if(!this._children)return null;a=a||0,b=Base.pick(b,this._children.length);for(var c=Base.splice(this._children,null,a,b-a),d=c.length-1;d>=0;d--)c[d]._remove(!1);return c.length>0&&this._changed(3),c},reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,b=this._children.length;b>a;a++)this._children[a]._index=a;this._changed(3)}},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);return b}for(var c=b(this),d=b(a),e=0,f=Math.min(c.length,d.length);f>e;e++)if(c[e]!=d[e])return c[e]._index<d[e]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isAbove:function(a){return-1==this._getOrder(a)},isBelow:function(a){return 1==this._getOrder(a)},isParent:function(a){return this._parent==a},isChild:function(a){return a&&a._parent==this},isDescendant:function(a){for(var b=this;b=b._parent;)if(b==a)return!0;return!1},isAncestor:function(a){return a?a.isDescendant(this):!1},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&/^(group|layer|compound-path)$/.test(b._type)&&a.isDescendant(b))return!0;b=b._parent}return!1},scale:function(a,b,c){return(arguments.length<2||"object"==typeof b)&&(c=b,b=a),this.transform((new Matrix).scale(a,b,c||this.getPosition(!0)))},translate:function(){var a=new Matrix;return this.transform(a.translate.apply(a,arguments))},rotate:function(a,b){return this.transform((new Matrix).rotate(a,b||this.getPosition(!0)))},shear:function(a,b,c){return(arguments.length<2||"object"==typeof b)&&(c=b,b=a),this.transform((new Matrix).shear(a,b,c||this.getPosition(!0)))},transform:function(a){var b=this._bounds,c=this._position;if(this._matrix.preConcatenate(a),this._transform&&this._transform(a),(this.applyMatrix||arguments[1])&&this._applyMatrix(this._matrix)){var d=this._style,e=d.getFillColor(),f=d.getStrokeColor();e&&e.transform(this._matrix),f&&f.transform(this._matrix),this._matrix.reset()}if(this._changed(5),b&&a.getRotation()%90===0){for(var g in b){var h=b[g];a._transformBounds(h,h)}var i=this._boundsGetter,h=b[i&&i.getBounds||i||"getBounds"];h&&(this._position=h.getCenter(!0)),this._bounds=b}else c&&(this._position=a._transformPoint(c,c));return this},_applyMatrix:function(a){if(this._children){for(var b=0,c=this._children.length;c>b;b++)this._children[b].transform(a,!0);return!0}},fitBounds:function(a,b){a=Rectangle.read(arguments);var c=this.getBounds(),d=c.height/c.width,e=a.height/a.width,f=(b?d>e:e>d)?a.width/c.width:a.height/c.height,g=new Rectangle(new Point,Size.create(c.width*f,c.height*f));g.setCenter(a.getCenter()),this.setBounds(g)},importJSON:function(a){return this.addChild(Base.importJSON(a))},_setStyles:function(a){var b=this._style,c=b.getStrokeWidth(),d=b.getStrokeJoin(),e=b.getStrokeCap(),f=b.getMiterLimit(),g=b.getFillColor(),h=b.getStrokeColor(),i=b.getDashArray(),j=b.getDashOffset();null!=c&&(a.lineWidth=c),d&&(a.lineJoin=d),e&&(a.lineCap=e),f&&(a.miterLimit=f),g&&(a.fillStyle=g.toCanvasStyle(a)),h&&(a.strokeStyle=h.toCanvasStyle(a),paper.support.nativeDash&&i&&i.length&&("setLineDash"in a?(a.setLineDash(i),a.lineDashOffset=j):(a.mozDash=i,a.mozDashOffset=j))),g&&h||(a.globalAlpha=this._opacity)},draw:function(a,b){if(this._visible&&0!=this._opacity){this._drawCount=this._project._drawCount;var c=b.transforms,d=c[c.length-1],e=d.clone().concatenate(this._matrix);c.push(this._globalMatrix=e);var f,g,h;if("normal"!==this._blendMode||this._opacity<1&&"raster"!==this._type&&("path"!==this._type||this.getFillColor()&&this.getStrokeColor())){var i=this.getStrokeBounds(d);if(!i.width||!i.height)return;h=b.offset,g=b.offset=i.getTopLeft().floor(),f=a,a=CanvasProvider.getContext(i.getSize().ceil().add(Size.create(1,1)))}a.save(),f&&a.translate(-g.x,-g.y),(f?e:this._matrix).applyToContext(a),this._draw(a,b),a.restore(),c.pop(),b.clip&&a.clip(),f&&(b.offset=h,"normal"!==this._blendMode?BlendMode.process(this._blendMode,a,f,this._opacity,g.subtract(h)):(f.save(),f.globalAlpha=this._opacity,f.drawImage(a.canvas,g.x,g.y),f.restore()),CanvasProvider.release(a))}}},Base.each(["down","drag","up","move"],function(a){this["removeOn"+Base.capitalize(a)]=function(){var b={};return b[a]=!0,this.removeOn(b)}},{removeOn:function(a){for(var b in a)if(a[b]){var c="mouse"+b,d=Tool._removeSets=Tool._removeSets||{};d[c]=d[c]||{},d[c][this._id]=this}return this}})),Group=this.Group=Item.extend({_class:"Group",_serializeFields:{children:[]},initialize:function(a){this.base(),this._children=[],this._namedChildren={},a&&!this._set(a)&&this.addChildren(Array.isArray(a)?a:arguments)},_changed:function(a){Item.prototype._changed.call(this,a),258&a&&delete this._clipItem},_getClipItem:function(){if(void 0!==this._clipItem)return this._clipItem;for(var a=0,b=this._children.length;b>a;a++){var c=this._children[a];if(c._clipMask)return this._clipItem=c}return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var b=this.getFirstChild();b&&b.setClipMask(a)},_draw:function(a,b){var c=this._getClipItem();c&&(b.clip=!0,c.draw(a,b),b.clip=!1);for(var d=0,e=this._children.length;e>d;d++){var f=this._children[d];f!==c&&f.draw(a,b)}}}),Layer=this.Layer=Group.extend({_class:"Layer",initialize:function(){this._project=paper.project,this._index=this._project.layers.push(this)-1,this.base.apply(this,arguments),this.activate()},_remove:function(a){return this._parent?this.base(a):null!=this._index?(this._project.activeLayer===this&&(this._project.activeLayer=this.getNextSibling()||this.getPreviousSibling()),Base.splice(this._project.layers,null,this._index,1),this._project._needsRedraw(),!0):!1},getNextSibling:function(){return this._parent?this.base():this._project.layers[this._index+1]||null},getPreviousSibling:function(){return this._parent?this.base():this._project.layers[this._index-1]||null},isInserted:function(){return this._parent?this.base():null!=this._index},activate:function(){this._project.activeLayer=this}},new function(){function a(a){return function(b){return b instanceof Layer&&!b._parent&&this._remove(!0)?(Base.splice(b._project.layers,[this],b._index+(a?1:0),0),this._setProject(b._project),!0):this.base(b)}}return{insertAbove:a(!0),insertBelow:a(!1)}}),Shape=this.Shape=Item.extend({_class:"Shape",initialize:function(a,b,c){this.base(b),this._type=a,this._size=c},_draw:function(a,b){var c=this._style,d=this._size,e=d.width,f=d.height,g=c.getFillColor(),h=c.getStrokeColor();if(g||h||b.clip)switch(a.beginPath(),this._type){case"rect":a.rect(-e/2,-f/2,e,f);break;case"circle":a.arc(0,0,(e+f)/4,0,2*Math.PI,!0);break;case"ellipse":var i=e/2,j=f/2,k=Numerical.KAPPA,l=i*k,m=j*k;a.moveTo(0,j),a.bezierCurveTo(0,j-m,i-l,0,i,0),a.bezierCurveTo(i+l,0,e,j-m,e,j),a.bezierCurveTo(e,j+m,i+l,f,i,f),a.bezierCurveTo(i-l,f,0,j+m,0,j)}b.clip||!g&&!h||(this._setStyles(a),g&&a.fill(),h&&a.stroke())},_contains:function(a){switch(this._type){case"rect":return this.base(a);case"circle":case"ellipse":return a.divide(this._size).getLength()<=.5}},_getBounds:function(a,b){var c=new Rectangle(this._size).setCenter(0,0);return b?b._transformBounds(c):c},_hitTest:function(a){return this.hasFill()&&this.contains(a)?new HitResult("fill",this):void 0},statics:{Circle:function(){var a=Point.readNamed(arguments,"center"),b=Base.readNamed(arguments,"radius");return new Shape("circle",a,new Size(2*b))},Rectangle:function(){var a=Rectangle.readNamed(arguments,"rectangle");return new Shape("rect",a.getCenter(!0),a.getSize(!0))},Ellipse:function(){var a=Rectangle.readNamed(arguments,"rectangle");return new Shape("ellipse",a.getCenter(!0),a.getSize(!0))}}}),Raster=this.Raster=Item.extend({_class:"Raster",_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{source:null},initialize:function(a,b){this.base(void 0!==b&&Point.read(arguments,1)),a&&!this._set(a)&&(a.getContext?this.setCanvas(a):"string"==typeof a?this.setSource(a):this.setImage(a)),this._size||(this._size=new Size)},clone:function(){var a=this._image;a||(a=CanvasProvider.getCanvas(this._size),a.getContext("2d").drawImage(this._canvas,0,0));var b=new Raster(a);return this._clone(b)},getSize:function(){return this._size},setSize:function(){var a=Size.read(arguments);if(!this._size.equals(a)){var b=this.getElement();this.setCanvas(CanvasProvider.getCanvas(a)),b&&this.getContext(!0).drawImage(b,0,0,a.width,a.height)}},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},isEmpty:function(){return 0==this._size.width&&0==this._size.height},getPpi:function(){var a=this._matrix,b=new Point(0,0).transform(a),c=new Point(1,0).transform(a).subtract(b),d=new Point(0,1).transform(a).subtract(b);return Size.create(72/c.getLength(),72/d.getLength())},getContext:function(){return this._context||(this._context=this.getCanvas().getContext("2d")),arguments[0]&&(this._image=null,this._changed(129)),this._context},setContext:function(a){this._context=a},getCanvas:function(){if(!this._canvas){var a=CanvasProvider.getContext(this._size);try{this._image&&a.drawImage(this._image,0,0),this._canvas=a.canvas}catch(b){CanvasProvider.release(a)}}return this._canvas},setCanvas:function(a){this._canvas&&CanvasProvider.release(this._canvas),this._canvas=a,this._size=Size.create(a.width,a.height),this._image=null,this._context=null,this._changed(133)},getImage:function(){return this._image},setImage:function(a){this._canvas&&CanvasProvider.release(this._canvas),this._image=a,this._size=Size.create(a.naturalWidth,a.naturalHeight),this._canvas=null,this._context=null,this._changed(5)},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(a){function b(){c.fire("load"),c._project.view&&c._project.view.draw(!0)}var c=this,d=document.getElementById(a)||new Image;DomEvent.add(d,{load:function(){c.setImage(d),b()}}),d.width&&d.height?setTimeout(b,0):d.src||(d.src=a),this.setImage(d)},getElement:function(){return this._canvas||this._image},getSubImage:function(a){a=Rectangle.read(arguments);var b=CanvasProvider.getContext(a.getSize());return b.drawImage(this.getCanvas(),a.x,a.y,a.width,a.height,0,0,a.width,a.height),b.canvas},toDataURL:function(){var a=this._image&&this._image.src;if(/^data:/.test(a))return a;var b=this.getCanvas();return b?b.toDataURL():null},drawImage:function(a,b){b=Point.read(arguments,1),this.getContext(!0).drawImage(a,b.x,b.y)},getAverageColor:function(a){var b,c;a?a instanceof PathItem?(c=a,b=a.getBounds()):a.width?b=new Rectangle(a):a.x&&(b=Rectangle.create(a.x-.5,a.y-.5,1,1)):b=this.getBounds();var d=32,e=Math.min(b.width,d),f=Math.min(b.height,d),g=Raster._sampleContext;g?g.clearRect(0,0,d+1,d+1):g=Raster._sampleContext=CanvasProvider.getContext(new Size(d)),g.save();var h=(new Matrix).scale(e/b.width,f/b.height).translate(-b.x,-b.y);h.applyToContext(g),c&&c.draw(g,{clip:!0,transforms:[h]}),this._matrix.applyToContext(g),g.drawImage(this.getElement(),-this._size.width/2,-this._size.height/2),g.restore();for(var i=g.getImageData(.5,.5,Math.ceil(e),Math.ceil(f)).data,j=[0,0,0],k=0,l=0,m=i.length;m>l;l+=4){var n=i[l+3];k+=n,n/=255,j[0]+=i[l]*n,j[1]+=i[l+1]*n,j[2]+=i[l+2]*n}for(var l=0;3>l;l++)j[l]/=k;return k?Color.read(j):null},getPixel:function(a){a=Point.read(arguments);var b=this.getContext().getImageData(a.x,a.y,1,1).data;return new Color("rgb",[b[0]/255,b[1]/255,b[2]/255],b[3]/255)},setPixel:function(){var a=Point.read(arguments),b=Color.read(arguments),c=b._convert("rgb"),d=b._alpha,e=this.getContext(!0),f=e.createImageData(1,1),g=f.data;g[0]=255*c[0],g[1]=255*c[1],g[2]=255*c[2],g[3]=null!=d?255*d:255,e.putImageData(f,a.x,a.y)},createImageData:function(a){return a=Size.read(arguments),this.getContext().createImageData(a.width,a.height)},getImageData:function(a){return a=Rectangle.read(arguments),a.isEmpty()&&(a=new Rectangle(this.getSize())),this.getContext().getImageData(a.x,a.y,a.width,a.height)},setImageData:function(a,b){b=Point.read(arguments,1),this.getContext(!0).putImageData(a,b.x,b.y)},_getBounds:function(a,b){var c=new Rectangle(this._size).setCenter(0,0);return b?b._transformBounds(c):c},_hitTest:function(a){if(this._contains(a)){var b=this;return new HitResult("pixel",b,{offset:a.add(b._size.divide(2)).round(),color:{get:function(){return b.getPixel(this.offset)}}})}},_draw:function(a){var b=this.getElement();b&&(a.globalAlpha=this._opacity,a.drawImage(b,-this._size.width/2,-this._size.height/2))}}),PlacedSymbol=this.PlacedSymbol=Item.extend({_class:"PlacedSymbol",_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function(a,b){this.base(void 0!==b&&Point.read(arguments,1)),a&&!this._set(a)&&this.setSymbol(a instanceof Symbol?a:new Symbol(a))},getSymbol:function(){return this._symbol},setSymbol:function(a){this._symbol&&delete this._symbol._instances[this._id],this._symbol=a,a._instances[this._id]=this},clone:function(){return this._clone(new PlacedSymbol(this.symbol))},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(a,b){return this.symbol._definition._getCachedBounds(a,b)},_hitTest:function(a,b,c){var d=this._symbol._definition._hitTest(a,b,c);return d&&(d.item=this),d},_draw:function(a,b){this.symbol._definition.draw(a,b)}}),HitResult=this.HitResult=Base.extend({initialize:function(a,b,c){this.type=a,this.item=b,c&&(c.enumerable=!0,this.inject(c))},statics:{getOptions:function(a){return a&&a._merged?a:Base.merge({type:null,tolerance:paper.project.options.hitTolerance||2,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},a)}}}),Segment=this.Segment=Base.extend({_class:"Segment",initialize:function(a,b,c,d,e,f){var g,h,i,j=arguments.length,k=SegmentPoint.create;0===j||(1===j?a.point?(g=a.point,h=a.handleIn,i=a.handleOut):g=a:6>j?2==j&&void 0===b.x?g=[a,b]:(g=a,h=b,i=c):6===j&&(g=[a,b],h=[c,d],i=[e,f])),k(this,"_point",g),k(this,"_handleIn",h),k(this,"_handleOut",i)},_serialize:function(a){return Base.serialize(this.isLinear()?this._point:[this._point,this._handleIn,this._handleOut],a,!0)},_changed:function(a){if(this._path){var b,c=this._path._curves&&this.getCurve();c&&(c._changed(),(b=c[a==this._point||a==this._handleIn&&c._segment1==this?"getPrevious":"getNext"]())&&b._changed()),this._path._changed(5)}},getPoint:function(){return this._point},setPoint:function(a){a=Point.read(arguments),this._point.set(a.x,a.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(a){a=Point.read(arguments),this._handleIn.set(a.x,a.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(a){a=Point.read(arguments),this._handleOut.set(a.x,a.y)},isLinear:function(){return this._handleIn.isZero()&&this._handleOut.isZero()},setLinear:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},_isSelected:function(a){var b=this._selectionState;return a==this._point?!!(4&b):a==this._handleIn?!!(1&b):a==this._handleOut?!!(2&b):!1},_setSelected:function(a,b){var c=this._path,b=!!b,d=this._selectionState||0,e=[!!(4&d),!!(1&d),!!(2&d)];if(a==this._point){if(b)e[1]=e[2]=!1;else{var f=this.getPrevious(),g=this.getNext();e[1]=f&&(f._point.isSelected()||f._handleOut.isSelected()),e[2]=g&&(g._point.isSelected()||g._handleIn.isSelected())}e[0]=b}else{var h=a==this._handleIn?1:2;e[h]!=b&&(b&&(e[0]=!1),e[h]=b)}this._selectionState=(e[0]?4:0)|(e[1]?1:0)|(e[2]?2:0),c&&d!=this._selectionState&&(c._updateSelection(this,d,this._selectionState),c._changed(33))},isSelected:function(){return this._isSelected(this._point)},setSelected:function(a){this._setSelected(this._point,a)},getIndex:function(){return void 0!==this._index?this._index:null},getPath:function(){return this._path||null},getCurve:function(){if(this._path){var a=this._index;return this._path._closed||a!=this._path._segments.length-1||a--,this._path.getCurves()[a]||null}return null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&a[a.length-1])||null},reverse:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(a){return a==this||a&&this._point.equals(a._point)&&this._handleIn.equals(a._handleIn)&&this._handleOut.equals(a._handleOut)},toString:function(){var a=["point: "+this._point];return this._handleIn.isZero()||a.push("handleIn: "+this._handleIn),this._handleOut.isZero()||a.push("handleOut: "+this._handleOut),"{ "+a.join(", ")+" }"},_transformCoordinates:function(a,b,c){var d=this._point,e=c&&this._handleIn.isZero()?null:this._handleIn,f=c&&this._handleOut.isZero()?null:this._handleOut,g=d._x,h=d._y,i=2;return b[0]=g,b[1]=h,e&&(b[i++]=e._x+g,b[i++]=e._y+h),f&&(b[i++]=f._x+g,b[i++]=f._y+h),a&&(a._transformCoordinates(b,0,b,0,i/2),g=b[0],h=b[1],c?(d._x=g,d._y=h,i=2,e&&(e._x=b[i++]-g,e._y=b[i++]-h),f&&(f._x=b[i++]-g,f._y=b[i++]-h)):(e||(b[i++]=g,b[i++]=h),f||(b[i++]=g,b[i++]=h))),b}}),SegmentPoint=Point.extend({set:function(a,b){return this._x=a,this._y=b,this._owner._changed(this),this},getX:function(){return this._x},setX:function(a){this._x=a,this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},setSelected:function(a){this._owner._setSelected(this,a)},isSelected:function(){return this._owner._isSelected(this)},statics:{create:function(a,b,c){var d,e,f,g=Base.create(SegmentPoint);return c?void 0!==(d=c[0])?e=c[1]:(void 0===(d=c.x)&&(c=Point.read(arguments,2),d=c.x),e=c.y,f=c.selected):d=e=0,g._x=d,g._y=e,g._owner=a,a[b]=g,f&&g.setSelected(!0),g}}}),Curve=this.Curve=Base.extend({initialize:function(a,b,c,d,e,f,g,h){var i=arguments.length;if(0==i)this._segment1=new Segment,this._segment2=new Segment;else if(1==i)this._segment1=new Segment(a.segment1),this._segment2=new Segment(a.segment2);else if(2==i)this._segment1=new Segment(a),this._segment2=new Segment(b);else{var j,k,l,m;4==i?(j=a,k=b,l=c,m=d):8==i&&(j=[a,b],m=[g,h],k=[c-a,h-b],l=[e-g,f-h]),this._segment1=new Segment(j,null,k),this._segment2=new Segment(m,l,null)}},_changed:function(){delete this._length,delete this._bounds},getPoint1:function(){return this._segment1._point},setPoint1:function(a){a=Point.read(arguments),this._segment1._point.set(a.x,a.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(a){a=Point.read(arguments),this._segment2._point.set(a.x,a.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(a){a=Point.read(arguments),this._segment1._handleOut.set(a.x,a.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(a){a=Point.read(arguments),this._segment2._handleIn.set(a.x,a.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isSelected:function(){return this.getHandle1().isSelected()&&this.getHandle2().isSelected()},setSelected:function(a){this.getHandle1().setSelected(a),this.getHandle2().setSelected(a)},getValues:function(){return Curve.getValues(this._segment1,this._segment2)},getPoints:function(){for(var a=this.getValues(),b=[],c=0;8>c;c+=2)b.push(Point.create(a[c],a[c+1]));return b},getLength:function(){var a=arguments[0],b=arguments[1],c=0==arguments.length||0==a&&1==b;if(c&&null!=this._length)return this._length;var d=Curve.getLength(this.getValues(),a,b);return c&&(this._length=d),d},getPart:function(a,b){return new Curve(Curve.getPart(this.getValues(),a,b))},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},getIntersections:function(a){return Curve._addIntersections(this.getValues(),a.getValues(),this,[])},getCrossings:function(a,b){function c(a,b){return Curve.evaluate(a.getPrevious().getValues(),1,!0,1).y*b.y>0}var d=this.getValues(),e=Curve.solveCubic(d,1,a.y,b),f=0,g=1e-5,h=Math.abs;-1===e&&(b[0]=Curve.getParameterOf(d,a.x,a.y),e=null!==b[0]?1:0);for(var i=0;e>i;i++){var j=b[i];if(j>-g&&1-g>j){var k=Curve.evaluate(d,j,!0,0);if(a.x<k.x+g){var l=Curve.evaluate(d,j,!0,1);if(h(k.x-a.x)<g){var m=l.getAngle();if(m>-180&&0>m&&(j>g||c(this,l)))continue}else if(h(l.y)<g||g>j&&!c(this,l))continue;f++}}}return f},reverse:function(){return new Curve(this._segment2.reverse(),this._segment1.reverse())},divide:function(a){var b=null;if(a&&a.curve===this&&(a=a.parameter),a>0&&1>a){var c=Curve.subdivide(this.getValues(),a),d=this.isLinear(),e=c[0],f=c[1],g=this._segment1._point,h=this._segment2._point;d||(this._segment1._handleOut.set(e[2]-g._x,e[3]-g._y),this._segment2._handleIn.set(f[4]-h._x,f[5]-h._y));var i=e[6],j=e[7],k=new Segment(Point.create(i,j),d?null:Point.create(e[4]-i,e[5]-j),d?null:Point.create(f[2]-i,f[3]-j));if(this._path)this._segment1._index>0&&0===this._segment2._index?this._path.add(k):this._path.insert(this._segment2._index,k),b=this;else{var l=this._segment2;this._segment2=k,b=new Curve(k,l)}}return b},split:function(a){return this._path?this._path.split(this._segment1._index,a):null},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn),a.push("point2: "+this._segment2._point),"{ "+a.join(", ")+" }"},statics:{create:function(a,b,c){var d=Base.create(Curve);return d._path=a,d._segment1=b,d._segment2=c,d},getValues:function(a,b){var c=a._point,d=a._handleOut,e=b._handleIn,f=b._point;return[c._x,c._y,c._x+d._x,c._y+d._y,f._x+e._x,f._y+e._y,f._x,f._y]},evaluate:function(a,b,c,d){var e,f,g=c?b:Curve.getParameterAt(a,b,0),h=a[0],i=a[1],j=a[2],k=a[3],l=a[4],m=a[5],n=a[6],o=a[7];if(0!==d||0!==g&&1!==g){var p=3*(j-h),q=3*(l-j)-p,r=n-h-p-q,s=3*(k-i),t=3*(m-k)-s,u=o-i-s-t;switch(d){case 0:e=((r*g+q)*g+p)*g+h,f=((u*g+t)*g+s)*g+i;break;case 1:case 2:var v=1e-5;v>g&&j==h&&k==i||g>1-v&&l==n&&m==o?(e=l-j,f=m-k):(e=(3*r*g+2*q)*g+p,f=(3*u*g+2*t)*g+s);break;case 3:e=6*r*g+2*q,f=6*u*g+2*t}}else e=0===g?h:n,f=0===g?i:o;return 2==d?new Point(f,-e):new Point(e,f)},subdivide:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7];void 0===b&&(b=.5);var k=1-b,l=k*c+b*e,m=k*d+b*f,n=k*e+b*g,o=k*f+b*h,p=k*g+b*i,q=k*h+b*j,r=k*l+b*n,s=k*m+b*o,t=k*n+b*p,u=k*o+b*q,v=k*r+b*t,w=k*s+b*u;return[[c,d,l,m,r,s,v,w],[v,w,t,u,p,q,i,j]]},solveCubic:function(a,b,c,d){var e=a[b],f=a[b+2],g=a[b+4],h=a[b+6],i=3*(f-e),j=3*(g-f)-i,k=h-e-i-j;return Numerical.solveCubic(k,j,i,e-c,d)},getParameterOf:function(a,b,c){if(Math.abs(a[0]-b)<1e-5&&Math.abs(a[1]-c)<1e-5)return 0;if(Math.abs(a[6]-b)<1e-5&&Math.abs(a[7]-c)<1e-5)return 1;for(var d,e,f=[],g=[],h=Curve.solveCubic(a,0,b,f),i=Curve.solveCubic(a,1,c,g),j=0;-1==h||h>j;)if(-1==h||(d=f[j++])>=0&&1>=d){for(var k=0;-1==i||i>k;)if((-1==i||(e=g[k++])>=0&&1>=e)&&(-1==h?d=e:-1==i&&(e=d),Math.abs(d-e)<1e-5))return.5*(d+e);if(-1==h)break}return null},getPart:function(a,b,c){return b>0&&(a=Curve.subdivide(a,b)[1]),1>c&&(a=Curve.subdivide(a,(c-b)/(1-b))[0]),a},isFlatEnough:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=3*e-2*c-i,l=3*f-2*d-j,m=3*g-2*i-c,n=3*h-2*j-d;return Math.max(k*k,m*m)+Math.max(l*l,n*n)<16*b*b},getBounds:function(a){for(var b=a.slice(0,2),c=b.slice(),d=[0,0],e=0;2>e;e++)Curve._addBounds(a[e],a[e+2],a[e+4],a[e+6],e,0,b,c,d);return Rectangle.create(b[0],b[1],c[0]-b[0],c[1]-b[1])},_addBounds:function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=a-b,d=a+b;c<g[e]&&(g[e]=c),d>h[e]&&(h[e]=d)}var k=3*(b-c)-a+d,l=2*(a+c)-4*b,m=b-a,n=Numerical.solveQuadratic(k,l,m,i),o=1e-5,p=1-o;j(d,0);for(var q=0;n>q;q++){var r=i[q],s=1-r;r>o&&p>r&&j(s*s*s*a+3*s*s*r*b+3*s*r*r*c+r*r*r*d,f)}},_addIntersections:function(a,b,c,d){var e=Curve.getBounds(a),f=Curve.getBounds(b);if(e.touches(f))if(Curve.isFlatEnough(a,1e-5)&&Curve.isFlatEnough(b,1e-5)){var g=new Line(a[0],a[1],a[6],a[7],!1).intersect(new Line(b[0],b[1],b[6],b[7],!1),!0,!1);g&&d.push(new CurveLocation(c,null,g))}else for(var h=Curve.subdivide(a),i=Curve.subdivide(b),j=0;2>j;j++)for(var k=0;2>k;k++)this._addIntersections(h[j],i[k],c,d);return d}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(a){this[a]=function(){this._bounds||(this._bounds={});var b=this._bounds[a];return b||(b=this._bounds[a]=Path[a]([this._segment1,this._segment2],!1,this._path._style)),b.clone()}},{}),Base.each(["getPoint","getTangent","getNormal","getCurvature"],function(a,b){this[a+"At"]=function(a,c){return Curve.evaluate(this.getValues(),a,c,b)
},this[a]=function(a){return Curve.evaluate(this.getValues(),a,!0,b)}},{getParameterAt:function(a,b){return Curve.getParameterAt(this.getValues(),a,void 0!==b?b:0>a?1:0)},getParameterOf:function(a){return a=Point.read(arguments),Curve.getParameterOf(this.getValues(),a.x,a.y)},getLocationAt:function(a,b){return b||(a=this.getParameterAt(a)),new CurveLocation(this,a)},getLocationOf:function(){var a=this.getParameterOf.apply(this,arguments);return null!=a?new CurveLocation(this,a):null}}),new function(){function a(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=9*(d-f)+3*(h-b),k=6*(b+f)-12*d,l=3*(d-b),m=9*(e-g)+3*(i-c),n=6*(c+g)-12*e,o=3*(e-c);return function(a){var b=(j*a+k)*a+l,c=(m*a+n)*a+o;return Math.sqrt(b*b+c*c)}}function b(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}return{statics:!0,getLength:function(c,d,e){if(void 0===d&&(d=0),void 0===e&&(e=1),c[0]==c[2]&&c[1]==c[3]&&c[6]==c[4]&&c[7]==c[5]){var f=c[6]-c[0],g=c[7]-c[1];return(e-d)*Math.sqrt(f*f+g*g)}var h=a(c);return Numerical.integrate(h,d,e,b(d,e))},getParameterAt:function(c,d,e){function f(a){var c=b(e,a);return m+=a>e?Numerical.integrate(j,e,a,c):-Numerical.integrate(j,a,e,c),e=a,m-d}if(0==d)return e;var g=d>0,h=g?e:0,i=g?1:e,d=Math.abs(d),j=a(c),k=Numerical.integrate(j,h,i,b(h,i));if(d>=k)return g?i:h;var l=d/k,m=0;return Numerical.findRoot(f,j,g?h+l:i-l,h,i,16,1e-5)}}},new function(){function a(a,b){for(var c=3,d=5,e=[],f=[],h=[],i=[],j=0;c>=j;j++)e[j]=a[j].subtract(b),c>j&&(f[j]=a[j+1].subtract(a[j]).multiply(c));for(var k=0;c>k;k++){h[k]=[];for(var l=0;c>=l;l++)h[k][l]=f[k].dot(e[l])}for(var j=0;d>=j;j++)i[j]=new Point(j/d,0);for(var m=0;d>=m;m++)for(var n=Math.max(0,m-c+1),o=Math.min(m,c),j=n;o>=j;j++){var p=m-j;i[m].y+=h[p][j]*g[p][j]}return i}function b(a,f){switch(c(a)){case 0:return[];case 1:if(f>=e)return[.5*(a[0].x+a[5].x)];if(d(a)){var g=new Line(a[0],a[5],!0);return[Numerical.isZero(g.vector.getLength(!0))?g.point.x:h.intersect(g).x]}}for(var i=[[]],j=[],k=[],l=0;5>=l;l++)i[0][l]=new Point(a[l]);for(var m=1;5>=m;m++){i[m]=[];for(var l=0;5-m>=l;l++)i[m][l]=i[m-1][l].add(i[m-1][l+1]).multiply(.5)}for(var l=0;5>=l;l++)j[l]=i[l][0],k[l]=i[5-l][l];return b(j,f+1).concat(b(k,f+1))}function c(a){for(var b=0,c=null,d=0,e=a.length;e>d;d++){var f=a[d].y<0?-1:1;null!=c&&f!=c&&b++,c=f}return b}function d(a){for(var b=a.length-1,c=a[0].y-a[b].y,d=a[b].x-a[0].x,e=a[0].x*a[b].y-a[b].x*a[0].y,g=0,h=0,i=1;b>i;i++){var j=c*a[i].x+d*a[i].y+e,k=j*j;0>j&&k>h?h=k:k>g&&(g=k)}return Math.abs((g+h)/(2*c*(c*c+d*d)))<f}var e=32,f=Math.pow(2,-e-1),g=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],h=new Line(new Point(0,0),new Point(1,0));return{getNearestLocation:function(c){for(var d,e,f=a(this.getPoints(),c),g=b(f,0).concat([0,1]),h=1/0,i=0;i<g.length;i++){var j=this.getPointAt(g[i],!0),k=c.getDistance(j,!0);h>k&&(h=k,d=g[i],e=j)}return new CurveLocation(this,d,e,Math.sqrt(h))},getNearestPoint:function(a){return this.getNearestLocation(a).getPoint()}}}),CurveLocation=this.CurveLocation=Base.extend({initialize:function(a,b,c,d){this._id=CurveLocation._id=(CurveLocation._id||0)+1,this._curve=a,this._segment1=a._segment1,this._segment2=a._segment2,this._parameter=b,this._point=c,this._distance=d},getSegment:function(){if(!this._segment){var a=this.getCurve(),b=this.getParameter();if(0==b)this._segment=a._segment1;else if(1==b)this._segment=a._segment2;else{if(null==b)return null;this._segment=a.getLength(0,b)<a.getLength(b,1)?a._segment1:a._segment2}}return this._segment},getCurve:function(){return(!this._curve||arguments[0])&&(this._curve=this._segment1.getCurve(),null==this._curve.getParameterOf(this._point)&&(this._curve=this._segment2.getPrevious().getCurve())),this._curve},getPath:function(){var a=this.getCurve();return a&&a._path},getIndex:function(){var a=this.getCurve();return a&&a.getIndex()},getOffset:function(){var a=this.getPath();return a&&a._getOffset(this)},getCurveOffset:function(){var a=this.getCurve(),b=this.getParameter();return null!=b&&a&&a.getLength(0,b)},getParameter:function(){if((null==this._parameter||arguments[0])&&this._point){var a=this.getCurve(arguments[0]&&this._point);this._parameter=a&&a.getParameterOf(this._point)}return this._parameter},getPoint:function(){if(!this._point&&null!=this._parameter){var a=this.getCurve();this._point=a&&a.getPointAt(this._parameter,!0)}return this._point},getTangent:function(){var a=this.getParameter(),b=this.getCurve();return null!=a&&b&&b.getTangentAt(a,!0)},getNormal:function(){var a=this.getParameter(),b=this.getCurve();return null!=a&&b&&b.getNormalAt(a,!0)},getDistance:function(){return this._distance},divide:function(){var a=this.getCurve(!0);return a&&a.divide(this.getParameter(!0))},split:function(){var a=this.getCurve(!0);return a&&a.split(this.getParameter(!0))},toString:function(){var a=[],b=this.getPoint(),c=Formatter.instance;b&&a.push("point: "+b);var d=this.getIndex();null!=d&&a.push("index: "+d);var e=this.getParameter();return null!=e&&a.push("parameter: "+c.number(e)),null!=this._distance&&a.push("distance: "+c.number(this._distance)),"{ "+a.join(", ")+" }"}}),PathItem=this.PathItem=Item.extend({applyMatrix:!0,getIntersections:function(a){if(!this.getBounds().touches(a.getBounds()))return[];for(var b=[],c=this.getCurves(),d=a.getCurves(),e=d.length,f=[],g=0;e>g;g++)f[g]=d[g].getValues();for(var g=0,h=c.length;h>g;g++)for(var i=c[g],j=i.getValues(),k=0;e>k;k++)Curve._addIntersections(j,f[k],i,b);return b},setPathData:function(a){function b(a,b,c){var e=parseFloat(d[a]);return g&&(e+=h[b]),c&&(h[b]=e),e}function c(a,c){return new Point(b(a,"x",c),b(a+1,"y",c))}var d,e,f=a.match(/[a-z][^a-z]*/gi),g=!1,h=new Point;"path"===this._type?this.removeSegments():this.removeChildren();for(var i=0,j=f.length;j>i;i++){var k=f[i];cmd=k[0],lower=cmd.toLowerCase(),d=k.slice(1).trim().split(/[\s,]+|(?=[+-])/),g=cmd===lower;var l=d.length;switch(lower){case"m":case"l":for(var m=0;l>m;m+=2)this[0===m&&"m"===lower?"moveTo":"lineTo"](c(m,!0));break;case"h":case"v":for(var n="h"==lower?"x":"y",m=0;l>m;m++)b(m,n,!0),this.lineTo(h);break;case"c":for(var m=0;l>m;m+=6)this.cubicCurveTo(c(m),e=c(m+2),c(m+4,!0));break;case"s":for(var m=0;l>m;m+=4)this.cubicCurveTo(h.multiply(2).subtract(e),e=c(m),c(m+2,!0));break;case"q":for(var m=0;l>m;m+=4)this.quadraticCurveTo(e=c(m),c(m+2,!0));break;case"t":for(var m=0;l>m;m+=2)this.quadraticCurveTo(e=h.multiply(2).subtract(e),c(m,!0));break;case"a":break;case"z":this.closePath()}}}}),Path=this.Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(a){this._closed=!1,this._segments=[],this.base();var b=Array.isArray(a)?"object"==typeof a[0]?a:arguments:!a||void 0===a.point&&void 0===a.x?null:arguments;this.setSegments(b||[]),a&&!b&&this._set(a)},clone:function(){var a=this._clone(new Path(this._segments));return a._closed=this._closed,void 0!==this._clockwise&&(a._clockwise=this._clockwise),a},_changed:function(a){if(Item.prototype._changed.call(this,a),4&a){if(delete this._length,delete this._clockwise,this._curves)for(var b=0,c=this._curves.length;c>b;b++)this._curves[b]._changed(5)}else 8&a&&delete this._bounds},getSegments:function(){return this._segments},setSegments:function(a){this._selectedSegmentState=0,this._segments.length=0,delete this._curves,this._add(Segment.readAll(a))},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var a=this._curves,b=this._segments;if(!a){var c=this._countCurves();a=this._curves=new Array(c);for(var d=0;c>d;d++)a[d]=Curve.create(this,b[d],b[d+1]||b[0])}return a},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},getPathData:function(){function a(a,b,c){var g=a._point,h=b._point,i=a._handleOut,j=b._handleIn;if(i.isZero()&&j.isZero())c||f.push("L"+e.point(h,d));else{var k=h.subtract(g);f.push("c"+e.point(i,d)+" "+e.point(k.add(j),d)+" "+e.point(k,d))}}var b=this._segments,c=this._style,d=arguments[0],e=Formatter.instance,f=[];if(0===b.length)return"";for(f.push("M"+e.point(b[0]._point)),i=0,l=b.length-1;l>i;i++)a(b[i],b[i+1],!1);return(this._closed&&c.getStrokeColor()||c.getFillColor())&&a(b[b.length-1],b[0],!0),this._closed&&f.push("z"),f.join("")},isClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){if(this._closed=a,this._curves){var b=this._curves.length=this._countCurves();a&&(this._curves[b-1]=Curve.create(this,this._segments[b-1],this._segments[0]))}this._changed(5)}},isEmpty:function(){return 0===this._segments.length},isPolygon:function(){for(var a=0,b=this._segments.length;b>a;a++)if(!this._segments[a].isLinear())return!1;return!0},_applyMatrix:function(a){for(var b=new Array(6),c=0,d=this._segments.length;d>c;c++)this._segments[c]._transformCoordinates(a,b,!0);return!0},_add:function(a,b){for(var c=this._segments,d=this._curves,e=a.length,f=null==b,b=f?c.length:b,g=this.isFullySelected(),h=0;e>h;h++){var i=a[h];i._path&&(i=a[h]=i.clone()),i._path=this,i._index=b+h,g&&(i._selectionState=4),i._selectionState&&this._updateSelection(i,0,i._selectionState)}if(f)c.push.apply(c,a);else{c.splice.apply(c,[b,0].concat(a));for(var h=b+e,j=c.length;j>h;h++)c[h]._index=h}if(d||a._curves){d||(d=this._curves=[]);var k=b>0?b-1:b,l=k,m=Math.min(k+e,this._countCurves());a._curves&&(d.splice.apply(d,[k,0].concat(a._curves)),l+=a._curves.length);for(var h=l;m>h;h++)d.splice(h,0,Base.create(Curve));this._adjustCurves(k,m)}return this._changed(5),a},_adjustCurves:function(a,b){for(var c,d=this._segments,e=this._curves,f=a;b>f;f++)c=e[f],c._path=this,c._segment1=d[f],c._segment2=d[f+1]||d[0];(c=e[this._closed&&0===a?d.length-1:a-1])&&(c._segment2=d[a]||d[0]),(c=e[b])&&(c._segment1=d[b])},_countCurves:function(){var a=this._segments.length;return!this._closed&&a>0?a-1:a},add:function(a){return arguments.length>1&&"number"!=typeof a?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(a,b){return arguments.length>2&&"number"!=typeof b?this._add(Segment.readAll(arguments,1),a):this._add([Segment.read(arguments,1)],a)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(a){return this._add([Segment.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(Segment.readAll(a))},insertSegments:function(a,b){return this._add(Segment.readAll(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,b){a=a||0,b=Base.pick(b,this._segments.length);var c=this._segments,d=this._curves,e=c.length,f=c.splice(a,b-a),g=f.length;if(!g)return f;for(var h=0;g>h;h++){var i=f[h];i._selectionState&&this._updateSelection(i,i._selectionState,0),delete i._index,delete i._path}for(var h=a,j=c.length;j>h;h++)c[h]._index=h;if(d){var k=b==e+(this._closed?1:0)?a-1:a,d=d.splice(k,g);arguments[2]&&(f._curves=d.slice(1)),this._adjustCurves(k,k)}return this._changed(5),f},isFullySelected:function(){return this._selected&&this._selectedSegmentState==4*this._segments.length},setFullySelected:function(a){a&&this._selectSegments(!0),this.setSelected(a)},setSelected:function(a){a||this._selectSegments(!1),this.base(a)},_selectSegments:function(a){var b=this._segments.length;this._selectedSegmentState=a?4*b:0;for(var c=0;b>c;c++)this._segments[c]._selectionState=a?4:0},_updateSelection:function(a,b,c){a._selectionState=c;var d=this._selectedSegmentState+=c-b;d>0&&this.setSelected(!0)},flatten:function(a){for(var b=new PathFlattener(this),c=0,d=b.length/Math.ceil(b.length/a),e=b.length+(this._closed?-d:d)/2,f=[];e>=c;)f.push(new Segment(b.evaluate(c,0))),c+=d;this.setSegments(f)},simplify:function(a){if(this._segments.length>2){var b=new PathFitter(this,a||2.5);this.setSegments(b.fit())}},split:function(a,b){if(null!==b){if(1==arguments.length){var c=a;"number"==typeof c&&(c=this.getLocationAt(c)),a=c.index,b=c.parameter}b>=1&&(a++,b--);var d=this.getCurves();if(a>=0&&a<d.length){b>0&&d[a++].divide(b);var e,f=this.removeSegments(a,this._segments.length,!0);return this._closed?(this.setClosed(!1),e=this):a>0&&(e=this._clone((new Path).insertAbove(this,!0))),e._add(f,0),this.addSegment(f[0]),e}return null}},isClockwise:function(){return void 0!==this._clockwise?this._clockwise:Path.isClockwise(this._segments)},setClockwise:function(a){this.isClockwise()!=(a=!!a)&&this.reverse(),this._clockwise=a},reverse:function(){this._segments.reverse();for(var a=0,b=this._segments.length;b>a;a++){var c=this._segments[a],d=c._handleIn;c._handleIn=c._handleOut,c._handleOut=d,c._index=a}void 0!==this._clockwise&&(this._clockwise=!this._clockwise)},join:function(a){if(a){var b=a._segments,c=this.getLastSegment(),d=a.getLastSegment();c._point.equals(d._point)&&a.reverse();var e=a.getFirstSegment();if(c._point.equals(e._point))c.setHandleOut(e._handleOut),this._add(b.slice(1));else{var f=this.getFirstSegment();f._point.equals(e._point)&&a.reverse(),d=a.getLastSegment(),f._point.equals(d._point)?(f.setHandleIn(d._handleIn),this._add(b.slice(0,b.length-1),0)):this._add(b.slice())}a.remove();var f=this.getFirstSegment();return c=this.getLastSegment(),c._point.equals(f._point)&&(f.setHandleIn(c._handleIn),c.remove(),this.setClosed(!0)),this._changed(5),!0}return!1},reduce:function(){return this},getLength:function(){if(null==this._length){var a=this.getCurves();this._length=0;for(var b=0,c=a.length;c>b;b++)this._length+=a[b].getLength()}return this._length},_getOffset:function(a){var b=a&&a.getIndex();if(null!=b){for(var c=this.getCurves(),d=0,e=0;b>e;e++)d+=c[e].getLength();var f=c[b];return d+f.getLength(0,a.getParameter())}return null},getLocationOf:function(a){a=Point.read(arguments);for(var b=this.getCurves(),c=0,d=b.length;d>c;c++){var e=b[c].getLocationOf(a);if(e)return e}return null},getLocationAt:function(a,b){var c=this.getCurves(),d=0;if(b){var e=~~a;return c[e].getLocationAt(a-e,!0)}for(var f=0,g=c.length;g>f;f++){var h=d,i=c[f];if(d+=i.getLength(),d>=a)return i.getLocationAt(a-h)}return a<=this.getLength()?new CurveLocation(c[c.length-1],1):null},getPointAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getPoint()},getTangentAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getTangent()},getNormalAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getNormal()},getNearestLocation:function(a){for(var b=this.getCurves(),c=1/0,d=null,e=0,f=b.length;f>e;e++){var g=b[e].getNearestLocation(a);g._distance<c&&(c=g._distance,d=g)}return d},getNearestPoint:function(a){return this.getNearestLocation(a).getPoint()},hasFill:function(){return!!(this._style.getFillColor()||"compound-path"===this._parent._type&&this._parent._style.getFillColor())},_contains:function(a){var b=this.hasFill();if(!this._closed&&!b||!this._getBounds("getRoughBounds")._containsPoint(a))return!1;for(var c=this.getCurves(),d=this._segments,e=0,f=new Array(3),g=0,h=c.length;h>g;g++)e+=c[g].getCrossings(a,f);return!this._closed&&b&&(e+=Curve.create(this,d[d.length-1],d[0]).getCrossings(a,f)),1===(1&e)},_hitTest:function(a,b){function c(b,c,d){return a.getDistance(c)<h?new HitResult(d,j,{segment:b,point:c}):void 0}function d(a,d){var e=a._point;return(d||b.segments)&&c(a,e,"segment")||!d&&b.handles&&(c(a,e.add(a._handleIn),"handle-in")||c(a,e.add(a._handleOut),"handle-out"))}var e,f,g=this._style,h=b.tolerance||0,i=(b.stroke&&g.getStrokeColor()?g.getStrokeWidth()/2:0)+h,j=this;if(!b.ends||b.segments||this._closed){if(b.segments||b.handles)for(var k=0,l=this._segments.length;l>k;k++)if(f=d(this._segments[k]))return f}else if(f=d(this.getFirstSegment(),!0)||d(this.getLastSegment(),!0))return f;return b.stroke&&i>0&&(e=this.getNearestLocation(a)),!(e&&e._distance<=i)&&b.fill&&this.hasFill()&&this.contains(a)?new HitResult("fill",this):(!e&&b.stroke&&i>0&&(e=this.getNearestLocation(a)),e&&e._distance<=i?b.stroke?new HitResult("stroke",this,{location:e}):new HitResult("fill",this):void 0)}},new function(){function a(a,b,c,d){function e(b){var c=g[b],d=g[b+1];(m!=c||n!=d)&&(a.beginPath(),a.moveTo(m,n),a.lineTo(c,d),a.stroke(),a.beginPath(),a.arc(c,d,f,0,2*Math.PI,!0),a.fill())}for(var f=d/2,g=new Array(6),h=0,i=b.length;i>h;h++){var j=b[h];j._transformCoordinates(c,g,!1);var k=j._selectionState,l=4&k,m=g[0],n=g[1];(l||1&k)&&e(2),(l||2&k)&&e(4),a.save(),a.beginPath(),a.rect(m-f,n-f,d,d),a.fill(),l||(a.beginPath(),a.rect(m-f+1,n-f+1,d-2,d-2),a.fillStyle="#ffffff",a.fill()),a.restore()}}function b(a,b,c){function d(b){var d=m[b];if(c)d._transformCoordinates(c,o,!1),e=o[0],f=o[1];else{var n=d._point;e=n._x,f=n._y}if(p)a.moveTo(e,f),p=!1;else{if(c)i=o[2],j=o[3];else{var q=d._handleIn;i=e+q._x,j=f+q._y}i==e&&j==f&&k==g&&l==h?a.lineTo(e,f):a.bezierCurveTo(k,l,i,j,e,f)}if(g=e,h=f,c)k=o[4],l=o[5];else{var q=d._handleOut;k=g+q._x,l=h+q._y}}for(var e,f,g,h,i,j,k,l,m=b._segments,n=m.length,o=new Array(6),p=!0,q=0;n>q;q++)d(q);b._closed&&n>1&&d(0)}return{_draw:function(a,c){c.compound||a.beginPath();var d=this._style,e=d.getFillColor(),f=d.getStrokeColor(),g=d.getDashArray(),h=!paper.support.nativeDash&&f&&g&&g.length;if((e||f&&!h||c.compound||c.clip)&&b(a,this),this._closed&&a.closePath(),!c.clip&&!c.compound&&(e||f)&&(this._setStyles(a),e&&a.fill(),f)){if(h){a.beginPath();for(var i,j=new PathFlattener(this),k=d.getDashOffset(),l=0;k<j.length;)i=k+g[l++%g.length],j.drawPart(a,k,i),k=i+g[l++%g.length]}a.stroke()}},_drawSelected:function(c,d){c.beginPath(),b(c,this,d),c.stroke(),a(c,this._segments,d,this._project.options.handleSize||4)}}},new function(){function a(a){var b=a.length,c=[],d=[],e=2;c[0]=a[0]/e;for(var f=1;b>f;f++)d[f]=1/e,e=(b-1>f?4:2)-d[f],c[f]=(a[f]-c[f-1])/e;for(var f=1;b>f;f++)c[b-f-1]-=d[b-f]*c[b-f];return c}return{smooth:function(){var b,c=this._segments,d=c.length,e=d;if(!(2>=d)){this._closed?(b=Math.min(d,4),e+=2*Math.min(d,b)):b=0;for(var f=[],g=0;d>g;g++)f[g+b]=c[g]._point;if(this._closed)for(var g=0;b>g;g++)f[g]=c[g+d-b]._point,f[g+d+b]=c[g]._point;else e--;for(var h=[],g=1;e-1>g;g++)h[g]=4*f[g]._x+2*f[g+1]._x;h[0]=f[0]._x+2*f[1]._x,h[e-1]=3*f[e-1]._x;for(var i=a(h),g=1;e-1>g;g++)h[g]=4*f[g]._y+2*f[g+1]._y;h[0]=f[0]._y+2*f[1]._y,h[e-1]=3*f[e-1]._y;var j=a(h);if(this._closed){for(var g=0,k=d;b>g;g++,k++){var l=g/b,m=1-l,n=g+b,o=k+b;i[k]=i[g]*l+i[k]*m,j[k]=j[g]*l+j[k]*m,i[o]=i[n]*m+i[o]*l,j[o]=j[n]*m+j[o]*l}e--}for(var p=null,g=b;e-b>=g;g++){var q=c[g-b];p&&q.setHandleIn(p.subtract(q._point)),e>g&&(q.setHandleOut(Point.create(i[g],j[g]).subtract(q._point)),p=e-1>g?Point.create(2*f[g+1]._x-i[g+1],2*f[g+1]._y-j[g+1]):Point.create((f[e]._x+i[e-1])/2,(f[e]._y+j[e-1])/2))}if(this._closed&&p){var q=this._segments[0];q.setHandleIn(p.subtract(q._point))}}}}},new function(){function a(a){var b=a._segments;if(0==b.length)throw new Error("Use a moveTo() command first");return b[b.length-1]}return{moveTo:function(){1===this._segments.length&&this.removeSegment(0),this._segments.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(b,c,d){var e=Point.read(arguments),f=Point.read(arguments),g=Point.read(arguments),h=a(this);h.setHandleOut(e.subtract(h._point)),this._add([new Segment(g,f.subtract(d))])},quadraticCurveTo:function(b,c){var d=Point.read(arguments),c=Point.read(arguments),e=a(this)._point;this.cubicCurveTo(d.add(e.subtract(d).multiply(1/3)),d.add(c.subtract(d).multiply(1/3)),c)},curveTo:function(){var b=Point.read(arguments),c=Point.read(arguments),d=Base.pick(Base.read(arguments),.5),e=1-d,f=a(this)._point,g=b.subtract(f.multiply(e*e)).subtract(c.multiply(d*d)).divide(2*d*e);if(g.isNaN())throw new Error("Cannot put a curve through points with parameter = "+d);this.quadraticCurveTo(g,c)},arcTo:function(b,c){var d,e=a(this),f=e._point,g=Point.read(arguments),h=Base.pick(Base.peek(arguments),!0);if("boolean"==typeof h){b=g,c=h;var i=f.add(b).divide(2),d=i.add(i.subtract(f).rotate(c?-90:90))}else d=g,b=Point.read(arguments);var j=new Line(f.add(d).divide(2),d.subtract(f).rotate(90)),k=new Line(d.add(b).divide(2),b.subtract(d).rotate(90)),l=j.intersect(k),m=new Line(f,b,!0),n=m.getSide(d);if(!l){if(!n)return this.lineTo(b);throw new Error("Cannot put an arc through the given points: "+[f,d,b])}var o=f.subtract(l),p=(o.getLength(),o.getDirectedAngle(b.subtract(l))),q=m.getSide(l);0==q?p=n*Math.abs(p):n==q&&(p-=360*(0>p?-1:1));for(var r=Math.abs(p),s=r>=360?4:Math.ceil(r/90),t=p/s,u=t*Math.PI/360,v=4/3*Math.sin(u)/(1+Math.cos(u)),w=[],x=0;s>=x;x++){var y=s>x?l.add(o):b,z=s>x?o.rotate(90).multiply(v):null;0==x?e.setHandleOut(z):w.push(new Segment(y,o.rotate(-90).multiply(v),z)),o=o.rotate(t)}this._add(w)},lineBy:function(b){b=Point.read(arguments);var c=a(this);this.lineTo(c._point.add(b))},curveBy:function(b,c,d){b=Point.read(b),c=Point.read(c);var e=a(this)._point;this.curveTo(e.add(b),e.add(c),d)},arcBy:function(b,c){b=Point.read(b),c=Point.read(c);var d=a(this)._point;this.arcBy(d.add(b),d.add(c))},closePath:function(){var a=this.getFirstSegment(),b=this.getLastSegment();a._point.equals(b._point)&&(a.setHandleIn(b._handleIn),b.remove()),this.setClosed(!0)}}},{_getBounds:function(a,b){return Path[a](this._segments,this._closed,this._style,b)},statics:{isClockwise:function(a){function b(a,b){void 0!==c&&(e+=(c-a)*(b+d)),c=a,d=b}for(var c,d,e=0,f=0,g=a.length;g>f;f++){var h=a[f],i=a[g>f+1?f+1:0],j=h._point,k=h._handleOut,l=i._handleIn,m=i._point;b(j._x,j._y),b(j._x+k._x,j._y+k._y),b(m._x+l._x,m._y+l._y),b(m._x,m._y)}return e>0},getBounds:function(a,b,c,d,e){function f(a){a._transformCoordinates(d,h,!1);for(var b=0;2>b;b++)Curve._addBounds(i[b],i[b+4],h[b+2],h[b],b,e?e[b]:0,j,k,l);var c=i;i=h,h=c}var g=a[0];if(!g)return new Rectangle;for(var h=new Array(6),i=g._transformCoordinates(d,new Array(6),!1),j=i.slice(0,2),k=j.slice(),l=new Array(2),m=1,n=a.length;n>m;m++)f(a[m]);return b&&f(g),Rectangle.create(j[0],j[1],k[0]-j[0],k[1]-j[1])},getStrokeBounds:function(a,b,c,d){function e(a,b){if(!b)return[a,a];var c=b.shiftless(),d=c.transform(Point.create(a,0)),e=c.transform(Point.create(0,a)),f=d.getAngleInRadians(),g=d.getLength(),h=e.getLength(),i=Math.sin(f),j=Math.cos(f),k=Math.tan(f),l=-Math.atan(h*k/g),m=Math.atan(h/(k*g));return[Math.abs(g*Math.cos(l)*j-h*Math.sin(l)*i),Math.abs(h*Math.sin(m)*j+g*Math.cos(m)*i)]}function f(a){o=o.include(d?d._transformPoint(a,a):a)}function g(a,b){var c=a.getPointAt(b,!0),d=a.getNormalAt(b,!0).normalize(m);f(c.add(d)),f(c.subtract(d))}function h(a,b){if("round"===b||!a._handleIn.isZero()&&!a._handleOut.isZero())o=o.unite(r.setCenter(d?d._transformPoint(a._point):a._point));else if("bevel"===b){var c=a.getCurve();g(c,0),g(c.getPrevious(),1)}else if("miter"===b){var e=a.getCurve(),i=e.getPrevious(),l=e.getPointAt(0,!0),m=i.getNormalAt(1,!0).normalize(k),n=e.getNormalAt(0,!0).normalize(k),p=new Line(l.add(m),Point.create(-m.y,m.x)),q=new Line(l.add(n),Point.create(-n.y,n.x)),s=p.intersect(q);!s||l.getDistance(s)>j?h(a,"bevel"):f(s)}}function i(a,b,c){switch(b){case"round":return h(a,b);case"butt":case"square":var d=a.getCurve(),e=d.getPointAt(c,!0),g=d.getNormalAt(c,!0).normalize(m);"square"===b&&(e=e.add(g.rotate(0==c?-90:90))),f(e.add(g)),f(e.subtract(g))}}if(!c.getStrokeColor()||!c.getStrokeWidth())return Path.getBounds(a,b,c,d);var j,k,l=a.length-(b?0:1),m=c.getStrokeWidth()/2,n=e(m,d),o=Path.getBounds(a,b,c,d,n),p=c.getStrokeJoin(),q=c.getStrokeCap();"miter"==p&&l>1&&(j=c.getMiterLimit()*c.getStrokeWidth()/2,k=m*(Path.isClockwise(a)?1:-1));for(var r=new Rectangle(new Size(n).multiply(2)),s=1;l>s;s++)h(a[s],p);return b?h(a[0],p):(i(a[0],q,0),i(a[a.length-1],q,1)),o},getHandleBounds:function(a,b,c,d,e,f){var g=new Array(6),h=1/0,i=-h,j=h,k=i;e=e/2||0,f=f/2||0;for(var l=0,m=a.length;m>l;l++){var n=a[l];n._transformCoordinates(d,g,!1);for(var o=0;6>o;o+=2){var p=0==o?f:e,q=g[o],r=g[o+1],s=q-p,t=q+p,u=r-p,v=r+p;h>s&&(h=s),t>i&&(i=t),j>u&&(j=u),v>k&&(k=v)}}return Rectangle.create(h,j,i-h,k-j)},getRoughBounds:function(a,b,c,d){var e=c.getStrokeColor()?c.getStrokeWidth():0;return Path.getHandleBounds(a,b,c,d,e,"miter"==c.getStrokeJoin()?e*c.getMiterLimit():e)}}});Path.inject({statics:new function(){function a(a){var b=new Path,c=Base.getNamed(a);return c&&b._set(c),b}function b(){var b=Rectangle.readNamed(arguments,"rectangle"),c=Size.readNamed(arguments,"radius",0,0,!1,!0),e=b.getBottomLeft(!0),f=b.getTopLeft(!0),g=b.getTopRight(!0),h=b.getBottomRight(!0),i=a(arguments);if(!c||c.isZero())i._add([new Segment(e),new Segment(f),new Segment(g),new Segment(h)]);else{c=Size.min(c,b.getSize(!0).divide(2));var j=c.multiply(2*d);i._add([new Segment(e.add(c.width,0),null,[-j.width,0]),new Segment(e.subtract(0,c.height),[0,j.height],null),new Segment(f.add(0,c.height),null,[0,-j.height]),new Segment(f.add(c.width,0),[-j.width,0],null),new Segment(g.subtract(c.width,0),null,[j.width,0]),new Segment(g.add(0,c.height),[0,-j.height],null),new Segment(h.subtract(0,c.height),null,[0,j.height]),new Segment(h.subtract(c.width,0),[j.width,0],null)])}return i._closed=!0,i}function c(){for(var b=Rectangle.readNamed(arguments,"rectangle"),c=a(arguments),d=b.getPoint(!0),f=b.getSize(!0),g=new Array(4),h=0;4>h;h++){var i=e[h];g[h]=new Segment(i._point.multiply(f).add(d),i._handleIn.multiply(f),i._handleOut.multiply(f))}return c._add(g),c._closed=!0,c}var d=Numerical.KAPPA/2,e=[new Segment([0,.5],[0,d],[0,-d]),new Segment([.5,0],[-d,0],[d,0]),new Segment([1,.5],[0,-d],[0,d]),new Segment([.5,1],[d,0],[-d,0])];return{Line:function(){return new Path(Point.readNamed(arguments,"from"),Point.readNamed(arguments,"to")).set(Base.getNamed(arguments))},Rectangle:b,RoundRectangle:b,Ellipse:c,Oval:c,Circle:function(){var a=Point.readNamed(arguments,"center"),b=Base.readNamed(arguments,"radius");return c(new Rectangle(a.subtract(b),Size.create(2*b,2*b))).set(Base.getNamed(arguments))},Arc:function(){var b=Point.readNamed(arguments,"from"),c=Point.readNamed(arguments,"through"),d=Point.readNamed(arguments,"to"),e=a(arguments);return e.moveTo(b),e.arcTo(c,d),e},RegularPolygon:function(){for(var b=Point.readNamed(arguments,"center"),c=Base.readNamed(arguments,"sides"),d=Base.readNamed(arguments,"radius"),e=a(arguments),f=360/c,g=!(c%3),h=new Point(0,g?-d:d),i=g?-1:.5,j=new Array(c),k=0;c>k;k++)j[k]=new Segment(b.add(h.rotate((k+i)*f)));return e._add(j),e._closed=!0,e},Star:function(){for(var b=Point.readNamed(arguments,"center"),c=2*Base.readNamed(arguments,"points"),d=Base.readNamed(arguments,"radius1"),e=Base.readNamed(arguments,"radius2"),f=a(arguments),g=360/c,h=new Point(0,-1),i=new Array(c),j=0;c>j;j++)i[j]=new Segment(b.add(h.rotate(g*j).multiply(j%2?e:d)));return f._add(i),f._closed=!0,f}}}});var CompoundPath=this.CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{pathData:""},initialize:function(a){this.base(),this._children=[],this._namedChildren={},a&&!this._set(a)&&this.addChildren(Array.isArray(a)?a:arguments)},insertChild:function(a,b,c){return"path"!==b._type?null:(b=this.base(a,b),!c&&b&&void 0===b._clockwise&&b.setClockwise(0==b._index),b)},reduce:function(){if(1==this._children.length){var a=this._children[0];return a.insertAbove(this),this.remove(),a}return this},smooth:function(){for(var a=0,b=this._children.length;b>a;a++)this._children[a].smooth()},getFirstSegment:function(){var a=this.getFirstChild();return a&&a.getFirstSegment()},getLastSegment:function(){var a=this.getLastChild();return a&&a.getLastSegment()},getCurves:function(){for(var a=this._children,b=[],c=0,d=a.length;d>c;c++)b=b.concat(a[c].getCurves());return b},getFirstCurve:function(){var a=this.getFirstChild();return a&&a.getFirstCurve()},getLastCurve:function(){var a=this.getLastChild();return a&&a.getFirstCurve()},getPathData:function(){for(var a=this._children,b=[],c=0,d=a.length;d>c;c++)b.push(a[c].getPathData(arguments[0]));return b.join(" ")},_contains:function(a){for(var b=[],c=0,d=this._children.length;d>c;c++){var e=this._children[c];e.contains(a)&&b.push(e)}return 1==(1&b.length)&&b},_hitTest:function(a,b){var c=this.base(a,Base.merge(b,{fill:!1}));return!c&&b.fill&&this._style.getFillColor()&&(c=this._contains(a),c=c?new HitResult("fill",c[0]):null),c},_draw:function(a,b){var c=this._children,d=this._style;if(0!==c.length){a.beginPath(),b.compound=!0;for(var e=0,f=c.length;f>e;e++)c[e].draw(a,b);b.compound=!1,b.clip||(this._setStyles(a),d.getFillColor()&&a.fill(),d.getStrokeColor()&&a.stroke())}}},new function(){function a(a){if(!a._children.length)throw new Error("Use a moveTo() command first");return a._children[a._children.length-1]}var b={moveTo:function(){var a=new Path;this.addChild(a),a.moveTo.apply(a,arguments)},moveBy:function(){this.moveTo(a(this).getLastSegment()._point.add(Point.read(arguments)))},closePath:function(){a(this).closePath()}};return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","curveBy","arcBy"],function(c){b[c]=function(){var b=a(this);b[c].apply(b,arguments)}}),b}),PathFlattener=Base.extend({initialize:function(a){function b(a,b){var c=Curve.getValues(a,b);f.curves.push(c),f._computeParts(c,a._index,0,1)}this.curves=[],this.parts=[],this.length=0,this.index=0;for(var c,d=a._segments,e=d[0],f=this,g=1,h=d.length;h>g;g++)c=d[g],b(e,c),e=c;a._closed&&b(c,d[0])},_computeParts:function(a,b,c,d){if(d-c>1/32&&!Curve.isFlatEnough(a,.25)){var e=Curve.subdivide(a),f=(c+d)/2;this._computeParts(e[0],b,c,f),this._computeParts(e[1],b,f,d)}else{var g=a[6]-a[0],h=a[7]-a[1],i=Math.sqrt(g*g+h*h);i>1e-5&&(this.length+=i,this.parts.push({offset:this.length,value:d,index:b}))}},getParameterAt:function(a){for(var b,c=this.index;b=c,!(0==c||this.parts[--c].offset<a););for(var d=this.parts.length;d>b;b++){var e=this.parts[b];if(e.offset>=a){this.index=b;var f=this.parts[b-1],g=f&&f.index==e.index?f.value:0,h=f?f.offset:0;return{value:g+(e.value-g)*(a-h)/(e.offset-h),index:e.index}}}var e=this.parts[this.parts.length-1];return{value:1,index:e.index}},evaluate:function(a,b){var c=this.getParameterAt(a);return Curve.evaluate(this.curves[c.index],c.value,!0,b)},drawPart:function(a,b,c){b=this.getParameterAt(b),c=this.getParameterAt(c);for(var d=b.index;d<=c.index;d++){var e=Curve.getPart(this.curves[d],d==b.index?b.value:0,d==c.index?c.value:1);d==b.index&&a.moveTo(e[0],e[1]),a.bezierCurveTo.apply(a,e.slice(2))}}}),PathFitter=Base.extend({initialize:function(a,b){this.points=[];for(var c,d=a._segments,e=0,f=d.length;f>e;e++){var g=d[e].point.clone();c&&c.equals(g)||(this.points.push(g),c=g)}this.error=b},fit:function(){var a=this.points,b=a.length;return this.segments=b>0?[new Segment(a[0])]:[],b>1&&this.fitCubic(0,b-1,a[1].subtract(a[0]).normalize(),a[b-2].subtract(a[b-1]).normalize()),this.segments},fitCubic:function(a,b,c,d){if(b-a==1){var e=this.points[a],f=this.points[b],g=e.getDistance(f)/3;return void this.addCurve([e,e.add(c.normalize(g)),f.add(d.normalize(g)),f])}for(var h,i=this.chordLengthParameterize(a,b),j=Math.max(this.error,this.error*this.error),k=0;4>=k;k++){var l=this.generateBezier(a,b,i,c,d),m=this.findMaxError(a,b,l,i);if(m.error<this.error)return void this.addCurve(l);if(h=m.index,m.error>=j)break;this.reparameterize(a,b,i,l),j=m.error}var n=this.points[h-1].subtract(this.points[h]),o=this.points[h].subtract(this.points[h+1]),p=n.add(o).divide(2).normalize();this.fitCubic(a,h,c,p),this.fitCubic(h,b,p.negate(),d)},addCurve:function(a){var b=this.segments[this.segments.length-1];b.setHandleOut(a[1].subtract(a[0])),this.segments.push(new Segment(a[3],a[2].subtract(a[3])))},generateBezier:function(a,b,c,d,e){for(var f=1e-11,g=this.points[a],h=this.points[b],i=[[0,0],[0,0]],j=[0,0],k=0,l=b-a+1;l>k;k++){var m=c[k],n=1-m,o=3*m*n,p=n*n*n,q=o*n,r=o*m,s=m*m*m,t=d.normalize(q),u=e.normalize(r),v=this.points[a+k].subtract(g.multiply(p+q)).subtract(h.multiply(r+s));i[0][0]+=t.dot(t),i[0][1]+=t.dot(u),i[1][0]=i[0][1],i[1][1]+=u.dot(u),j[0]+=t.dot(v),j[1]+=u.dot(v)}var w,x,y=i[0][0]*i[1][1]-i[1][0]*i[0][1];
if(Math.abs(y)>f){var z=i[0][0]*j[1]-i[1][0]*j[0],A=j[0]*i[1][1]-j[1]*i[0][1];w=A/y,x=z/y}else{var B=i[0][0]+i[0][1],C=i[1][0]+i[1][1];w=x=Math.abs(B)>f?j[0]/B:Math.abs(C)>f?j[1]/C:0}var D=h.getDistance(g);return f*=D,(f>w||f>x)&&(w=x=D/3),[g,g.add(d.normalize(w)),h.add(e.normalize(x)),h]},reparameterize:function(a,b,c,d){for(var e=a;b>=e;e++)c[e-a]=this.findRoot(d,this.points[e],c[e-a])},findRoot:function(a,b,c){for(var d=[],e=[],f=0;2>=f;f++)d[f]=a[f+1].subtract(a[f]).multiply(3);for(var f=0;1>=f;f++)e[f]=d[f+1].subtract(d[f]).multiply(2);var g=this.evaluate(3,a,c),h=this.evaluate(2,d,c),i=this.evaluate(1,e,c),j=g.subtract(b),k=h.dot(h)+j.dot(i);return Math.abs(k)<1e-5?c:c-j.dot(h)/k},evaluate:function(a,b,c){for(var d=b.slice(),e=1;a>=e;e++)for(var f=0;a-e>=f;f++)d[f]=d[f].multiply(1-c).add(d[f+1].multiply(c));return d[0]},chordLengthParameterize:function(a,b){for(var c=[0],d=a+1;b>=d;d++)c[d-a]=c[d-a-1]+this.points[d].getDistance(this.points[d-1]);for(var d=1,e=b-a;e>=d;d++)c[d]/=c[e];return c},findMaxError:function(a,b,c,d){for(var e=Math.floor((b-a+1)/2),f=0,g=a+1;b>g;g++){var h=this.evaluate(3,c,d[g-a]),i=h.subtract(this.points[g]),j=i.x*i.x+i.y*i.y;j>=f&&(f=j,e=g)}return{error:f,index:e}}}),TextItem=this.TextItem=Item.extend({_boundsSelected:!0,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function(a){var b=a&&Base.isPlainObject(a)&&void 0===a.x&&void 0===a.y;this.base(b?null:Point.read(arguments)),this._content="",this._lines=[],b&&this._set(a)},_clone:function(a){return a.setContent(this._content),this.base(a)},getContent:function(){return this._content},setContent:function(a){this._content=""+a,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(69)},isEmpty:function(){return!this._content},getCharacterStyle:function(){return this.getStyle()},setCharacterStyle:function(a){this.setStyle(a)},getParagraphStyle:function(){return this.getStyle()},setParagraphStyle:function(a){this.setStyle(a)}}),PointText=this.PointText=TextItem.extend({_class:"PointText",clone:function(){return this._clone(new PointText)},getPoint:function(){var a=this._matrix.getTranslation();return LinkedPoint.create(this,"setPoint",a.x,a.y)},setPoint:function(){this.translate(Point.read(arguments).subtract(this._matrix.getTranslation()))},_draw:function(a){if(this._content){this._setStyles(a);var b=this._style,c=this._lines,d=b.getLeading();a.font=b.getFontStyle(),a.textAlign=b.getJustification();for(var e=0,f=c.length;f>e;e++){var g=c[e];b.getFillColor()&&a.fillText(g,0,0),b.getStrokeColor()&&a.strokeText(g,0,0),a.translate(0,d)}}}},new function(){var a=null;return{_getBounds:function(b,c){a||(a=CanvasProvider.getContext(1,1));var d=this._style,e=this._lines,f=e.length,g=d.getJustification(),h=d.getLeading(),i=0;a.font=d.getFontStyle();for(var j=0,k=0;f>k;k++)j=Math.max(j,a.measureText(e[k]).width);"left"!==g&&(i-=j/("center"===g?2:1));var l=Rectangle.create(i,f?h/4+(f-1)*h:0,j,-f*h);return c?c._transformBounds(l,l):l}}}),Color=this.Color=Base.extend(new function(){function a(a){var b=f[a];if(!b){c||(c=CanvasProvider.getContext(1,1),c.globalCompositeOperation="copy"),c.fillStyle="rgba(0,0,0,0)",c.fillStyle=a,c.fillRect(0,0,1,1);var d=c.getImageData(0,0,1,1).data;b=f[a]=[d[0]/255,d[1]/255,d[2]/255]}return b.slice()}function b(a){var b=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);if(b.length>=4){for(var c=[0,0,0],d=0;3>d;d++){var e=b[d+1];c[d]=parseInt(1==e.length?e+e:e,16)/255}return c}}var c,d={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},e={},f={},g=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],h={"rgb-hsb":function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=0===f?0:60*(d==a?(b-c)/f+(c>b?6:0):d==b?(c-a)/f+2:(a-b)/f+4);return[g,0===d?0:f/d,d]},"hsb-rgb":function(a,b,c){var a=a/60%6,d=Math.floor(a),e=a-d,d=g[d],f=[c,c*(1-b),c*(1-b*e),c*(1-b*(1-e))];return[f[d[0]],f[d[1]],f[d[2]]]},"rgb-hsl":function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=0===f,h=g?0:60*(d==a?(b-c)/f+(c>b?6:0):d==b?(c-a)/f+2:(a-b)/f+4),i=(d+e)/2,j=g?0:.5>i?f/(d+e):f/(2-d-e);return[h,j,i]},"hsl-rgb":function(a,b,c){if(a/=360,0===b)return[c,c,c];for(var d=[a+1/3,a,a-1/3],e=.5>c?c*(1+b):c+b-c*b,f=2*c-e,g=[],h=0;3>h;h++){var i=d[h];0>i&&(i+=1),i>1&&(i-=1),g[h]=1>6*i?f+6*(e-f)*i:1>2*i?e:2>3*i?f+(e-f)*(2/3-i)*6:f}return g},"rgb-gray":function(a,b,c){return[.2989*a+.587*b+.114*c]},"gray-rgb":function(a){return[a,a,a]},"gray-hsb":function(a){return[0,0,a]},"gray-hsl":function(a){return[0,0,a]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return Base.each(d,function(a,b){e[b]=[],Base.each(a,function(a,c){var d=Base.capitalize(a),f=/^(hue|saturation)$/.test(a),g=e[b][c]="gradient"===a?function(a){var b=this._components[0];return a=Gradient.read(Array.isArray(a)?a:arguments,0,0,!1,!0),b!==a&&(b&&b._removeOwner(this),a&&a._addOwner(this)),a}:"hue"===a?function(a){return isNaN(a)?0:(a%360+360)%360}:"gradient"===b?function(){return Point.read(arguments,0,0,!0,"highlight"===a)}:function(a){return isNaN(a)?0:Math.min(Math.max(a,0),1)};this["get"+d]=function(){return this._type===b||f&&/^hs[bl]$/.test(this._type)?this._components[c]:this._convert(b)[c]},this["set"+d]=function(a){this._type===b||f&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(b),this._type=b),a=g.call(this,a),null!=a&&(this._components[c]=a,this._changed())}},this)},{_class:"Color",_readIndex:!0,initialize:function(c){var f,g,h,i,j=Array.prototype.slice,k=arguments,l=0;Array.isArray(c)&&(k=c,c=k[0]);var m=null!=c&&typeof c;if("string"===m&&c in d&&(f=c,c=k[1],Array.isArray(c)?(g=c,h=k[2]):(this._read&&(l=1),k=j.call(k,1),m=typeof c)),!g){if(i="number"===m?k:"object"===m&&null!=c.length?c:null){f||(f=i.length>=3?"rgb":"gray");var n=d[f].length;h=i[n],this._read&&(l+=i===arguments?n+(null!=h?1:0):1),i.length>n&&(i=j.call(i,0,n))}else if("string"===m)g=c.match(/^#[0-9a-f]{3,6}$/i)?b(c):a(c),f="rgb";else if("object"===m)if("Color"===c._class){if(f=c._type,g=c._components.slice(),h=c._alpha,"gradient"===f)for(var o=1,p=g.length;p>o;o++){var q=g[o];q&&(g[o]=q.clone())}}else if("Gradient"===c._class)f="gradient",i=k;else{f="hue"in c?"lightness"in c?"hsl":"hsb":"gradient"in c||"stops"in c?"gradient":"gray"in c?"gray":"rgb";var r=d[f];t=e[f],this._components=g=[];for(var o=0,p=r.length;p>o;o++){var s=c[r[o]];null==s&&0===o&&"gradient"===f&&"stops"in c&&(s={stops:c.stops,radial:c.radial}),s=t[o].call(this,s),null!=s&&(g[o]=s)}h=c.alpha}this._read&&f&&(l=1)}if(this._type=f||"rgb","gradient"===f&&(this._id=Color._id=(Color._id||0)+1),!g){this._components=g=[];for(var t=e[this._type],o=0,p=t.length;p>o;o++){var s=t[o].call(this,i&&i[o]);null!=s&&(g[o]=s)}}this._components=g,this._alpha=h,this._read&&(this._read=l)},_serialize:function(a,b){return Base.serialize(/^(gray|rgb)$/.test(this._type)?this._components:[this._type].concat(this._components),a,!0,b)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(17)},clone:function(){return new Color(this._type,this._components.slice(),this._alpha)},_convert:function(a){var b;return this._type===a?this._components.slice():(b=h[this._type+"-"+a])?b.apply(this,this._components):h["rgb-"+a].apply(this,h[this._type+"-rgb"].apply(this,this._components))},convert:function(a){return new Color(a,this._convert(a),this._alpha)},getType:function(){return this._type},setType:function(a){this._components=this._convert(a),this._type=a},getComponents:function(){var a=this._components.slice();return null!=this._alpha&&a.push(this._alpha),a},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(a){this._alpha=null==a?null:Math.min(Math.max(a,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(a){return a&&this._type===a._type&&this._alpha===a._alpha&&Base.equals(this._components,a._components)},toString:function(){for(var a=d[this._type],b=[],c="gradient"===this._type,e=Formatter.instance,f=0,g=a.length;g>f;f++){var h=this._components[f];null!=h&&b.push(a[f]+": "+(c?h:e.number(h)))}return null!=this._alpha&&b.push("alpha: "+e.number(this._alpha)),"{ "+b.join(", ")+" }"},toCss:function(a){var b=this._convert("rgb"),c=a||null==this._alpha?1:this._alpha;return b=[Math.round(255*b[0]),Math.round(255*b[1]),Math.round(255*b[2])],1>c&&b.push(c),(4==b.length?"rgba(":"rgb(")+b.join(", ")+")"},toCanvasStyle:function(a){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCss();var b,c=this._components,d=c[0],e=d._stops,f=c[1],g=c[2];if(d._radial){var h=g.getDistance(f),i=c[3];if(i){var j=i.subtract(f);j.getLength()>h&&(i=f.add(j.normalize(h-.1)))}var k=i||f;b=a.createRadialGradient(k.x,k.y,0,f.x,f.y,h)}else b=a.createLinearGradient(f.x,f.y,g.x,g.y);for(var l=0,m=e.length;m>l;l++){var n=e[l];b.addColorStop(n._rampPoint,n._color.toCanvasStyle())}return this._canvasStyle=b},transform:function(a){if("gradient"===this._type){for(var b=this._components,c=1,d=b.length;d>c;c++){var e=b[c];a._transformPoint(e,e,!0)}this._changed()}},statics:{_types:d,random:function(){var a=Math.random;return new Color(a(),a(),a())}}})});Base.each(Color._types,function(a,b){var c=this[Base.capitalize(b)+"Color"]=function(a){var c=null!=a&&typeof a,d="object"===c&&null!=a.length?a:"string"===c?null:arguments;return d?new Color(b,d):new Color(a)};if(3==b.length){var d=b.toUpperCase();Color[d]=this[d+"Color"]=c}},this);var Gradient=this.Gradient=Base.extend({_class:"Gradient",initialize:function(a,b){this._id=Gradient._id=(Gradient._id||0)+1,a&&this._set(a)&&(a=b=null),this._stops||this.setStops(a||["white","black"]),null==this._radial&&this.setRadial("string"==typeof b&&"radial"===b||b||!1)},_serialize:function(a,b){return b.add(this,function(){return Base.serialize([this._stops,this._radial],a,!0,b)})},_changed:function(){for(var a=0,b=this._owners&&this._owners.length;b>a;a++)this._owners[a]._changed()},_addOwner:function(a){this._owners||(this._owners=[]),this._owners.push(a)},_removeOwner:function(a){var b=this._owners?this._owners.indexOf(a):-1;-1!=b&&(this._owners.splice(b,1),0===this._owners.length&&delete this._owners)},clone:function(){for(var a=[],b=0,c=this._stops.length;c>b;b++)a[b]=this._stops[b].clone();return new this.constructor(a)},getStops:function(){return this._stops},setStops:function(a){if(this.stops)for(var b=0,c=this._stops.length;c>b;b++)delete this._stops[b]._owner;if(a.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(a,0,!0);for(var b=0,c=this._stops.length;c>b;b++){var d=this._stops[b];d._owner=this,d._defaultRamp&&d.setRampPoint(b/(c-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(a){this._radial=a,this._changed()},equals:function(a){if(a&&a.constructor==this.constructor&&this._stops.length==a._stops.length){for(var b=0,c=this._stops.length;c>b;b++)if(!this._stops[b].equals(a._stops[b]))return!1;return!0}return!1}}),GradientStop=this.GradientStop=Base.extend({initialize:function(a,b){if(a){var c,d;void 0===b&&Array.isArray(a)?(c=a[0],d=a[1]):a.color?(c=a.color,d=a.rampPoint):(c=a,d=b),this.setColor(c),this.setRampPoint(d)}},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},_serialize:function(a,b){return Base.serialize([this._color,this._rampPoint],a,!0,b)},_changed:function(){this._owner&&this._owner._changed(17)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(a){this._defaultRamp=null==a,this._rampPoint=a||0,this._changed()},getColor:function(){return this._color},setColor:function(a){this._color=Color.read(arguments),this._color===a&&(this._color=a.clone()),this._color._owner=this,this._changed()},equals:function(a){return a==this||a instanceof GradientStop&&this._color.equals(a._color)&&this._rampPoint==a._rampPoint}}),Style=this.Style=Base.extend(new function(){var a={fillColor:void 0,strokeColor:void 0,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",miterLimit:10,dashOffset:0,dashArray:[],font:"sans-serif",fontSize:12,leading:null,justification:"left"},b={strokeWidth:25,strokeCap:25,strokeJoin:25,miterLimit:25,font:5,fontSize:5,leading:5,justification:5},c={},d={_defaults:a,_textDefaults:Base.merge(a,{fillColor:new Color})};return Base.each(a,function(a,e){var f=/Color$/.test(e),g=Base.capitalize(e),h=b[e],i="set"+g,j="get"+g;d[i]=function(a){var b=this._item&&this._item._children;if(b&&b.length>0&&"compound-path"!==this._item._type)for(var c=0,d=b.length;d>c;c++)b[c]._style[i](a);else{var g=this._values[e];g!=a&&(f&&(g&&delete g._owner,a&&a.constructor===Color&&(a._owner=this._item)),this._values[e]=a,this._item&&this._item._changed(h||17))}},d[j]=function(){var a,b=this._item&&this._item._children;if(!b||0===b.length||"compound-path"===this._item._type){var a=this._values[e];return void 0===a?(a=this._defaults[e],a&&a.clone&&(a=a.clone()),this._values[e]=a):!f||a&&a.constructor===Color||(this._values[e]=a=Color.read([a],0,0,!0,!0),a&&(a._owner=this._item)),a}for(var c=0,d=b.length;d>c;c++){var g=b[c]._style[j]();if(a){if(!Base.equals(a,g))return void 0}else a=g}return a},c[j]=function(){return this._style[j]()},c[i]=function(a){this._style[i](a)}}),Item.inject(c),d},{initialize:function(a){if(this._values={},this._item instanceof TextItem&&(this._defaults=this._textDefaults),a){var b=a instanceof Style,c=b?a._values:a;for(var d in c)if(d in this._defaults){var e=c[d];this[d]=e&&b&&e.clone?e.clone():e}}},getLeading:function(){var a=this.base();return null!=a?a:1.2*this.getFontSize()},getFontStyle:function(){var a=this.getFontSize();return(/[a-z]/i.test(a)?a+" ":a+"px ")+this.getFont()}}),DomElement=new function(){function a(b,c){for(var d=[],e=0,f=b&&b.length;f>e;){var g=b[e++];if("string"==typeof g)g=document.createElement(g);else if(!g||!g.nodeType)continue;Base.isPlainObject(b[e])&&DomElement.set(g,b[e++]),Array.isArray(b[e])&&a(b[e++],g),c&&c.appendChild(g),d.push(g)}return d}var b=/^(checked|value|selected|disabled)$/i,c={text:"textContent",html:"innerHTML"},d={lineHeight:1,zoom:1,zIndex:1,opacity:1};return{create:function(b,c){var d=Array.isArray(b),e=a(d?b:arguments,d?c:null);return 1==e.length?e[0]:e},find:function(a,b){return(b||document).querySelector(a)},findAll:function(a,b){return(b||document).querySelectorAll(a)},get:function(a,d){return a?b.test(d)?"value"===d||"string"!=typeof a[d]?a[d]:!0:d in c?a[c[d]]:a.getAttribute(d):null},set:function(a,d,e){if("string"!=typeof d)for(var f in d)d.hasOwnProperty(f)&&this.set(a,f,d[f]);else{if(!a||void 0===e)return a;b.test(d)?a[d]=e:d in c?a[c[d]]=e:"style"===d?this.setStyle(a,e):"events"===d?DomEvent.add(a,e):a.setAttribute(d,e)}return a},getStyles:function(a){var b=a&&a.ownerDocument.defaultView;return b&&b.getComputedStyle(a,"")},getStyle:function(a,b){return a&&a.style[b]||this.getStyles(a)[b]||null},setStyle:function(a,b,c){if("string"!=typeof b)for(var e in b)b.hasOwnProperty(e)&&this.setStyle(a,e,b[e]);else!/^-?[\d\.]+$/.test(c)||b in d||(c+="px"),a.style[b]=c;return a},hasClass:function(a,b){return new RegExp("\\s*"+b+"\\s*").test(a.className)},addClass:function(a,b){a.className=(a.className+" "+b).trim()},removeClass:function(a,b){a.className=a.className.replace(new RegExp("\\s*"+b+"\\s*")," ").trim()},remove:function(a){a.parentNode&&a.parentNode.removeChild(a)},removeChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},getBounds:function(a,b){var c=a.getBoundingClientRect(),d=a.ownerDocument,e=d.body,f=d.documentElement,g=c.left-(f.clientLeft||e.clientLeft||0),h=c.top-(f.clientTop||e.clientTop||0);if(!b){var i=d.defaultView;g+=i.pageXOffset||f.scrollLeft||e.scrollLeft,h+=i.pageYOffset||f.scrollTop||e.scrollTop}return new Rectangle(g,h,c.width,c.height)},getViewportBounds:function(a){var b=a.ownerDocument,c=b.defaultView,d=b.documentElement;return Rectangle.create(0,0,c.innerWidth||d.clientWidth,c.innerHeight||d.clientHeight)},getOffset:function(a,b){return this.getBounds(a,b).getPoint()},getSize:function(a){return this.getBounds(a,!0).getSize()},isInvisible:function(a){return this.getSize(a).equals([0,0])},isInView:function(a){return!this.isInvisible(a)&&this.getViewportBounds(a).intersects(this.getBounds(a,!0))}}},DomEvent={add:function(a,b){for(var c in b){var d=b[c];a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d.bound=function(){d.call(a,window.event)})}},remove:function(a,b){for(var c in b){var d=b[c];a.removeEventListener?a.removeEventListener(c,d,!1):a.detachEvent&&a.detachEvent("on"+c,d.bound)}},getPoint:function(a){var b=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return Point.create(b.pageX||b.clientX+document.documentElement.scrollLeft,b.pageY||b.clientY+document.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getOffset:function(a,b){return DomEvent.getPoint(a).subtract(DomElement.getOffset(b||DomEvent.getTarget(a)))},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},stop:function(a){DomEvent.stopPropagation(a),DomEvent.preventDefault(a)}};DomEvent.requestAnimationFrame=new function(){var a="equestAnimationFrame",b=window["r"+a]||window["webkitR"+a]||window["mozR"+a]||window["oR"+a]||window["msR"+a];b&&b(function(a){null==a&&(b=null)});var c,d=[],e=!0;return DomEvent.add(window,{focus:function(){e=!0},blur:function(){e=!1}}),function(a,f){return b?b(a,f):(d.push([a,f]),void(c||(c=setInterval(function(){for(var a=d.length-1;a>=0;a--){var b=d[a],c=b[0],f=b[1];(!f||("true"==PaperScript.getAttribute(f,"keepalive")||e)&&DomElement.isInView(f))&&(d.splice(a,1),c(Date.now()))}},1e3/60))))}};var View=this.View=Base.extend(Callback,{initialize:function(a){this._scope=paper,this._project=paper.project,this._element=a;var b;if(this._id=a.getAttribute("id"),null==this._id&&a.setAttribute("id",this._id="view-"+View._id++),DomEvent.add(a,this._viewHandlers),PaperScript.hasAttribute(a,"resize")){var c=DomElement.getOffset(a,!0),d=this;b=DomElement.getViewportBounds(a).getSize().subtract(c),this._windowHandlers={resize:function(){DomElement.isInvisible(a)||(c=DomElement.getOffset(a,!0)),d.setViewSize(DomElement.getViewportBounds(a).getSize().subtract(c))}},DomEvent.add(window,this._windowHandlers)}else b=Size.create(parseInt(a.getAttribute("width"),10),parseInt(a.getAttribute("height"),10)),b.isNaN()&&(b=DomElement.getSize(a));if(a.width=b.width,a.height=b.height,PaperScript.hasAttribute(a,"stats")){this._stats=new Stats;var e=this._stats.domElement,f=e.style,c=DomElement.getOffset(a);f.position="absolute",f.left=c.x+"px",f.top=c.y+"px",document.body.appendChild(e)}View._views.push(this),View._viewsById[this._id]=this,this._viewSize=LinkedSize.create(this,"setViewSize",b.width,b.height),this._matrix=new Matrix,this._zoom=1,View._focused||(View._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return this._project?(View._focused==this&&(View._focused=null),View._views.splice(View._views.indexOf(this),1),delete View._viewsById[this._id],this._project.view==this&&(this._project.view=null),DomEvent.remove(this._element,this._viewHandlers),DomEvent.remove(window,this._windowHandlers),this._element=this._project=null,this.detach("frame"),this._frameItems={},!0):!1},_events:{onFrame:{install:function(){this._requested||(this._animate=!0,this._handleFrame(!0))},uninstall:function(){this._animate=!1}},onResize:{}},_animate:!1,_time:0,_count:0,_handleFrame:function(a){if(this._requested=!1,this._animate){if(paper=this._scope,a){this._requested=!0;var b=this;DomEvent.requestAnimationFrame(function(){b._handleFrame(!0)},this._element)}var c=Date.now()/1e3,d=this._before?c-this._before:0;this._before=c,this._handlingFrame=!0,this.fire("frame",Base.merge({delta:d,time:this._time+=d,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.draw(!0)}},_animateItem:function(a,b){var c=this._frameItems;b?(c[a._id]={item:a,time:0,count:0},1==++this._frameItemCount&&this.attach("frame",this._handleFrameItems)):(delete c[a._id],0==--this._frameItemCount&&this.detach("frame",this._handleFrameItems))},_handleFrameItems:function(a){for(var b in this._frameItems){var c=this._frameItems[b];c.item.fire("frame",Base.merge(a,{time:c.time+=a.delta,count:c.count++}))}},_redraw:function(){this._redrawNeeded=!0,this._handlingFrame||(this._animate?this._handleFrame():this.draw())},_transform:function(a){this._matrix.concatenate(a),this._bounds=null,this._inverse=null,this._redraw()},getElement:function(){return this._element},getViewSize:function(){return this._viewSize},setViewSize:function(a){a=Size.read(arguments);var b=a.subtract(this._viewSize);b.isZero()||(this._element.width=a.width,this._element.height=a.height,this._viewSize.set(a.width,a.height,!0),this._bounds=null,this.fire("resize",{size:a,delta:b}),this._redraw())},getBounds:function(){return this._bounds||(this._bounds=this._getInverse()._transformBounds(new Rectangle(new Point,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){this.scrollBy(Point.read(arguments).subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(a){this._transform((new Matrix).scale(a/this._zoom,this.getCenter())),this._zoom=a},isVisible:function(){return DomElement.isInView(this._element)},scrollBy:function(){this._transform((new Matrix).translate(Point.read(arguments).negate()))},projectToView:function(){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(){return this._getInverse()._transformPoint(Point.read(arguments))},_getInverse:function(){return this._inverse||(this._inverse=this._matrix.inverted()),this._inverse}},{statics:{_views:[],_viewsById:{},_id:0,create:function(a){return"string"==typeof a&&(a=document.getElementById(a)),new CanvasView(a)}}},new function(){function a(a){var b=DomEvent.getTarget(a);return b.getAttribute&&View._viewsById[b.getAttribute("id")]}function b(a,b){return a.viewToProject(DomEvent.getOffset(b,a._element))}function c(){if(!View._focused||!View._focused.isVisible())for(var a=0,b=View._views.length;b>a;a++){var c=View._views[a];if(c&&c.isVisible()){View._focused=j=c;break}}}function d(c){var d=View._focused=a(c),e=b(d,c);k=!0,d._onMouseDown&&d._onMouseDown(c,e),(h=d._scope._tool)&&h._onHandleEvent("mousedown",e,c),d.draw(!0)}function e(d){var e;if(k||(e=a(d),e?(i=View._focused,View._focused=j=e):j&&j==View._focused&&(View._focused=i,c())),e=e||View._focused){var f=d&&b(e,d);e._onMouseMove&&e._onMouseMove(d,f),(h=e._scope._tool)&&h._onHandleEvent(k&&h.responds("mousedrag")?"mousedrag":"mousemove",f,d)&&DomEvent.stop(d),e.draw(!0)}}function f(a){var c=View._focused;if(c&&k){var d=b(c,a);curPoint=null,k=!1,c._onMouseUp&&c._onMouseUp(a,d),h&&h._onHandleEvent("mouseup",d,a)&&DomEvent.stop(a),c.draw(!0)}}function g(a){k&&DomEvent.stop(a)}var h,i,j,k=!1;return DomEvent.add(document,{mousemove:e,mouseup:f,touchmove:e,touchend:f,selectstart:g,scroll:c}),DomEvent.add(window,{load:c}),{_viewHandlers:{mousedown:d,touchstart:d,selectstart:g},statics:{updateFocus:c}}}),CanvasView=View.extend({initialize:function(a){if(!(a instanceof HTMLCanvasElement)){var b=Size.read(arguments,1);b.isZero()&&(b=Size.create(1024,768)),a=CanvasProvider.getCanvas(b)}this._context=a.getContext("2d"),this._eventCounters={},this.base(a)},draw:function(a){if(a&&!this._redrawNeeded)return!1;var b=this._context,c=this._viewSize;return b.clearRect(0,0,c._width+1,c._height+1),this._project.draw(b,this._matrix),this._redrawNeeded=!1,!0}},new function(){function a(a,b,c,d,e,f){for(var g,h=d;h;){if(h.responds(a)&&(g||(g=new MouseEvent(a,b,c,d,e?c.subtract(e):null)),h.fire(a,g)&&(!f||g._stopped)))return!1;h=h.getParent()}return!0}function b(b,c,d,e,f){if(b._eventCounters[c]){var g=b._project,j=g.hitTest(e,{tolerance:g.options.hitTolerance||0,fill:!0,stroke:!0}),k=j&&j.item;if(k)return"mousemove"===c&&k!=h&&(f=e),"mousemove"===c&&i||a(c,d,e,k,f),k}}var c,d,e,f,g,h,i,j,k;return{_onMouseDown:function(a,h){var l=b(this,"mousedown",a,h);j=g==l&&Date.now()-k<300,f=g=l,c=d=e=h,i=f&&f.responds("mousedrag")},_onMouseUp:function(g,h){var l=b(this,"mouseup",g,h);i&&(d&&!d.equals(h)&&a("mousedrag",g,h,f,d),l!=f&&(e=h,a("mousemove",g,h,l,e))),l===f&&(k=Date.now(),(!j||a("doubleclick",g,c,l))&&a("click",g,c,l),j=!1),f=null,i=!1},_onMouseMove:function(c,g){f&&a("mousedrag",c,g,f,d);var i=b(this,"mousemove",c,g,e);d=e=g,i!==h&&(a("mouseleave",c,g,h),h=i,a("mouseenter",c,g,i))}}}),Event=this.Event=Base.extend({initialize:function(a){this.event=a},preventDefault:function(){this._prevented=!0,DomEvent.preventDefault(this.event)},stopPropagation:function(){this._stopped=!0,DomEvent.stopPropagation(this.event)},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return Key.modifiers}}),KeyEvent=this.KeyEvent=Event.extend({initialize:function(a,b,c,d){this.base(d),this.type=a?"keydown":"keyup",this.key=b,this.character=c},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Key=this.Key=new function(){function a(a,b,d,e){var g=String.fromCharCode(d),h=c[b]||g.toLowerCase(),i=a?"keydown":"keyup",j=View._focused,k=j&&j.isVisible()&&j._scope,l=k&&k._tool;f[h]=a,l&&l.responds(i)&&(l.fire(i,new KeyEvent(a,h,g,e)),j&&j.draw(!0))}var b,c={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},d=Base.merge({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),e={},f={};return DomEvent.add(document,{keydown:function(f){var g,h=f.which||f.keyCode,i=c[h];i?((g=Base.camelize(i))in d&&(d[g]=!0),e[h]=0,a(!0,h,null,f)):b=h},keypress:function(c){if(null!=b){var d=c.which||c.keyCode;e[b]=d,a(!0,b,d,c),b=null}},keyup:function(b){var f,g=b.which||b.keyCode,h=c[g];h&&(f=Base.camelize(h))in d&&(d[f]=!1),null!=e[g]&&(a(!1,g,e[g],b),delete e[g])}}),{modifiers:d,isDown:function(a){return!!f[a]}}},MouseEvent=this.MouseEvent=Event.extend({initialize:function(a,b,c,d,e){this.base(b),this.type=a,this.point=c,this.target=d,this.delta=e},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Palette=this.Palette=Base.extend(Callback,{_events:["onChange"],initialize:function(a,b,c){var d=DomElement.find(".palettejs-panel")||DomElement.find("body").appendChild(DomElement.create("div",{"class":"palettejs-panel"}));this._element=d.appendChild(DomElement.create("table",{"class":"palettejs-pane"})),this._title=a,c||(c={});for(var e in this._components=b){var f=b[e];f instanceof Component||(null==f.value&&(f.value=c[e]),f.name=e,f=b[e]=new Component(f)),this._element.appendChild(f._element),f._palette=this,void 0===c[e]&&(c[e]=f.value)}this._values=Base.each(c,function(a,d){var e=b[d];e&&Base.define(c,d,{enumerable:!0,configurable:!0,writable:!0,get:function(){return e._value},set:function(a){e.setValue(a)}})}),window.paper&&paper.palettes.push(this)},reset:function(){for(var a in this._components)this._components[a].reset()},remove:function(){DomElement.remove(this._element)}}),Component=this.Component=Base.extend(Callback,{_events:["onChange","onClick"],_types:{"boolean":{type:"checkbox",value:"checked"},string:{type:"text"},number:{type:"number",number:!0},button:{type:"button"},text:{tag:"div",value:"text"},slider:{type:"range",number:!0},list:{tag:"select",options:function(){DomElement.removeChildren(this._inputItem),DomElement.create(Base.each(this._options,function(a){this.push("option",{value:a,text:a})},[]),this._inputItem)}}},initialize:function(a){this._type=a.type in this._types?a.type:"options"in a?"list":"onClick"in a?"button":typeof a.value,this._info=this._types[this._type]||{type:this._type};var b=this,c=!1;this._inputItem=DomElement.create(this._info.tag||"input",{type:this._info.type,events:{change:function(){b.setValue(DomElement.get(this,b._info.value||"value")),c&&(b._palette.fire("change",b,b.name,b._value),b.fire("change",b._value))},click:function(){b.fire("click")}}}),this._element=DomElement.create("tr",[this._labelItem=DomElement.create("td"),"td",[this._inputItem]]),Base.each(a,function(a,b){this[b]=a},this),this._defaultValue=this._value,c=!0},getType:function(){return this._type},getLabel:function(){return this._label},setLabel:function(a){this._label=a,DomElement.set(this._labelItem,"text",a+":")},getOptions:function(){return this._options},setOptions:function(a){this._options=a,this._info.options&&this._info.options.call(this)},getValue:function(){return this._value},setValue:function(a){var b=this._info.value||"value";DomElement.set(this._inputItem,b,a),a=DomElement.get(this._inputItem,b),this._value=this._info.number?parseFloat(a,10):a},getRange:function(){return[parseFloat(DomElement.get(this._inputItem,"min")),parseFloat(DomElement.get(this._inputItem,"max"))]},setRange:function(a,b){var c=Array.isArray(a)?a:[a,b];DomElement.set(this._inputItem,{min:c[0],max:c[1]})},getMin:function(){return this.getRange()[0]},setMin:function(a){this.setRange(a,this.getMax())},getMax:function(){return this.getRange()[1]},setMax:function(a){this.setRange(this.getMin(),a)},getStep:function(){return parseFloat(DomElement.get(this._inputItem,"step"))},setStep:function(a){DomElement.set(this._inputItem,"step",a)},reset:function(){this.setValue(this._defaultValue)}}),ToolEvent=this.ToolEvent=Event.extend({_item:null,initialize:function(a,b,c){this.tool=a,this.type=b,this.event=c},_choosePoint:function(a,b){return a?a:b?b.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(a){this._downPoint=a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this.middlePoint},setMiddlePoint:function(a){this._middlePoint=a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=a},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){for(var b=a.item,c=b._parent;/^(group|compound-path)$/.test(c._type);)b=c,c=c._parent;this._item=b}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Tool=this.Tool=PaperScopeItem.extend({_list:"tools",_reference:"_tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(a){this.base(),this._firstMove=!0,this._count=0,this._downCount=0,this._set(a)},getMinDistance:function(){return this._minDistance},setMinDistance:function(a){this._minDistance=a,null!=this._minDistance&&null!=this._maxDistance&&this._minDistance>this._maxDistance&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(a){this._maxDistance=a,null!=this._minDistance&&null!=this._maxDistance&&this._maxDistance<this._minDistance&&(this._minDistance=a)
},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._minDistance=a,this._maxDistance=a},_updateEvent:function(a,b,c,d,e,f,g){if(!e){if(null!=c||null!=d){var h=null!=c?c:0,i=b.subtract(this._point),j=i.getLength();if(h>j)return!1;var k=null!=d?d:0;if(0!=k)if(j>k)b=this._point.add(i.normalize(k));else if(g)return!1}if(f&&b.equals(this._point))return!1}switch(this._lastPoint=e&&"mousemove"==a?b:this._point,this._point=b,a){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=e?0:this._count+1,!0},fire:function(a,b){var c=Tool._removeSets;if(c){"mouseup"===a&&(c.mousedrag=null);var d=c[a];if(d){for(var e in d){var f=d[e];for(var g in c){var h=c[g];h&&h!=d&&delete h[f._id]}f.remove()}c[a]=null}}return this.base(a,b)},_onHandleEvent:function(a,b,c){paper=this._scope;var d=!1;switch(a){case"mousedown":this._updateEvent(a,b,null,null,!0,!1,!1),this.responds(a)&&(d=this.fire(a,new ToolEvent(this,a,c)));break;case"mousedrag":for(var e=!1,f=!1;this._updateEvent(a,b,this.minDistance,this.maxDistance,!1,e,f);)this.responds(a)&&(d=this.fire(a,new ToolEvent(this,a,c))),e=!0,f=!0;break;case"mouseup":!b.equals(this._point)&&this._updateEvent("mousedrag",b,this.minDistance,this.maxDistance,!1,!1,!1)&&this.responds("mousedrag")&&(d=this.fire("mousedrag",new ToolEvent(this,a,c))),this._updateEvent(a,b,null,this.maxDistance,!1,!1,!1),this.responds(a)&&(d=this.fire(a,new ToolEvent(this,a,c))),this._updateEvent(a,b,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(a,b,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)this.responds(a)&&(d=this.fire(a,new ToolEvent(this,a,c))),this._firstMove=!1}return d}}),CanvasProvider={canvases:[],getCanvas:function(a,b){var c=void 0===b?a:Size.create(a,b);if(this.canvases.length){var d=this.canvases.pop();return d.width!=c.width||d.height!=c.height?(d.width=c.width,d.height=c.height):d.getContext("2d").clearRect(0,0,c.width+1,c.height+1),d}var d=document.createElement("canvas");return d.width=c.width,d.height=c.height,d},getContext:function(a,b){return this.getCanvas(a,b).getContext("2d")},release:function(a){this.canvases.push(a.canvas?a.canvas:a)}},BlendMode={process:function(a,b,c,d,e){function f(a,b,c){return.2989*a+.587*b+.114*c}function g(a,b,c,d){var e=d-f(a,b,c);r=a+e,s=b+e,t=c+e;var d=f(r,s,t),g=y(r,s,t),h=z(r,s,t);if(0>g){var i=d-g;r=d+(r-d)*d/i,s=d+(s-d)*d/i,t=d+(t-d)*d/i}if(h>255){var j=255-d,k=h-d;r=d+(r-d)*j/k,s=d+(s-d)*j/k,t=d+(t-d)*j/k}}function h(a,b,c){return z(a,b,c)-y(a,b,c)}function i(a,b,c,d){var e,f=[a,b,c],g=z(a,b,c),h=y(a,b,c);h=h==a?0:h==b?1:2,g=g==a?0:g==b?1:2,e=0==y(h,g)?1==z(h,g)?2:1:0,f[g]>f[h]?(f[e]=(f[e]-f[h])*d/(f[g]-f[h]),f[g]=d):f[e]=f[g]=0,f[h]=0,r=f[0],s=f[1],t=f[2]}var j,k,l,m,n,o,p,q,r,s,t,u=b.canvas,v=c.getImageData(e.x,e.y,u.width,u.height),w=v.data,x=b.getImageData(0,0,u.width,u.height).data,y=Math.min,z=Math.max,A=Math.abs,B={multiply:function(){r=n*j/255,s=o*k/255,t=p*l/255},screen:function(){r=255-(255-n)*(255-j)/255,s=255-(255-o)*(255-k)/255,t=255-(255-p)*(255-l)/255},overlay:function(){r=128>n?2*n*j/255:255-2*(255-n)*(255-j)/255,s=128>o?2*o*k/255:255-2*(255-o)*(255-k)/255,t=128>p?2*p*l/255:255-2*(255-p)*(255-l)/255},"soft-light":function(){var a=j*n/255;r=a+n*(255-(255-n)*(255-j)/255-a)/255,a=k*o/255,s=a+o*(255-(255-o)*(255-k)/255-a)/255,a=l*p/255,t=a+p*(255-(255-p)*(255-l)/255-a)/255},"hard-light":function(){r=128>j?2*j*n/255:255-2*(255-j)*(255-n)/255,s=128>k?2*k*o/255:255-2*(255-k)*(255-o)/255,t=128>l?2*l*p/255:255-2*(255-l)*(255-p)/255},"color-dodge":function(){r=255==j?j:y(255,255*n/(255-j)),s=255==k?k:y(255,255*o/(255-k)),t=255==l?l:y(255,255*p/(255-l))},"color-burn":function(){r=0==j?0:z(255-255*(255-n)/j,0),s=0==k?0:z(255-255*(255-o)/k,0),t=0==l?0:z(255-255*(255-p)/l,0)},darken:function(){r=j>n?n:j,s=k>o?o:k,t=l>p?p:l},lighten:function(){r=n>j?n:j,s=o>k?o:k,t=p>l?p:l},difference:function(){r=n-j,0>r&&(r=-r),s=o-k,0>s&&(s=-s),t=p-l,0>t&&(t=-t)},exclusion:function(){r=n+j*(255-n-n)/255,s=o+k*(255-o-o)/255,t=p+l*(255-p-p)/255},hue:function(){i(j,k,l,h(n,o,p)),g(r,s,t,f(n,o,p))},saturation:function(){i(n,o,p,h(j,k,l)),g(r,s,t,f(n,o,p))},luminosity:function(){g(n,o,p,f(j,k,l))},color:function(){g(j,k,l,f(n,o,p))},add:function(){r=y(n+j,255),s=y(o+k,255),t=y(p+l,255)},subtract:function(){r=z(n-j,0),s=z(o-k,0),t=z(p-l,0)},average:function(){r=(n+j)/2,s=(o+k)/2,t=(p+l)/2},negation:function(){r=255-A(255-j-n),s=255-A(255-k-o),t=255-A(255-l-p)}},C=B[a];if(C){for(var D=0,E=w.length;E>D;D+=4){j=x[D],n=w[D],k=x[D+1],o=w[D+1],l=x[D+2],p=w[D+2],m=x[D+3],q=w[D+3],C();var F=m*d/255,G=1-F;w[D]=F*r+G*n,w[D+1]=F*s+G*o,w[D+2]=F*t+G*p,w[D+3]=m*d+G*q}c.putImageData(v,e.x,e.y)}}},SVGStyles=Base.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"]},function(a,b){var c=Base.capitalize(b);this[b]={type:a[1],property:b,attribute:a[0],get:"get"+c,set:"set"+c}},{});!new function(){function a(a,b){for(var c in b){var d=b[c],e=w[c];"number"==typeof d&&(d=v.number(d)),e?a.setAttributeNS(e,c,d):a.setAttribute(c,d)}return a}function b(b,c){return a(document.createElementNS("http://www.w3.org/2000/svg",b),c)}function c(a,b,c){return a[b]._point.getDistance(a[c]._point)}function d(a,b){var c=a._matrix,d=c.getTranslation(),e={};if(b){c=c.shiftless();var f=c._inverseTransform(d);e.x=f.x,e.y=f.y,d=null}if(c.isIdentity())return e;var g=c.decompose();if(g&&!g.shearing){var h=[],i=g.rotation,j=g.scaling;d&&!d.isZero()&&h.push("translate("+v.point(d)+")"),Numerical.isZero(j.x-1)&&Numerical.isZero(j.y-1)||h.push("scale("+v.point(j)+")"),i&&h.push("rotate("+v.number(i)+")"),e.transform=h.join(" ")}else e.transform="matrix("+c.getValues().join(",")+")";return e}function e(a,b,c,d){var e="rect"===c?b[1]._point.add(b[2]._point).divide(2):"roundrect"===c?b[3]._point.add(b[4]._point).divide(2):"circle"===c||"ellipse"===c?b[1]._point:null,f=e&&e.subtract(d).getAngle()+90;return Numerical.isZero(f||0)?0:f}function f(a,b){function d(a,c){var d=b[a],e=d.getNext(),f=b[c],g=f.getNext();return d._handleOut.isZero()&&e._handleIn.isZero()&&f._handleOut.isZero()&&g._handleIn.isZero()&&e._point.subtract(d._point).isColinear(g._point.subtract(f._point))}function e(a){var c=b[a],d=c.getNext(),e=c._handleOut,f=d._handleIn,g=Numerical.KAPPA;if(e.isOrthogonal(f)){var h=c._point,i=d._point,j=new Line(h,e).intersect(new Line(i,f));return j&&Numerical.isZero(e.getLength()/j.subtract(h).getLength()-g)&&Numerical.isZero(f.getLength()/j.subtract(i).getLength()-g)}}if(a.isPolygon())return 4===b.length&&a._closed&&d(0,2)&&d(1,3)?"rect":0===b.length?"empty":b.length>=3?a._closed?"polygon":"polyline":"line";if(a._closed){if(8===b.length&&e(0)&&e(2)&&e(4)&&e(6)&&d(1,5)&&d(3,7))return"roundrect";if(4===b.length&&e(0)&&e(1)&&e(2)&&e(3))return Numerical.isZero(c(b,0,2)-c(b,1,3))?"circle":"ellipse"}return"path"}function g(a){var c=d(a),e=a._children;c.fill="none";for(var f=b("g",c),g=0,h=e.length;h>g;g++){var i=t(e[g]);i&&f.appendChild(i)}return f}function h(a){var c=d(a,!0),e=a.getSize();return c.x-=e.width/2,c.y-=e.height/2,c.width=e.width,c.height=e.height,c.href=a.toDataURL(),b("image",c)}function j(a){var c=d(a,!0),e=a._style,f=e.getFont(),g=e.getFontSize();f&&(c["font-family"]=f),g&&(c["font-size"]=g);var h=b("text",c);return h.textContent=a._content,h}function k(a){var d,g=a._segments,h=a.getPosition(!0),j=f(a,g),k=e(a,g,j,h);switch(j){case"empty":return null;case"path":var m=a.getPathData();d=m&&{d:m};break;case"polyline":case"polygon":var n=[];for(i=0,l=g.length;l>i;i++)n.push(v.point(g[i]._point));d={points:n.join(" ")};break;case"rect":var o=c(g,0,3),p=c(g,0,1),q=g[1]._point.rotate(-k,h);d={x:q.x,y:q.y,width:o,height:p};break;case"roundrect":j="rect";var o=c(g,1,6),p=c(g,0,3),r=(o-c(g,0,7))/2,s=(p-c(g,1,2))/2,t=g[3]._point,u=g[4]._point,q=t.subtract(u.subtract(t).normalize(r)).rotate(-k,h);d={x:q.x,y:q.y,width:o,height:p,rx:r,ry:s};break;case"line":var w=g[0]._point,x=g[g.length-1]._point;d={x1:w._x,y1:w._y,x2:x._x,y2:x._y};break;case"circle":var y=c(g,0,2)/2;d={cx:h.x,cy:h.y,r:y};break;case"ellipse":var r=c(g,2,0)/2,s=c(g,3,1)/2;d={cx:h.x,cy:h.y,rx:r,ry:s}}return k&&(d.transform="rotate("+v.number(k)+","+v.point(h)+")",a._gradientMatrix=(new Matrix).rotate(-k,h)),b(j,d)}function m(a){var c=d(a,!0),e=a.getPathData();return e&&(c.d=e),b("path",c)}function n(a){var c=d(a,!0),e=a.getSymbol(),f=q(e);return definition=e.getDefinition(),bounds=definition.getBounds(),f||(f=b("symbol",{viewBox:v.rectangle(bounds)}),f.appendChild(t(definition)),r(e,f)),c.href="#"+f.id,c.x+=bounds.x,c.y+=bounds.y,c.width=v.number(bounds.width),c.height=v.number(bounds.height),b("use",c)}function o(a,c){var d=q(a);if(!d){var e,f=a.getGradient(),g=f._radial,h=c._gradientMatrix,i=a.getOrigin().transform(h),j=a.getDestination().transform(h);if(g){e={cx:i.x,cy:i.y,r:i.getDistance(j)};var k=a.getHighlight();k&&(k=k.transform(h),e.fx=k.x,e.fy=k.y)}else e={x1:i.x,y1:i.y,x2:j.x,y2:j.y};e.gradientUnits="userSpaceOnUse",d=b((g?"radial":"linear")+"Gradient",e);for(var l=f._stops,m=0,n=l.length;n>m;m++){var o=l[m],p=o._color,s=p.getAlpha();e={offset:o._rampPoint,"stop-color":p.toCss(!0)},1>s&&(e["stop-opacity"]=s),d.appendChild(b("stop",e))}r(a,d)}return"url(#"+d.id+")"}function p(b,c){var d={},e=b._style,f=b.getParent(),g=f&&f._style;return null!=b._name&&(d.id=b._name),Base.each(SVGStyles,function(a){var c=e[a.get]();if(!g||!Base.equals(g[a.get](),c)){if("color"===a.type&&null!=c){var f=c.getAlpha();1>f&&(d[a.attribute+"-opacity"]=f)}d[a.attribute]=null==c?"none":"color"===a.type?c.gradient?o(c,b):c.toCss(!0):"array"===a.type?c.join(","):"number"===a.type?v.number(c):c}}),null!=b._opacity&&b._opacity<1&&(d.opacity=b._opacity),null==b._visibility||b._visibility||(d.visibility="hidden"),delete b._gradientMatrix,a(c,d)}function q(a){return u||(u={ids:{},svgs:{}}),u.svgs[a._id]}function r(a,b){var c=a._type,d=u.ids[c]=(u.ids[c]||0)+1;b.id=c+"-"+d,u.svgs[a._id]=b}function s(a){if(!u)return a;var c="svg"==a.nodeName&&a,d=c?c.firstChild:a;for(var e in u.svgs)c||(c=b("svg"),c.appendChild(a)),c.insertBefore(u.svgs[e],d);return u=null,c}function t(a){var b=x[a._type],c=b&&b(a,a._type);return c&&a._data&&c.setAttribute("data-paper-data",JSON.stringify(a._data)),c&&p(a,c)}var u,v=Formatter.instance,w={href:"http://www.w3.org/1999/xlink"},x={group:g,layer:g,raster:h,path:k,"point-text":j,"placed-symbol":n,"compound-path":m};Item.inject({exportSVG:function(){var a=t(this);return s(a)}}),Project.inject({exportSVG:function(){for(var a=b("svg"),c=this.layers,d=0,e=c.length;e>d;d++)a.appendChild(t(c[d]));return s(a)}})},new function(){function a(a,b,c,d){var e=(!c||null!=a.getAttribute(b))&&a[b]&&a[b].baseVal;return e?void 0!==d?d<e.numberOfItems?Base.pick((e=e.getItem(d)).value,e):null:Base.pick(e.value,e):null}function b(b,c,d,e,f){return c=a(b,c,e,f),d=a(b,d,e,f),e&&null==c&&null==d?null:Point.create(c||0,d||0)}function c(b,c,d,e,f){return c=a(b,c,e,f),d=a(b,d,e,f),e&&null==c&&null==d?null:Size.create(c||0,d||0)}function d(a,b){return"none"===a?null:"number"===b?parseFloat(a):"array"===b?a?a.split(/[\s,]+/g).map(parseFloat):[]:"color"===b&&m(a)||a}function e(a,b){var c=a.childNodes,d="clipPath"===b,e=d?new CompoundPath:new Group,f=e._project,g=f._currentStyle;e.setFillColor("black"),d||(e=l(e,a),f._currentStyle=e._style.clone());for(var h=0,i=c.length;i>h;h++){var j,k=c[h];1==k.nodeType&&(j=n(k))&&(d&&"compound-path"===j._type?(e.addChildren(j.removeChildren()),j.remove()):j instanceof Symbol||e.addChild(j))}return d&&(e=l(e.reduce(),a)),f._currentStyle=g,(d||"defs"===b)&&(e.remove(),e=null),e}function f(a,b){var c=new Path,d=a.points;c.moveTo(d.getItem(0));for(var e=1,f=d.numberOfItems;f>e;e++)c.lineTo(d.getItem(e));return"polygon"===b&&c.closePath(),c}function g(a){var b=a.getAttribute("d"),c=b.match(/m/gi).length>1?new CompoundPath:new Path;return c.setPathData(b),c}function h(c,d){for(var e=c.childNodes,f=[],g=0,h=e.length;h>g;g++){var i=e[g];1==i.nodeType&&f.push(l(new GradientStop,i))}var j,k,m,n="radialGradient"===d,o=new Gradient(f,n);return n?(j=b(c,"cx","cy"),k=j.add(a(c,"r"),0),m=b(c,"fx","fy",!0)):(j=b(c,"x1","y1"),k=b(c,"x2","y2")),l(new Color(o,j,k,m),c),null}function i(a,b,c,d){for(var e=d[c].baseVal,f=new Matrix,g=0,h=e.numberOfItems;h>g;g++){var i=e.getItem(g).matrix;f.concatenate(new Matrix(i.a,i.b,i.c,i.d,i.e,i.f))}a.transform(f)}function j(a,b,c){var d=a._style["fill-opacity"===c?"getFillColor":"getStrokeColor"]();d&&d.setAlpha(parseFloat(b))}function k(a,b,c){var d=a.attributes[b],e=d&&d.value;if(!e){var f=Base.camelize(b);e=a.style[f],e||c.node[f]===c.parent[f]||(e=c.node[f])}return e?"none"===e?null:e:void 0}function l(a,b){var c={node:DomElement.getStyles(b)||{},parent:DomElement.getStyles(b.parentNode)||{}};return Base.each(p,function(d,e){var f=k(b,e,c);void 0!==f&&(a=Base.pick(d(a,f,e,b,c),a))}),a}function m(a){var b=a&&a.match(/\((?:#|)([^)']+)/);return b&&q[b[1]]}function n(a,b){var c=a.nodeName,d=o[c],e=d&&d(a,c),f=a.getAttribute("data-paper-data");return e&&"group"!==e._type&&(e=l(e,a)),e&&f&&(e._data=JSON.parse(f)),b&&(q={}),e}var o={g:e,svg:e,clipPath:e,polygon:f,polyline:f,path:g,linearGradient:h,radialGradient:h,image:function(d){var e=new Raster(a(d,"href"));return e.attach("load",function(){var a=c(d,"width","height");this.setSize(a),this.translate(b(d,"x","y").add(a.divide(2)))}),e},symbol:function(a,b){return new Symbol(e(a,b),!0)},defs:e,use:function(c){var d=(a(c,"href")||"").substring(1),e=q[d],f=b(c,"x","y");return e?e instanceof Symbol?e.place(f):e.clone().translate(f):null},circle:function(c){return new Path.Circle(b(c,"cx","cy"),a(c,"r"))},ellipse:function(a){var d=b(a,"cx","cy"),e=c(a,"rx","ry");return new Path.Ellipse(new Rectangle(d.subtract(e),d.add(e)))},rect:function(a){var d=b(a,"x","y"),e=c(a,"width","height"),f=c(a,"rx","ry");return new Path.Rectangle(new Rectangle(d,e),f)},line:function(a){return new Path.Line(b(a,"x1","y1"),b(a,"x2","y2"))},text:function(a){var c=new PointText(b(a,"x","y",!1,0).add(b(a,"dx","dy",!1,0)));return c.setContent(a.textContent.trim()||""),c}},p=Base.each(SVGStyles,function(a){this[a.attribute]=function(b,c){b._style[a.set](d(c,a.type))}},{id:function(a,b){q[b]=a,a.setName&&a.setName(b)},"clip-path":function(a,b){var c=m(b);return c?(c=c.clone(),c.setClipMask(!0),new Group(c,a)):void 0},gradientTransform:i,transform:i,opacity:function(a,b){a.setOpacity(parseFloat(b))},"fill-opacity":j,"stroke-opacity":j,"font-family":function(a,b){a.setFont(b.split(",")[0].replace(/^\s+|\s+$/g,""))},"font-size":function(a,b){a.setFontSize(parseFloat(b))},"text-anchor":function(a,b){a.setJustification({start:"left",middle:"center",end:"right"}[b])},visibility:function(a,b){a.setVisible("visible"===b)},"stop-color":function(a,b){a.setColor(b)},"stop-opacity":function(a,b){a._color&&a._color.setAlpha(parseFloat(b))},offset:function(a,b){var c=b.match(/(.*)%$/);a.setRampPoint(c?c[1]/100:b)},viewBox:function(a,b,e,f,g){var h=Rectangle.create.apply(this,d(b,"array")),i=c(f,"width","height",!0);if(a instanceof Group){var j=i?h.getSize().divide(i):1,l=(new Matrix).translate(h.getPoint()).scale(j);a.transform(l.inverted())}else if(a instanceof Symbol){i&&h.setSize(i);var m="visible"!=k(f,"overflow",g),n=a._definition;m&&!h.contains(n.getBounds())&&(m=new Path.Rectangle(h).transform(n._matrix),m.setClipMask(!0),n.addChild(m))}}}),q={};Item.inject({importSVG:function(a){return this.addChild(n(a,!0))}}),Project.inject({importSVG:function(a){return this.activate(),n(a,!0)}})},function(a){"use strict";function b(a){nb=a||{};for(var b in rb)nb.hasOwnProperty(b)||(nb[b]=rb[b]);qb=nb.sourceFile||null}function c(a,b){var c=sb(ob,a);b+=" ("+c.line+":"+c.column+")";var d=new SyntaxError(b);throw d.pos=a,d.loc=c,d.raisedAt=tb,d}function d(a){function b(a){if(1==a.length)return c+="return str === "+JSON.stringify(a[0])+";";c+="switch(str){";for(var b=0;a.length>b;++b)c+="case "+JSON.stringify(a[b])+":";c+="return true}return false;"}a=a.split(" ");var c="",d=[];a:for(var e=0;a.length>e;++e){for(var f=0;d.length>f;++f)if(d[f][0].length==a[e].length){d[f].push(a[e]);continue a}d.push([a[e]])}if(d.length>3){d.sort(function(a,b){return b.length-a.length}),c+="switch(str.length){";for(var e=0;d.length>e;++e){var g=d[e];c+="case "+g[0].length+":",b(g)}c+="}"}else b(a);return Function("str",c)}function e(a){return 65>a?36===a:91>a?!0:97>a?95===a:123>a?!0:a>=170&&Wc.test(String.fromCharCode(a))}function f(a){return 48>a?36===a:58>a?!0:65>a?!1:91>a?!0:97>a?95===a:123>a?!0:a>=170&&Xc.test(String.fromCharCode(a))}function g(){this.line=Bb,this.column=tb-Cb}function h(){Bb=1,tb=Cb=0,Ab=!0,l()}function i(a,b){vb=tb,nb.locations&&(xb=new g),yb=a,l(),zb=b,Ab=a.beforeExpr}function j(){var a=nb.onComment&&nb.locations&&new g,b=tb,d=ob.indexOf("*/",tb+=2);if(-1===d&&c(tb-2,"Unterminated comment"),tb=d+2,nb.locations){Zc.lastIndex=b;for(var e;(e=Zc.exec(ob))&&tb>e.index;)++Bb,Cb=e.index+e[0].length}nb.onComment&&nb.onComment(!0,ob.slice(b+2,d),b,tb,a,nb.locations&&new g)}function k(){for(var a=tb,b=nb.onComment&&nb.locations&&new g,c=ob.charCodeAt(tb+=2);pb>tb&&10!==c&&13!==c&&8232!==c&&8329!==c;)++tb,c=ob.charCodeAt(tb);nb.onComment&&nb.onComment(!1,ob.slice(a+2,tb),a,tb,b,nb.locations&&new g)}function l(){for(;pb>tb;){var a=ob.charCodeAt(tb);if(32===a)++tb;else if(13===a){++tb;var b=ob.charCodeAt(tb);10===b&&++tb,nb.locations&&(++Bb,Cb=tb)}else if(10===a)++tb,++Bb,Cb=tb;else if(14>a&&a>8)++tb;else if(47===a){var b=ob.charCodeAt(tb+1);if(42===b)j();else{if(47!==b)break;k()}}else if(14>a&&a>8||32===a||160===a)++tb;else{if(!(a>=5760&&Tc.test(String.fromCharCode(a))))break;++tb}}}function m(){var a=ob.charCodeAt(tb+1);return a>=48&&57>=a?A(!0):(++tb,i(vc))}function n(){var a=ob.charCodeAt(tb+1);return Ab?(++tb,x()):61===a?w(zc,2):w(xc,1)}function o(){var a=ob.charCodeAt(tb+1);return 61===a?w(zc,2):w(Lc,1)}function p(a){var b=ob.charCodeAt(tb+1);return b===a?w(124===a?Dc:Ec,2):61===b?w(zc,2):w(124===a?Fc:Hc,1)}function q(){var a=ob.charCodeAt(tb+1);return 61===a?w(zc,2):w(Gc,1)}function r(a){var b=ob.charCodeAt(tb+1);return b===a?w(Bc,2):61===b?w(zc,2):w(Ac,1)}function s(a){var b=ob.charCodeAt(tb+1),c=1;return b===a?(c=62===a&&62===ob.charCodeAt(tb+2)?3:2,61===ob.charCodeAt(tb+c)?w(zc,c+1):w(Kc,c)):(61===b&&(c=61===ob.charCodeAt(tb+2)?3:2),w(Jc,c))}function t(a){var b=ob.charCodeAt(tb+1);return 61===b?w(Ic,61===ob.charCodeAt(tb+2)?3:2):w(61===a?yc:Cc,1)}function u(a){switch(a){case 46:return m();case 40:return++tb,i(qc);case 41:return++tb,i(rc);case 59:return++tb,i(tc);case 44:return++tb,i(sc);case 91:return++tb,i(mc);case 93:return++tb,i(nc);case 123:return++tb,i(oc);case 125:return++tb,i(pc);case 58:return++tb,i(uc);case 63:return++tb,i(wc);case 48:var b=ob.charCodeAt(tb+1);if(120===b||88===b)return z();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return A(!1);case 34:case 39:return B(a);case 47:return n(a);case 37:case 42:return o();case 124:case 38:return p(a);case 94:return q();case 43:case 45:return r(a);case 60:case 62:return s(a);case 61:case 33:return t(a);case 126:return w(Cc,1)}return!1}function v(a){if(ub=tb,nb.locations&&(wb=new g),a)return x();if(tb>=pb)return i(Nb);var b=ob.charCodeAt(tb);if(e(b)||92===b)return E();var d=u(b);if(d===!1){var f=String.fromCharCode(b);if("\\"===f||Wc.test(f))return E();c(tb,"Unexpected character '"+f+"'")}return d}function w(a,b){var c=ob.slice(tb,tb+b);tb+=b,i(a,c)}function x(){for(var a,b,d="",e=tb;;){tb>=pb&&c(e,"Unterminated regular expression");var f=ob.charAt(tb);if(Yc.test(f)&&c(e,"Unterminated regular expression"),a)a=!1;else{if("["===f)b=!0;else if("]"===f&&b)b=!1;else if("/"===f&&!b)break;a="\\"===f}++tb}var d=ob.slice(e,tb);++tb;var g=D();return g&&!/^[gmsiy]*$/.test(g)&&c(e,"Invalid regexp flag"),i(Kb,RegExp(d,g))}function y(a,b){for(var c=tb,d=0,e=0,f=null==b?1/0:b;f>e;++e){var g,h=ob.charCodeAt(tb);if(g=h>=97?h-97+10:h>=65?h-65+10:h>=48&&57>=h?h-48:1/0,g>=a)break;++tb,d=d*a+g}return tb===c||null!=b&&tb-c!==b?null:d}function z(){tb+=2;var a=y(16);return null==a&&c(ub+2,"Expected hexadecimal number"),e(ob.charCodeAt(tb))&&c(tb,"Identifier directly after number"),i(Jb,a)}function A(a){var b=tb,d=!1,f=48===ob.charCodeAt(tb);a||null!==y(10)||c(b,"Invalid number"),46===ob.charCodeAt(tb)&&(++tb,y(10),d=!0);var g=ob.charCodeAt(tb);(69===g||101===g)&&(g=ob.charCodeAt(++tb),(43===g||45===g)&&++tb,null===y(10)&&c(b,"Invalid number"),d=!0),e(ob.charCodeAt(tb))&&c(tb,"Identifier directly after number");var h,j=ob.slice(b,tb);return d?h=parseFloat(j):f&&1!==j.length?/[89]/.test(j)||Ib?c(b,"Invalid number"):h=parseInt(j,8):h=parseInt(j,10),i(Jb,h)}function B(a){tb++;for(var b="";;){tb>=pb&&c(ub,"Unterminated string constant");var d=ob.charCodeAt(tb);if(d===a)return++tb,i(Lb,b);if(92===d){d=ob.charCodeAt(++tb);var e=/^[0-7]+/.exec(ob.slice(tb,tb+3));for(e&&(e=e[0]);e&&parseInt(e,8)>255;)e=e.slice(0,e.length-1);if("0"===e&&(e=null),++tb,e)Ib&&c(tb-2,"Octal literal in strict mode"),b+=String.fromCharCode(parseInt(e,8)),tb+=e.length-1;else switch(d){case 110:b+="\n";break;case 114:b+="\r";break;case 120:b+=String.fromCharCode(C(2));break;case 117:b+=String.fromCharCode(C(4));break;case 85:b+=String.fromCharCode(C(8));break;case 116:b+="	";break;case 98:b+="\b";break;case 118:b+="";break;case 102:b+="\f";break;case 48:b+="\x00";break;case 13:10===ob.charCodeAt(tb)&&++tb;case 10:nb.locations&&(Cb=tb,++Bb);break;default:b+=String.fromCharCode(d)}}else(13===d||10===d||8232===d||8329===d)&&c(ub,"Unterminated string constant"),b+=String.fromCharCode(d),++tb}}function C(a){var b=y(16,a);return null===b&&c(ub,"Bad character escape sequence"),b}function D(){Nc=!1;for(var a,b=!0,d=tb;;){var g=ob.charCodeAt(tb);if(f(g))Nc&&(a+=ob.charAt(tb)),++tb;else{if(92!==g)break;Nc||(a=ob.slice(d,tb)),Nc=!0,117!=ob.charCodeAt(++tb)&&c(tb,"Expecting Unicode escape sequence \\uXXXX"),++tb;var h=C(4),i=String.fromCharCode(h);i||c(tb-1,"Invalid Unicode escape"),(b?e(h):f(h))||c(tb-4,"Invalid Unicode escape"),a+=i}b=!1}return Nc?a:ob.slice(d,tb)}function E(){var a=D(),b=Mb;return Nc||(Sc(a)?b=lc[a]:(nb.forbidReserved&&(3===nb.ecmaVersion?Oc:Pc)(a)||Ib&&Qc(a))&&c(ub,"The keyword '"+a+"' is reserved")),i(b,a)}function F(){Db=ub,Eb=vb,Fb=xb,v()}function G(a){Ib=a,tb=Eb,l(),v()}function H(){this.type=null,this.start=ub,this.end=null}function I(){this.start=wb,this.end=null,null!==qb&&(this.source=qb)}function J(){var a=new H;return nb.locations&&(a.loc=new I),nb.ranges&&(a.range=[ub,0]),a}function K(a){var b=new H;return b.start=a.start,nb.locations&&(b.loc=new I,b.loc.start=a.loc.start),nb.ranges&&(b.range=[a.range[0],0]),b}function L(a,b){return a.type=b,a.end=Eb,nb.locations&&(a.loc.end=Fb),nb.ranges&&(a.range[1]=Eb),a}function M(a){return nb.ecmaVersion>=5&&"ExpressionStatement"===a.type&&"Literal"===a.expression.type&&"use strict"===a.expression.value}function N(a){return yb===a?(F(),!0):void 0}function O(){return!nb.strictSemicolons&&(yb===Nb||yb===pc||Yc.test(ob.slice(Eb,ub)))}function P(){N(tc)||O()||R()}function Q(a){yb===a?F():R()}function R(){c(ub,"Unexpected token")}function S(a){"Identifier"!==a.type&&"MemberExpression"!==a.type&&c(a.start,"Assigning to rvalue"),Ib&&"Identifier"===a.type&&Rc(a.name)&&c(a.start,"Assigning to "+a.name+" in strict mode")}function T(a){Db=Eb=tb,nb.locations&&(Fb=new g),Gb=Ib=null,Hb=[],v();var b=a||J(),c=!0;for(a||(b.body=[]);yb!==Nb;){var d=U();b.body.push(d),c&&M(d)&&G(!0),c=!1}return L(b,"Program")}function U(){yb===xc&&v(!0);var a=yb,b=J();switch(a){case Ob:case Rb:F();var d=a===Ob;N(tc)||O()?b.label=null:yb!==Mb?R():(b.label=mb(),P());for(var e=0;Hb.length>e;++e){var f=Hb[e];if(null==b.label||f.name===b.label.name){if(null!=f.kind&&(d||"loop"===f.kind))break;if(b.label&&d)break}}return e===Hb.length&&c(b.start,"Unsyntactic "+a.keyword),L(b,d?"BreakStatement":"ContinueStatement");case Sb:return F(),P(),L(b,"DebuggerStatement");case Ub:return F(),Hb.push($c),b.body=U(),Hb.pop(),Q(dc),b.test=V(),P(),L(b,"DoWhileStatement");case Xb:if(F(),Hb.push($c),Q(qc),yb===tc)return X(b,null);if(yb===cc){var g=J();return F(),Z(g,!0),1===g.declarations.length&&N(kc)?Y(b,g):X(b,g)}var g=$(!1,!0);return N(kc)?(S(g),Y(b,g)):X(b,g);case Yb:return F(),kb(b,!0);case Zb:return F(),b.test=V(),b.consequent=U(),b.alternate=N(Vb)?U():null,L(b,"IfStatement");case $b:return Gb||c(ub,"'return' outside of function"),F(),N(tc)||O()?b.argument=null:(b.argument=$(),P()),L(b,"ReturnStatement");case _b:F(),b.discriminant=V(),b.cases=[],Q(oc),Hb.push(_c);for(var h,i;yb!=pc;)if(yb===Pb||yb===Tb){var j=yb===Pb;h&&L(h,"SwitchCase"),b.cases.push(h=J()),h.consequent=[],F(),j?h.test=$():(i&&c(Db,"Multiple default clauses"),i=!0,h.test=null),Q(uc)}else h||R(),h.consequent.push(U());return h&&L(h,"SwitchCase"),F(),Hb.pop(),L(b,"SwitchStatement");case ac:return F(),Yc.test(ob.slice(Eb,ub))&&c(Eb,"Illegal newline after throw"),b.argument=$(),P(),L(b,"ThrowStatement");case bc:for(F(),b.block=W(),b.handlers=[];yb===Qb;){var k=J();F(),Q(qc),k.param=mb(),Ib&&Rc(k.param.name)&&c(k.param.start,"Binding "+k.param.name+" in strict mode"),Q(rc),k.guard=null,k.body=W(),b.handlers.push(L(k,"CatchClause"))}return b.finalizer=N(Wb)?W():null,b.handlers.length||b.finalizer||c(b.start,"Missing catch or finally clause"),L(b,"TryStatement");case cc:return F(),b=Z(b),P(),b;case dc:return F(),b.test=V(),Hb.push($c),b.body=U(),Hb.pop(),L(b,"WhileStatement");case ec:return Ib&&c(ub,"'with' in strict mode"),F(),b.object=V(),b.body=U(),L(b,"WithStatement");case oc:return W();case tc:return F(),L(b,"EmptyStatement");default:var l=zb,m=$();if(a===Mb&&"Identifier"===m.type&&N(uc)){for(var e=0;Hb.length>e;++e)Hb[e].name===l&&c(m.start,"Label '"+l+"' is already declared");var n=yb.isLoop?"loop":yb===_b?"switch":null;return Hb.push({name:l,kind:n}),b.body=U(),Hb.pop(),b.label=m,L(b,"LabeledStatement")}return b.expression=m,P(),L(b,"ExpressionStatement")}}function V(){Q(qc);var a=$();return Q(rc),a}function W(){var a,b=J(),c=!0,d=!1;for(b.body=[],Q(oc);!N(pc);){var e=U();b.body.push(e),c&&M(e)&&(a=d,G(d=!0)),c=!1}return d&&!a&&G(!1),L(b,"BlockStatement")}function X(a,b){return a.init=b,Q(tc),a.test=yb===tc?null:$(),Q(tc),a.update=yb===rc?null:$(),Q(rc),a.body=U(),Hb.pop(),L(a,"ForStatement")}function Y(a,b){return a.left=b,a.right=$(),Q(rc),a.body=U(),Hb.pop(),L(a,"ForInStatement")}function Z(a,b){for(a.declarations=[],a.kind="var";;){var d=J();if(d.id=mb(),Ib&&Rc(d.id.name)&&c(d.id.start,"Binding "+d.id.name+" in strict mode"),d.init=N(yc)?$(!0,b):null,a.declarations.push(L(d,"VariableDeclarator")),!N(sc))break}return L(a,"VariableDeclaration")}function $(a,b){var c=_(b);if(!a&&yb===sc){var d=K(c);for(d.expressions=[c];N(sc);)d.expressions.push(_(b));return L(d,"SequenceExpression")}return c}function _(a){var b=ab(a);if(yb.isAssign){var c=K(b);return c.operator=zb,c.left=b,F(),c.right=_(a),S(b),L(c,"AssignmentExpression")}return b}function ab(a){var b=bb(a);if(N(wc)){var c=K(b);return c.test=b,c.consequent=$(!0),Q(uc),c.alternate=$(!0,a),L(c,"ConditionalExpression")}return b}function bb(a){return cb(db(a),-1,a)}function cb(a,b,c){var d=yb.binop;if(null!=d&&(!c||yb!==kc)&&d>b){var e=K(a);e.left=a,e.operator=zb,F(),e.right=cb(db(c),d,c);var e=L(e,/&&|\|\|/.test(e.operator)?"LogicalExpression":"BinaryExpression");return cb(e,b,c)}return a}function db(a){if(yb.prefix){var b=J(),d=yb.isUpdate;return b.operator=zb,b.prefix=!0,F(),b.argument=db(a),d?S(b.argument):Ib&&"delete"===b.operator&&"Identifier"===b.argument.type&&c(b.start,"Deleting local variable in strict mode"),L(b,d?"UpdateExpression":"UnaryExpression")}for(var e=eb();yb.postfix&&!O();){var b=K(e);b.operator=zb,b.prefix=!1,b.argument=e,S(e),F(),e=L(b,"UpdateExpression")}return e}function eb(){return fb(gb())}function fb(a,b){if(N(vc)){var c=K(a);return c.object=a,c.property=mb(!0),c.computed=!1,fb(L(c,"MemberExpression"),b)}if(N(mc)){var c=K(a);return c.object=a,c.property=$(),c.computed=!0,Q(nc),fb(L(c,"MemberExpression"),b)}if(!b&&N(qc)){var c=K(a);return c.callee=a,c.arguments=lb(rc,!1),fb(L(c,"CallExpression"),b)}return a}function gb(){switch(yb){case gc:var a=J();return F(),L(a,"ThisExpression");case Mb:return mb();case Jb:case Lb:case Kb:var a=J();return a.value=zb,a.raw=ob.slice(ub,vb),F(),L(a,"Literal");case hc:case ic:case jc:var a=J();return a.value=yb.atomValue,a.raw=yb.keyword,F(),L(a,"Literal");case qc:var b=wb,c=ub;F();var d=$();return d.start=c,d.end=vb,nb.locations&&(d.loc.start=b,d.loc.end=xb),nb.ranges&&(d.range=[c,vb]),Q(rc),d;case mc:var a=J();return F(),a.elements=lb(nc,!0,!0),L(a,"ArrayExpression");case oc:return ib();case Yb:var a=J();return F(),kb(a,!1);case fc:return hb();default:R()}}function hb(){var a=J();return F(),a.callee=fb(gb(),!0),a.arguments=N(qc)?lb(rc,!1):[],L(a,"NewExpression")}function ib(){var a=J(),b=!0,d=!1;for(a.properties=[],F();!N(pc);){if(b)b=!1;else if(Q(sc),nb.allowTrailingCommas&&N(pc))break;var e,f={key:jb()},g=!1;if(N(uc)?(f.value=$(!0),e=f.kind="init"):nb.ecmaVersion>=5&&"Identifier"===f.key.type&&("get"===f.key.name||"set"===f.key.name)?(g=d=!0,e=f.kind=f.key.name,f.key=jb(),yb!==qc&&R(),f.value=kb(J(),!1)):R(),"Identifier"===f.key.type&&(Ib||d))for(var h=0;a.properties.length>h;++h){var i=a.properties[h];if(i.key.name===f.key.name){var j=e==i.kind||g&&"init"===i.kind||"init"===e&&("get"===i.kind||"set"===i.kind);j&&!Ib&&"init"===e&&"init"===i.kind&&(j=!1),j&&c(f.key.start,"Redefinition of property")}}a.properties.push(f)}return L(a,"ObjectExpression")}function jb(){return yb===Jb||yb===Lb?gb():mb(!0)}function kb(a,b){yb===Mb?a.id=mb():b?R():a.id=null,a.params=[];var d=!0;for(Q(qc);!N(rc);)d?d=!1:Q(sc),a.params.push(mb());var e=Gb,f=Hb;if(Gb=!0,Hb=[],a.body=W(!0),Gb=e,Hb=f,Ib||a.body.body.length&&M(a.body.body[0]))for(var g=a.id?-1:0;a.params.length>g;++g){var h=0>g?a.id:a.params[g];if((Qc(h.name)||Rc(h.name))&&c(h.start,"Defining '"+h.name+"' in strict mode"),g>=0)for(var i=0;g>i;++i)h.name===a.params[i].name&&c(h.start,"Argument name clash in strict mode")}return L(a,b?"FunctionDeclaration":"FunctionExpression")}function lb(a,b,c){for(var d=[],e=!0;!N(a);){if(e)e=!1;else if(Q(sc),b&&nb.allowTrailingCommas&&N(a))break;d.push(c&&yb===sc?null:$(!0))}return d}function mb(a){var b=J();return b.name=yb===Mb?zb:a&&!nb.forbidReserved&&yb.keyword||R(),F(),L(b,"Identifier")}a.version="0.1.01";var nb,ob,pb,qb;a.parse=function(a,c){return ob=a+"",pb=ob.length,b(c),h(),T(nb.program)};var rb=a.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},sb=a.getLineInfo=function(a,b){for(var c=1,d=0;;){Zc.lastIndex=d;var e=Zc.exec(a);if(!(e&&b>e.index))break;++c,d=e.index+e[0].length}return{line:c,column:b-d}};a.tokenize=function(a,c){function d(a){return v(a),e.start=ub,e.end=vb,e.startLoc=wb,e.endLoc=xb,e.type=yb,e.value=zb,e}ob=a+"",pb=ob.length,b(c),h();var e={};return d.jumpTo=function(a,b){if(tb=a,nb.locations){Bb=Cb=Zc.lastIndex=0;for(var c;(c=Zc.exec(ob))&&a>c.index;)++Bb,Cb=c.index+c[0].length}ob.charAt(a-1),Ab=b,l()},d};var tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb={type:"num"},Kb={type:"regexp"},Lb={type:"string"},Mb={type:"name"},Nb={type:"eof"},Ob={keyword:"break"},Pb={keyword:"case",beforeExpr:!0},Qb={keyword:"catch"},Rb={keyword:"continue"},Sb={keyword:"debugger"},Tb={keyword:"default"},Ub={keyword:"do",isLoop:!0},Vb={keyword:"else",beforeExpr:!0},Wb={keyword:"finally"},Xb={keyword:"for",isLoop:!0},Yb={keyword:"function"},Zb={keyword:"if"},$b={keyword:"return",beforeExpr:!0},_b={keyword:"switch"},ac={keyword:"throw",beforeExpr:!0},bc={keyword:"try"},cc={keyword:"var"},dc={keyword:"while",isLoop:!0},ec={keyword:"with"},fc={keyword:"new",beforeExpr:!0},gc={keyword:"this"},hc={keyword:"null",atomValue:null},ic={keyword:"true",atomValue:!0},jc={keyword:"false",atomValue:!1},kc={keyword:"in",binop:7,beforeExpr:!0},lc={"break":Ob,"case":Pb,"catch":Qb,"continue":Rb,"debugger":Sb,"default":Tb,"do":Ub,"else":Vb,"finally":Wb,"for":Xb,"function":Yb,"if":Zb,"return":$b,"switch":_b,"throw":ac,"try":bc,"var":cc,"while":dc,"with":ec,"null":hc,"true":ic,"false":jc,"new":fc,"in":kc,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":gc,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},mc={type:"[",beforeExpr:!0},nc={type:"]"},oc={type:"{",beforeExpr:!0},pc={type:"}"},qc={type:"(",beforeExpr:!0},rc={type:")"},sc={type:",",beforeExpr:!0},tc={type:";",beforeExpr:!0},uc={type:":",beforeExpr:!0},vc={type:"."},wc={type:"?",beforeExpr:!0},xc={binop:10,beforeExpr:!0},yc={isAssign:!0,beforeExpr:!0},zc={isAssign:!0,beforeExpr:!0},Ac={binop:9,prefix:!0,beforeExpr:!0},Bc={postfix:!0,prefix:!0,isUpdate:!0},Cc={prefix:!0,beforeExpr:!0},Dc={binop:1,beforeExpr:!0},Ec={binop:2,beforeExpr:!0},Fc={binop:3,beforeExpr:!0},Gc={binop:4,beforeExpr:!0},Hc={binop:5,beforeExpr:!0},Ic={binop:6,beforeExpr:!0},Jc={binop:7,beforeExpr:!0},Kc={binop:8,beforeExpr:!0},Lc={binop:10,beforeExpr:!0};
a.tokTypes={bracketL:mc,bracketR:nc,braceL:oc,braceR:pc,parenL:qc,parenR:rc,comma:sc,semi:tc,colon:uc,dot:vc,question:wc,slash:xc,eq:yc,name:Mb,eof:Nb,num:Jb,regexp:Kb,string:Lb};for(var Mc in lc)a.tokTypes[Mc]=lc[Mc];var Nc,Oc=d("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Pc=d("class enum extends super const export import"),Qc=d("implements interface let package private protected public static yield"),Rc=d("eval arguments"),Sc=d("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Tc=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Uc="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Vc="------------------------------------------------------------------------------------------------------------------------------------------",Wc=RegExp("["+Uc+"]"),Xc=RegExp("["+Uc+Vc+"]"),Yc=/[\n\r\u2028\u2029]/,Zc=/\r\n|[\n\r\u2028\u2029]/g,$c={kind:"loop"},_c={kind:"switch"}}("undefined"==typeof exports?self.acorn={}:exports);var PaperScript=this.PaperScript=new function(){function _$_(a,b,c){var d=binaryOperators[b];if(a&&a[d]){var e=a[d](c);return"!="===b?!e:e}switch(b){case"+":return a+c;case"-":return a-c;case"*":return a*c;case"/":return a/c;case"%":return a%c;case"==":return a==c;case"!=":return a!=c}}function $_(a,b){var c=unaryOperators[a];if(c&&b&&b[c])return b[c]();switch(a){case"+":return+b;case"-":return-b}}function compile(a){function b(a){for(var b=0,c=f.length;c>b;b++){var d=f[b];if(d[0]>=a)break;a+=d[1]}return a}function c(c){return a.substring(b(c.range[0]),b(c.range[1]))}function d(c,d){for(var e=b(c.range[0]),g=b(c.range[1]),h=0,i=f.length-1;i>=0;i--)if(e>f[i][0]){h=i+1;break}f.splice(h,0,[e,d.length-g+e]),a=a.substring(0,e)+d+a.substring(g)}function e(a){for(var b in a)if("range"!==b){var f=a[b];if(Array.isArray(f))for(var g=0,h=f.length;h>g;g++)e(f[g]);else f&&"object"==typeof f&&e(f)}switch(a&&a.type){case"BinaryExpression":if(a.operator in binaryOperators&&"Literal"!==a.left.type){var i=c(a.left),j=c(a.right);d(a,"_$_("+i+', "'+a.operator+'", '+j+")")}break;case"AssignmentExpression":if(/^.=$/.test(a.operator)&&"Literal"!==a.left.type){var i=c(a.left),j=c(a.right);d(a,i+" = _$_("+i+', "'+a.operator[0]+'", '+j+")")}break;case"UpdateExpression":if(!a.prefix){var k=c(a.argument);d(a,k+" = _$_("+k+', "'+a.operator[0]+'", 1)')}break;case"UnaryExpression":if(a.operator in unaryOperators&&"Literal"!==a.argument.type){var k=c(a.argument);d(a,'$_("'+a.operator+'", '+k+")")}}}var f=[];return e(acorn.parse(a,{ranges:!0})),a}function evaluate(code,scope){paper=scope;var view=scope.project&&scope.project.view,res;with(scope)(function(){var onActivate,onDeactivate,onEditOptions,onMouseDown,onMouseUp,onMouseDrag,onMouseMove,onKeyDown,onKeyUp,onFrame,onResize;res=eval(compile(code)),/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(code)&&Base.each(Tool.prototype._events,function(key){var value=eval(key);value&&(scope.getTool()[key]=value)}),view&&(view.setOnResize(onResize),view.fire("resize",{size:view.size,delta:new Point}),view.setOnFrame(onFrame),view.draw())}).call(scope);return res}function request(a,b){var c=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return c.open("GET",a,!0),c.overrideMimeType&&c.overrideMimeType("text/plain"),c.onreadystatechange=function(){return 4===c.readyState?evaluate(c.responseText,b):void 0},c.send(null)}function load(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;c>b;b++){var d=a[b];if(/^text\/(?:x-|)paperscript$/.test(d.type)&&!d.getAttribute("data-paper-ignore")){var e=PaperScript.getAttribute(d,"canvas"),f=PaperScope.get(e)||new PaperScope(d).setup(e);d.src?request(d.src,f):evaluate(d.innerHTML,f),d.setAttribute("data-paper-ignore",!0)}}}function handleAttribute(a){return a+="Attribute",function(b,c){return b[a](c)||b[a]("data-paper-"+c)}}var binaryOperators={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"modulo","==":"equals","!=":"equals"},unaryOperators={"-":"negate","+":null};return"complete"===document.readyState?setTimeout(load):DomEvent.add(window,{load:load}),{compile:compile,evaluate:evaluate,load:load,getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}};return this.enumerable=!0,new(PaperScope.inject(this))},Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};jQuery.fn.farbtastic=function(a){return $.farbtastic(this,a),this},jQuery.farbtastic=function(a,b){var a=$(a).get(0);return a.farbtastic||(a.farbtastic=new jQuery._farbtastic(a,b))},jQuery._farbtastic=function(a,b){var c=this;$(a).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var d=$(".farbtastic",a);c.wheel=$(".wheel",a).get(0),c.radius=84,c.square=100,c.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",d).each(function(){if("none"!=this.currentStyle.backgroundImage){var a=this.currentStyle.backgroundImage;a=this.currentStyle.backgroundImage.substring(5,a.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}}),c.linkTo=function(a){return"object"==typeof c.callback&&$(c.callback).unbind("keyup",c.updateValue),c.color=null,"function"==typeof a?c.callback=a:("object"==typeof a||"string"==typeof a)&&(c.callback=$(a),c.callback.bind("keyup",c.updateValue),c.callback.get(0).value&&c.setColor(c.callback.get(0).value)),this},c.updateValue=function(){this.value&&this.value!=c.color&&c.setColor(this.value)},c.setColor=function(a){var b=c.unpack(a);return c.color!=a&&b&&(c.color=a,c.rgb=b,c.hsl=c.RGBToHSL(c.rgb),c.updateDisplay()),this},c.setHSL=function(a){return c.hsl=a,c.rgb=c.HSLToRGB(a),c.color=c.pack(c.rgb),c.updateDisplay(),this},c.widgetCoords=function(a){var b,d,e=a.target||a.srcElement,f=c.wheel;if("undefined"!=typeof a.offsetX){for(var g={x:a.offsetX,y:a.offsetY},h=e;h;)h.mouseX=g.x,h.mouseY=g.y,g.x+=h.offsetLeft,g.y+=h.offsetTop,h=h.offsetParent;for(var h=f,i={x:0,y:0};h;){if("undefined"!=typeof h.mouseX){b=h.mouseX-i.x,d=h.mouseY-i.y;break}i.x+=h.offsetLeft,i.y+=h.offsetTop,h=h.offsetParent}for(h=e;h;)h.mouseX=void 0,h.mouseY=void 0,h=h.offsetParent}else{var g=c.absolutePosition(f);b=(a.pageX||0*(a.clientX+$("html").get(0).scrollLeft))-g.x,d=(a.pageY||0*(a.clientY+$("html").get(0).scrollTop))-g.y}return{x:b-c.width/2,y:d-c.width/2}},c.mousedown=function(a){document.dragging||($(document).bind("mousemove",c.mousemove).bind("mouseup",c.mouseup),document.dragging=!0);var b=c.widgetCoords(a);return c.circleDrag=2*Math.max(Math.abs(b.x),Math.abs(b.y))>c.square,c.mousemove(a),!1},c.mousemove=function(a){var b=c.widgetCoords(a);if(c.circleDrag){var d=Math.atan2(b.x,-b.y)/6.28;0>d&&(d+=1),c.setHSL([d,c.hsl[1],c.hsl[2]])}else{var e=Math.max(0,Math.min(1,-(b.x/c.square)+.5)),f=Math.max(0,Math.min(1,-(b.y/c.square)+.5));c.setHSL([c.hsl[0],e,f])}return!1},c.mouseup=function(){$(document).unbind("mousemove",c.mousemove),$(document).unbind("mouseup",c.mouseup),document.dragging=!1},c.updateDisplay=function(){var a=6.28*c.hsl[0];$(".h-marker",d).css({left:Math.round(Math.sin(a)*c.radius+c.width/2)+"px",top:Math.round(-Math.cos(a)*c.radius+c.width/2)+"px"}),$(".sl-marker",d).css({left:Math.round(c.square*(.5-c.hsl[1])+c.width/2)+"px",top:Math.round(c.square*(.5-c.hsl[2])+c.width/2)+"px"}),$(".color",d).css("backgroundColor",c.pack(c.HSLToRGB([c.hsl[0],1,.5]))),"object"==typeof c.callback?($(c.callback).css({backgroundColor:c.color,color:c.hsl[2]>.5?"#000":"#fff"}),$(c.callback).each(function(){this.value&&this.value!=c.color&&(this.value=c.color)})):"function"==typeof c.callback&&c.callback.call(c,c.color)},c.absolutePosition=function(a){var b={x:a.offsetLeft,y:a.offsetTop};if(a.offsetParent){var d=c.absolutePosition(a.offsetParent);b.x+=d.x,b.y+=d.y}return b},c.pack=function(a){var b=Math.round(255*a[0]),c=Math.round(255*a[1]),d=Math.round(255*a[2]);return"#"+(16>b?"0":"")+b.toString(16)+(16>c?"0":"")+c.toString(16)+(16>d?"0":"")+d.toString(16)},c.unpack=function(a){return 7==a.length?[parseInt("0x"+a.substring(1,3))/255,parseInt("0x"+a.substring(3,5))/255,parseInt("0x"+a.substring(5,7))/255]:4==a.length?[parseInt("0x"+a.substring(1,2))/15,parseInt("0x"+a.substring(2,3))/15,parseInt("0x"+a.substring(3,4))/15]:void 0},c.HSLToRGB=function(a){var b,c,d=a[0],e=a[1],f=a[2];return c=.5>=f?f*(e+1):f+e-f*e,b=2*f-c,[this.hueToRGB(b,c,d+.33333),this.hueToRGB(b,c,d),this.hueToRGB(b,c,d-.33333)]},c.hueToRGB=function(a,b,c){return c=0>c?c+1:c>1?c-1:c,1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(.66666-c)*6:a},c.RGBToHSL=function(a){var b,c,d,e,f,g,h=a[0],i=a[1],j=a[2];return b=Math.min(h,Math.min(i,j)),c=Math.max(h,Math.max(i,j)),d=c-b,g=(b+c)/2,f=0,g>0&&1>g&&(f=d/(.5>g?2*g:2-2*g)),e=0,d>0&&(c==h&&c!=i&&(e+=(i-j)/d),c==i&&c!=j&&(e+=2+(j-h)/d),c==j&&c!=h&&(e+=4+(h-i)/d),e/=6),[e,f,g]},$("*",d).mousedown(c.mousedown),c.setColor("#000000"),b&&c.linkTo(b)}(function(a,b,c){"use strict";function d(a,b,c){var d,e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(c)&&/^-?\d/.test(c)&&(d=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":c||0,c=f.pixelLeft+"px",f.left=d,e&&(a.runtimeStyle.left=e)),/^(thin|medium|thick)$/i.test(c)?c:Math.round(parseFloat(c))+"px"}function e(a){return parseInt(a,10)}function f(a,b,e,f){if(a=(a||"").split(","),a=a[f||0]||a[0]||"auto",a=l.Util.trimText(a).split(" "),"backgroundSize"!==e||a[0]&&!a[0].match(/cover|contain|auto/)){if(a[0]=-1===a[0].indexOf("%")?d(b,e+"X",a[0]):a[0],a[1]===c){if("backgroundSize"===e)return a[1]="auto",a;a[1]=a[0]}a[1]=-1===a[1].indexOf("%")?d(b,e+"Y",a[1]):a[1]}return a}function g(a,b,c,d,e,f){var g,h,i,j,k=l.Util.getCSS(b,a,e);if(1===k.length&&(j=k[0],k=[],k[0]=j,k[1]=j),-1!==(""+k[0]).indexOf("%"))i=parseFloat(k[0])/100,h=c.width*i,"backgroundSize"!==a&&(h-=(f||d).width*i);else if("backgroundSize"===a)if("auto"===k[0])h=d.width;else if(/contain|cover/.test(k[0])){var m=l.Util.resizeBounds(d.width,d.height,c.width,c.height,k[0]);h=m.width,g=m.height}else h=parseInt(k[0],10);else h=parseInt(k[0],10);return"auto"===k[1]?g=h/d.width*d.height:-1!==(""+k[1]).indexOf("%")?(i=parseFloat(k[1])/100,g=c.height*i,"backgroundSize"!==a&&(g-=(f||d).height*i)):g=parseInt(k[1],10),[h,g]}function h(a,b){var c=[];return{storage:c,width:a,height:b,clip:function(){c.push({type:"function",name:"clip",arguments:arguments})},translate:function(){c.push({type:"function",name:"translate",arguments:arguments})},fill:function(){c.push({type:"function",name:"fill",arguments:arguments})},save:function(){c.push({type:"function",name:"save",arguments:arguments})},restore:function(){c.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){c.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){c.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var a=[];return c.push({type:"function",name:"drawShape",arguments:a}),{moveTo:function(){a.push({name:"moveTo",arguments:arguments})},lineTo:function(){a.push({name:"lineTo",arguments:arguments})},arcTo:function(){a.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){a.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){a.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){c.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){c.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(a,b){return c.push({type:"variable",name:a,arguments:b}),b}}}function i(a){return{zindex:a,children:[]}}var j,k,l={};l.Util={},l.Util.log=function(b){l.logging&&a.console&&a.console.log&&a.console.log(b)},l.Util.trimText=function(a){return function(b){return a?a.apply(b):((b||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim),l.Util.asFloat=function(a){return parseFloat(a)},function(){var a=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,b=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;l.Util.parseTextShadows=function(c){if(!c||"none"===c)return[];for(var d=c.match(a),e=[],f=0;d&&d.length>f;f++){var g=d[f].match(b);e.push({color:g[0],offsetX:g[1]?g[1].replace("px",""):0,offsetY:g[2]?g[2].replace("px",""):0,blur:g[3]?g[3].replace("px",""):0})}return e}}(),l.Util.parseBackgroundImage=function(a){var b,c,d,e,f,g,h,i,j=" \r\n	",k=[],l=0,m=0,n=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&i.push(c),"-"===b.substr(0,1)&&(e=b.indexOf("-",1)+1)>0&&(d=b.substr(0,e),b=b.substr(e)),k.push({prefix:d,method:b.toLowerCase(),value:f,args:i})),i=[],b=d=c=f=""};n();for(var o=0,p=a.length;p>o;o++)if(g=a[o],!(0===l&&j.indexOf(g)>-1)){switch(g){case'"':h?h===g&&(h=null):h=g;break;case"(":if(h)break;if(0===l){l=1,f+=g;continue}m++;break;case")":if(h)break;if(1===l){if(0===m){l=0,f+=g,n();continue}m--}break;case",":if(h)break;if(0===l){n();continue}if(1===l&&0===m&&!b.match(/^url$/i)){i.push(c),c="",f+=g;continue}}f+=g,0===l?b+=g:c+=g}return n(),k},l.Util.Bounds=function(a){var b,c={};return a.getBoundingClientRect&&(b=a.getBoundingClientRect(),c.top=b.top,c.bottom=b.bottom||b.top+b.height,c.left=b.left,c.width=a.offsetWidth,c.height=a.offsetHeight),c},l.Util.OffsetBounds=function(a){var b=a.offsetParent?l.Util.OffsetBounds(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}},l.Util.getCSS=function(a,c,d){j!==a&&(k=b.defaultView.getComputedStyle(a,null));var g=k[c];if(/^background(Size|Position)$/.test(c))return f(g,a,c,d);if(/border(Top|Bottom)(Left|Right)Radius/.test(c)){var h=g.split(" ");return 1>=h.length&&(h[1]=h[0]),h.map(e)}return g},l.Util.resizeBounds=function(a,b,c,d,e){var f,g,h=c/d,i=a/b;return e&&"auto"!==e?i>h^"contain"===e?(g=d,f=d*i):(f=c,g=c/i):(f=c,g=d),{width:f,height:g}},l.Util.BackgroundPosition=function(a,b,c,d,e){var f=g("backgroundPosition",a,b,c,d,e);return{left:f[0],top:f[1]}},l.Util.BackgroundSize=function(a,b,c,d){var e=g("backgroundSize",a,b,c,d);return{width:e[0],height:e[1]}},l.Util.Extend=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},l.Util.Children=function(a){var b;try{b=a.nodeName&&"IFRAME"===a.nodeName.toUpperCase()?a.contentDocument||a.contentWindow.document:function(a){var b=[];return null!==a&&function(a,b){var d=a.length,e=0;if("number"==typeof b.length)for(var f=b.length;f>e;e++)a[d++]=b[e];else for(;b[e]!==c;)a[d++]=b[e++];return a.length=d,a}(b,a),b}(a.childNodes)}catch(d){l.Util.log("html2canvas.Util.Children failed with exception: "+d.message),b=[]}return b},l.Util.isTransparent=function(a){return"transparent"===a||"rgba(0, 0, 0, 0)"===a},l.Util.Font=function(){var a={};return function(b,d,e){if(a[b+"-"+d]!==c)return a[b+"-"+d];var f,g,h,i=e.createElement("div"),j=e.createElement("img"),k=e.createElement("span"),l="Hidden Text";return i.style.visibility="hidden",i.style.fontFamily=b,i.style.fontSize=d,i.style.margin=0,i.style.padding=0,e.body.appendChild(i),j.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",j.width=1,j.height=1,j.style.margin=0,j.style.padding=0,j.style.verticalAlign="baseline",k.style.fontFamily=b,k.style.fontSize=d,k.style.margin=0,k.style.padding=0,k.appendChild(e.createTextNode(l)),i.appendChild(k),i.appendChild(j),f=j.offsetTop-k.offsetTop+1,i.removeChild(k),i.appendChild(e.createTextNode(l)),i.style.lineHeight="normal",j.style.verticalAlign="super",g=j.offsetTop-i.offsetTop+1,h={baseline:f,lineWidth:1,middle:g},a[b+"-"+d]=h,e.body.removeChild(i),h}}(),function(){function a(a){return function(b){try{a.addColorStop(b.stop,b.color)}catch(d){c.log(["failed to add color stop: ",d,"; tried to add: ",b])}}}var c=l.Util,d={};l.Generate=d;var e=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];d.parseGradient=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p=e.length;for(d=0;p>d&&!(f=a.match(e[d]));d+=1);if(f)switch(f[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(c={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},h=f[2].match(/\w+/g))for(i=h.length,d=0;i>d;d+=1)switch(h[d]){case"top":c.y0=0,c.y1=b.height;break;case"right":c.x0=b.width,c.x1=0;break;case"bottom":c.y0=b.height,c.y1=0;break;case"left":c.x0=0,c.x1=b.width}if(null===c.x0&&null===c.x1&&(c.x0=c.x1=b.width/2),null===c.y0&&null===c.y1&&(c.y0=c.y1=b.height/2),h=f[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(i=h.length,j=1/Math.max(i-1,1),d=0;i>d;d+=1)k=h[d].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),k[2]?(g=parseFloat(k[2]),g/="%"===k[3]?100:b.width):g=d*j,c.colorStops.push({color:k[1],stop:g});break;case"-webkit-gradient":if(c={type:"radial"===f[2]?"circle":f[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},h=f[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),h&&(c.x0=h[1]*b.width/100,c.y0=h[2]*b.height/100,c.x1=h[3]*b.width/100,c.y1=h[4]*b.height/100),h=f[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(i=h.length,d=0;i>d;d+=1)k=h[d].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),g=parseFloat(k[2]),"from"===k[1]&&(g=0),"to"===k[1]&&(g=1),c.colorStops.push({color:k[3],stop:g});break;case"-moz-linear-gradient":if(c={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},h=f[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),h&&(c.x0=h[1]*b.width/100,c.y0=h[2]*b.height/100,c.x1=b.width-c.x0,c.y1=b.height-c.y0),h=f[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(i=h.length,j=1/Math.max(i-1,1),d=0;i>d;d+=1)k=h[d].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),k[2]?(g=parseFloat(k[2]),k[3]&&(g/=100)):g=d*j,c.colorStops.push({color:k[1],stop:g});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(c={type:"circle",x0:0,y0:0,x1:b.width,y1:b.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},h=f[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),h&&(c.cx=h[1]*b.width/100,c.cy=h[2]*b.height/100),h=f[3].match(/\w+/),k=f[4].match(/[a-z\-]*/),h&&k)switch(k[0]){case"farthest-corner":case"cover":case"":l=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.cy,2)),m=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.y1-c.cy,2)),n=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.y1-c.cy,2)),o=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.cy,2)),c.rx=c.ry=Math.max(l,m,n,o);break;case"closest-corner":l=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.cy,2)),m=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.y1-c.cy,2)),n=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.y1-c.cy,2)),o=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.cy,2)),c.rx=c.ry=Math.min(l,m,n,o);break;case"farthest-side":"circle"===h[0]?c.rx=c.ry=Math.max(c.cx,c.cy,c.x1-c.cx,c.y1-c.cy):(c.type=h[0],c.rx=Math.max(c.cx,c.x1-c.cx),c.ry=Math.max(c.cy,c.y1-c.cy));break;case"closest-side":case"contain":"circle"===h[0]?c.rx=c.ry=Math.min(c.cx,c.cy,c.x1-c.cx,c.y1-c.cy):(c.type=h[0],c.rx=Math.min(c.cx,c.x1-c.cx),c.ry=Math.min(c.cy,c.y1-c.cy))}if(h=f[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(i=h.length,j=1/Math.max(i-1,1),d=0;i>d;d+=1)k=h[d].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),k[2]?(g=parseFloat(k[2]),g/="%"===k[3]?100:b.width):g=d*j,c.colorStops.push({color:k[1],stop:g})}return c},d.Gradient=function(c,d){if(0!==d.width&&0!==d.height){var e,f,g=b.createElement("canvas"),h=g.getContext("2d");if(g.width=d.width,g.height=d.height,e=l.Generate.parseGradient(c,d))switch(e.type){case"linear":f=h.createLinearGradient(e.x0,e.y0,e.x1,e.y1),e.colorStops.forEach(a(f)),h.fillStyle=f,h.fillRect(0,0,d.width,d.height);break;case"circle":f=h.createRadialGradient(e.cx,e.cy,0,e.cx,e.cy,e.rx),e.colorStops.forEach(a(f)),h.fillStyle=f,h.fillRect(0,0,d.width,d.height);break;case"ellipse":var i=b.createElement("canvas"),j=i.getContext("2d"),k=Math.max(e.rx,e.ry),m=2*k;i.width=i.height=m,f=j.createRadialGradient(e.rx,e.ry,0,e.rx,e.ry,k),e.colorStops.forEach(a(f)),j.fillStyle=f,j.fillRect(0,0,m,m),h.fillStyle=e.colorStops[e.colorStops.length-1].color,h.fillRect(0,0,g.width,g.height),h.drawImage(i,e.cx-e.rx,e.cy-e.ry,2*e.rx,2*e.ry)}return g}},d.ListAlpha=function(a){var b,c="";do b=a%26,c=String.fromCharCode(b+64)+c,a/=26;while(26*a>26);return c},d.ListRoman=function(a){var b,c=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],d=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],e="",f=c.length;if(0>=a||a>=4e3)return a;for(b=0;f>b;b+=1)for(;a>=d[b];)a-=d[b],e+=c[b];return e}}(),l.Parse=function(d,e){function f(){return Math.max(Math.max(kb.body.scrollWidth,kb.documentElement.scrollWidth),Math.max(kb.body.offsetWidth,kb.documentElement.offsetWidth),Math.max(kb.body.clientWidth,kb.documentElement.clientWidth))}function g(){return Math.max(Math.max(kb.body.scrollHeight,kb.documentElement.scrollHeight),Math.max(kb.body.offsetHeight,kb.documentElement.offsetHeight),Math.max(kb.body.clientHeight,kb.documentElement.clientHeight))}function j(a,b){var c=parseInt(pb(a,b),10);return isNaN(c)?0:c}function k(a,b,c,d,e,f){"transparent"!==f&&(a.setVariable("fillStyle",f),a.fillRect(b,c,d,e),jb+=1)}function m(a,b,d){return a.length>0?b+d.toUpperCase():c}function n(a,b){switch(b){case"lowercase":return a.toLowerCase();case"capitalize":return a.replace(/(^|\s|:|-|\(|\))([a-z])/g,m);case"uppercase":return a.toUpperCase();default:return a}}function o(a){return/^(normal|none|0px)$/.test(a)}function p(a,b,c,d){null!==a&&lb.trimText(a).length>0&&(d.fillText(a,b,c),jb+=1)}function q(a,b,d,e){var f=!1,g=pb(b,"fontWeight"),h=pb(b,"fontFamily"),i=pb(b,"fontSize"),j=lb.parseTextShadows(pb(b,"textShadow"));switch(parseInt(g,10)){case 401:g="bold";break;case 400:g="normal"}return a.setVariable("fillStyle",e),a.setVariable("font",[pb(b,"fontStyle"),pb(b,"fontVariant"),g,i,h].join(" ")),a.setVariable("textAlign",f?"right":"left"),j.length&&(a.setVariable("shadowColor",j[0].color),a.setVariable("shadowOffsetX",j[0].offsetX),a.setVariable("shadowOffsetY",j[0].offsetY),a.setVariable("shadowBlur",j[0].blur)),"none"!==d?lb.Font(h,i,kb):c}function r(a,b,c,d,e){switch(b){case"underline":k(a,c.left,Math.round(c.top+d.baseline+d.lineWidth),c.width,1,e);break;case"overline":k(a,c.left,Math.round(c.top),c.width,1,e);break;case"line-through":k(a,c.left,Math.ceil(c.top+d.middle+d.lineWidth),c.width,1,e)}}function s(a,b,c,d,e){var f;if(mb.rangeBounds&&!e)("none"!==c||0!==lb.trimText(b).length)&&(f=t(b,a.node,a.textOffset)),a.textOffset+=b.length;else if(a.node&&"string"==typeof a.node.nodeValue){var g=d?a.node.splitText(b.length):null;f=u(a.node,e),a.node=g}return f}function t(a,b,c){var d=kb.createRange();return d.setStart(b,c),d.setEnd(b,c+a.length),d.getBoundingClientRect()}function u(a,b){var c=a.parentNode,d=kb.createElement("wrapper"),e=a.cloneNode(!0);d.appendChild(a.cloneNode(!0)),c.replaceChild(d,a);var f=b?lb.OffsetBounds(d):lb.Bounds(d);return c.replaceChild(e,d),f}function v(a,b,c){var d,f,g=c.ctx,h=pb(a,"color"),i=pb(a,"textDecoration"),j=pb(a,"textAlign"),k={node:b,textOffset:0};lb.trimText(b.nodeValue).length>0&&(b.nodeValue=n(b.nodeValue,pb(a,"textTransform")),j=j.replace(["-webkit-auto"],["auto"]),f=b.nodeValue.split(!e.letterRendering&&/^(left|right|justify|auto)$/.test(j)&&o(pb(a,"letterSpacing"))?/(\b| )/:""),d=q(g,a,i,h),e.chinese&&f.forEach(function(a,b){/.*[\u4E00-\u9FA5].*$/.test(a)&&(a=a.split(""),a.unshift(b,1),f.splice.apply(f,a))}),f.forEach(function(a,b){var e=s(k,a,i,f.length-1>b,c.transform.matrix);e&&(p(a,e.left,e.bottom,g),r(g,i,e,d,h))}))}function w(a,b){var c,d,e=kb.createElement("boundelement");return e.style.display="inline",c=a.style.listStyleType,a.style.listStyleType="none",e.appendChild(kb.createTextNode(b)),a.insertBefore(e,a.firstChild),d=lb.Bounds(e),a.removeChild(e),a.style.listStyleType=c,d}function x(a){var b=-1,c=1,d=a.parentNode.childNodes;if(a.parentNode){for(;d[++b]!==a;)1===d[b].nodeType&&c++;return c}return-1}function y(a,b){var c,d=x(a);switch(b){case"decimal":c=d;break;case"decimal-leading-zero":c=1===(""+d).length?d="0"+d:""+d;break;case"upper-roman":c=l.Generate.ListRoman(d);break;case"lower-roman":c=l.Generate.ListRoman(d).toLowerCase();break;case"lower-alpha":c=l.Generate.ListAlpha(d).toLowerCase();break;case"upper-alpha":c=l.Generate.ListAlpha(d)}return c+". "}function z(a,b,c){var d,e,f,g=b.ctx,h=pb(a,"listStyleType");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(h)){if(e=y(a,h),f=w(a,e),q(g,a,"none",pb(a,"color")),"inside"!==pb(a,"listStylePosition"))return;g.setVariable("textAlign","left"),d=c.left,p(e,d,f.bottom,g)}}function A(a){var b=d[a];return b&&b.succeeded===!0?b.img:!1}function B(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top),e=Math.min(a.left+a.width,b.left+b.width),f=Math.min(a.top+a.height,b.top+b.height);return{left:c,top:d,width:e-c,height:f-d}}function C(a,b,c){var d,e="static"!==b.cssPosition,f=e?pb(a,"zIndex"):"auto",g=pb(a,"opacity"),h="none"!==pb(a,"cssFloat");b.zIndex=d=i(f),d.isPositioned=e,d.isFloated=h,d.opacity=g,d.ownStacking="auto"!==f||1>g,c&&c.zIndex.children.push(b)}function D(a,b,c,d,e){var f=j(b,"paddingLeft"),g=j(b,"paddingTop"),h=j(b,"paddingRight"),i=j(b,"paddingBottom");P(a,c,0,0,c.width,c.height,d.left+f+e[3].width,d.top+g+e[0].width,d.width-(e[1].width+e[3].width+f+h),d.height-(e[0].width+e[2].width+g+i))}function E(a){return["Top","Right","Bottom","Left"].map(function(b){return{width:j(a,"border"+b+"Width"),color:pb(a,"border"+b+"Color")}})}function F(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){return pb(a,"border"+b+"Radius")})}function G(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),i=e(c,d,f),j=e(g,h,f),k=e(h,i,f),l=e(j,k,f);return[G(a,g,j,l),G(l,k,i,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function H(a,b,c,d,e,f,g){b[0]>0||b[1]>0?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]),(c[0]>0||c[1]>0)&&a.push(["line",e[0].start.x,e[0].start.y])}function I(a,b,c,d,e,f,g){var h=[];return b[0]>0||b[1]>0?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]),c[0]>0||c[1]>0?(h.push(["line",f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]])),b[0]>0||b[1]>0?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]),h}function J(a,b,c){var d=a.left,e=a.top,f=a.width,g=a.height,h=b[0][0],i=b[0][1],j=b[1][0],k=b[1][1],l=b[2][0],m=b[2][1],n=b[3][0],o=b[3][1],p=f-j,q=g-m,r=f-l,s=g-o;return{topLeftOuter:sb(d,e,h,i).topLeft.subdivide(.5),topLeftInner:sb(d+c[3].width,e+c[0].width,Math.max(0,h-c[3].width),Math.max(0,i-c[0].width)).topLeft.subdivide(.5),topRightOuter:sb(d+p,e,j,k).topRight.subdivide(.5),topRightInner:sb(d+Math.min(p,f+c[3].width),e+c[0].width,p>f+c[3].width?0:j-c[3].width,k-c[0].width).topRight.subdivide(.5),bottomRightOuter:sb(d+r,e+q,l,m).bottomRight.subdivide(.5),bottomRightInner:sb(d+Math.min(r,f+c[3].width),e+Math.min(q,g+c[0].width),Math.max(0,l-c[1].width),Math.max(0,m-c[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:sb(d,e+s,n,o).bottomLeft.subdivide(.5),bottomLeftInner:sb(d+c[3].width,e+s,Math.max(0,n-c[3].width),Math.max(0,o-c[2].width)).bottomLeft.subdivide(.5)}}function K(a,b,c,d,e){var f=pb(a,"backgroundClip"),g=[];switch(f){case"content-box":case"padding-box":H(g,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width),H(g,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width),H(g,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width),H(g,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,e.top+e.height-c[2].width);break;default:H(g,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),H(g,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),H(g,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),H(g,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)
}return g}function L(a,b,c){var d,e,f,g,h,i,j=b.left,k=b.top,l=b.width,m=b.height,n=F(a),o=J(b,n,c),p={clip:K(a,o,c,n,b),borders:[]};for(d=0;4>d;d++)if(c[d].width>0){switch(e=j,f=k,g=l,h=m-c[2].width,d){case 0:h=c[0].width,i=I({c1:[e,f],c2:[e+g,f],c3:[e+g-c[1].width,f+h],c4:[e+c[3].width,f+h]},n[0],n[1],o.topLeftOuter,o.topLeftInner,o.topRightOuter,o.topRightInner);break;case 1:e=j+l-c[1].width,g=c[1].width,i=I({c1:[e+g,f],c2:[e+g,f+h+c[2].width],c3:[e,f+h],c4:[e,f+c[0].width]},n[1],n[2],o.topRightOuter,o.topRightInner,o.bottomRightOuter,o.bottomRightInner);break;case 2:f=f+m-c[2].width,h=c[2].width,i=I({c1:[e+g,f+h],c2:[e,f+h],c3:[e+c[3].width,f],c4:[e+g-c[3].width,f]},n[2],n[3],o.bottomRightOuter,o.bottomRightInner,o.bottomLeftOuter,o.bottomLeftInner);break;case 3:g=c[3].width,i=I({c1:[e,f+h+c[2].width],c2:[e,f],c3:[e+g,f+c[0].width],c4:[e+g,f+h]},n[3],n[0],o.bottomLeftOuter,o.bottomLeftInner,o.topLeftOuter,o.topLeftInner)}p.borders.push({args:i,color:c[d].color})}return p}function M(a,b){var c=a.drawShape();return b.forEach(function(a,b){c[0===b?"moveTo":a[0]+"To"].apply(null,a.slice(1))}),c}function N(a,b,c){"transparent"!==c&&(a.setVariable("fillStyle",c),M(a,b),a.fill(),jb+=1)}function O(a,b,c){var d,e,f=kb.createElement("valuewrap"),g=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"];g.forEach(function(b){try{f.style[b]=pb(a,b)}catch(c){lb.log("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}}),f.style.borderColor="black",f.style.borderStyle="solid",f.style.display="block",f.style.position="absolute",(/^(submit|reset|button|text|password)$/.test(a.type)||"SELECT"===a.nodeName)&&(f.style.lineHeight=pb(a,"height")),f.style.top=b.top+"px",f.style.left=b.left+"px",d="SELECT"===a.nodeName?(a.options[a.selectedIndex]||0).text:a.value,d||(d=a.placeholder),e=kb.createTextNode(d),f.appendChild(e),ob.appendChild(f),v(a,e,c),ob.removeChild(f)}function P(a){a.drawImage.apply(a,Array.prototype.slice.call(arguments,1)),jb+=1}function Q(c,d){var e=a.getComputedStyle(c,d);if(e&&e.content&&"none"!==e.content&&"-moz-alt-content"!==e.content&&"none"!==e.display){var f=e.content+"",g=f.substr(0,1);g===f.substr(f.length-1)&&g.match(/'|"/)&&(f=f.substr(1,f.length-2));var h="url"===f.substr(0,3),i=b.createElement(h?"img":"span");return i.className=qb+"-before "+qb+"-after",Object.keys(e).filter(R).forEach(function(a){try{i.style[a]=e[a]}catch(b){lb.log(["Tried to assign readonly property ",a,"Error:",b])}}),h?i.src=lb.parseBackgroundImage(f)[0].args[0]:i.innerHTML=f,i}}function R(b){return isNaN(a.parseInt(b,10))}function S(a,b){var c=Q(a,":before"),d=Q(a,":after");(c||d)&&(c&&(a.className+=" "+qb+"-before",a.parentNode.insertBefore(c,a),fb(c,b,!0),a.parentNode.removeChild(c),a.className=a.className.replace(qb+"-before","").trim()),d&&(a.className+=" "+qb+"-after",a.appendChild(d),fb(d,b,!0),a.removeChild(d),a.className=a.className.replace(qb+"-after","").trim()))}function T(a,b,c,d){var e=Math.round(d.left+c.left),f=Math.round(d.top+c.top);a.createPattern(b),a.translate(e,f),a.fill(),a.translate(-e,-f)}function U(a,b,c,d,e,f,g,h){var i=[];i.push(["line",Math.round(e),Math.round(f)]),i.push(["line",Math.round(e+g),Math.round(f)]),i.push(["line",Math.round(e+g),Math.round(h+f)]),i.push(["line",Math.round(e),Math.round(h+f)]),M(a,i),a.save(),a.clip(),T(a,b,c,d),a.restore()}function V(a,b,c){k(a,b.left,b.top,b.width,b.height,c)}function W(a,b,c,d,e){var f=lb.BackgroundSize(a,b,d,e),g=lb.BackgroundPosition(a,b,d,e,f),h=pb(a,"backgroundRepeat").split(",").map(lb.trimText);switch(d=Y(d,f),h=h[e]||h[0]){case"repeat-x":U(c,d,g,b,b.left,b.top+g.top,99999,d.height);break;case"repeat-y":U(c,d,g,b,b.left+g.left,b.top,d.width,99999);break;case"no-repeat":U(c,d,g,b,b.left+g.left,b.top+g.top,d.width,d.height);break;default:T(c,d,g,{top:b.top,left:b.left,width:d.width,height:d.height})}}function X(a,b,c){for(var d,e=pb(a,"backgroundImage"),f=lb.parseBackgroundImage(e),g=f.length;g--;)if(e=f[g],e.args&&0!==e.args.length){var h="url"===e.method?e.args[0]:e.value;d=A(h),d?W(a,b,c,d,g):lb.log("html2canvas: Error loading background:",e)}}function Y(a,b){if(a.width===b.width&&a.height===b.height)return a;var c,d=kb.createElement("canvas");return d.width=b.width,d.height=b.height,c=d.getContext("2d"),P(c,a,0,0,a.width,a.height,0,0,b.width,b.height),d}function Z(a,b,c){return a.setVariable("globalAlpha",pb(b,"opacity")*(c?c.opacity:1))}function $(a){return a.replace("px","")}function _(a){var b=pb(a,"transform")||pb(a,"-webkit-transform")||pb(a,"-moz-transform")||pb(a,"-ms-transform")||pb(a,"-o-transform"),c=pb(a,"transform-origin")||pb(a,"-webkit-transform-origin")||pb(a,"-moz-transform-origin")||pb(a,"-ms-transform-origin")||pb(a,"-o-transform-origin")||"0px 0px";c=c.split(" ").map($).map(lb.asFloat);var d;if(b&&"none"!==b){var e=b.match(tb);if(e)switch(e[1]){case"matrix":d=e[2].split(",").map(lb.trimText).map(lb.asFloat)}}return{origin:c,matrix:d}}function ab(a,b,c,d){var i=h(b?c.width:f(),b?c.height:g()),j={ctx:i,opacity:Z(i,a,b),cssPosition:pb(a,"position"),borders:E(a),transform:d,clip:b&&b.clip?lb.Extend({},b.clip):null};return C(a,j,b),e.useOverflow===!0&&/(hidden|scroll|auto)/.test(pb(a,"overflow"))===!0&&/(BODY)/i.test(a.nodeName)===!1&&(j.clip=j.clip?B(j.clip,c):c),j}function bb(a,b,c){var d={left:b.left+a[3].width,top:b.top+a[0].width,width:b.width-(a[1].width+a[3].width),height:b.height-(a[0].width+a[2].width)};return c&&(d=B(d,c)),d}function cb(a,b){var c=b.matrix?lb.OffsetBounds(a):lb.Bounds(a);return b.origin[0]+=c.left,b.origin[1]+=c.top,c}function db(a,b,c,d){var e,f=_(a,b),g=cb(a,f),h=ab(a,b,g,f),i=h.borders,j=h.ctx,k=bb(i,g,h.clip),l=L(a,g,i),m=nb.test(a.nodeName)?"#efefef":pb(a,"backgroundColor");switch(M(j,l.clip),j.save(),j.clip(),k.height>0&&k.width>0&&!d?(V(j,g,m),X(a,k,j)):d&&(h.backgroundColor=m),j.restore(),l.borders.forEach(function(a){N(j,a.args,a.color)}),c||S(a,h),a.nodeName){case"IMG":(e=A(a.getAttribute("src")))?D(j,a,e,g,i):lb.log("html2canvas: Error loading <img>:"+a.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(a.type)&&(a.value||a.placeholder||"").length>0&&O(a,g,h);break;case"TEXTAREA":(a.value||a.placeholder||"").length>0&&O(a,g,h);break;case"SELECT":(a.options||a.placeholder||"").length>0&&O(a,g,h);break;case"LI":z(a,h,k);break;case"CANVAS":D(j,a,a,g,i)}return h}function eb(a){return"none"!==pb(a,"display")&&"hidden"!==pb(a,"visibility")&&!a.hasAttribute("data-html2canvas-ignore")}function fb(a,b,c){eb(a)&&(b=db(a,b,c,!1)||b,nb.test(a.nodeName)||gb(a,b,c))}function gb(a,b,c){lb.Children(a).forEach(function(d){d.nodeType===d.ELEMENT_NODE?fb(d,b,c):d.nodeType===d.TEXT_NODE&&v(a,d,b)})}function hb(){var a=pb(b.documentElement,"backgroundColor"),c=lb.isTransparent(a)&&ib===b.body,d=db(ib,null,!1,c);return gb(ib,d),c&&(a=d.backgroundColor),ob.removeChild(rb),{backgroundColor:a,stack:d}}a.scroll(0,0);var ib=e.elements===c?b.body:e.elements[0],jb=0,kb=ib.ownerDocument,lb=l.Util,mb=lb.Support(e,kb),nb=RegExp("("+e.ignoreElements+")"),ob=kb.body,pb=lb.getCSS,qb="___html2canvas___pseudoelement",rb=kb.createElement("style");rb.innerHTML="."+qb+'-before:before { content: "" !important; display: none !important; }.'+qb+'-after:after { content: "" !important; display: none !important; }',ob.appendChild(rb),d=d||{};var sb=function(a){return function(b,c,d,e){var f=d*a,g=e*a,h=b+d,i=c+e;return{topLeft:G({x:b,y:i},{x:b,y:i-g},{x:h-f,y:c},{x:h,y:c}),topRight:G({x:b,y:c},{x:b+f,y:c},{x:h,y:i-g},{x:h,y:i}),bottomRight:G({x:h,y:c},{x:h,y:c+g},{x:b+f,y:i},{x:b,y:i}),bottomLeft:G({x:h,y:i},{x:h-f,y:i},{x:b,y:c+g},{x:b,y:c})}}}(4*((Math.sqrt(2)-1)/3)),tb=/(matrix)\((.+)\)/;return hb()},l.Preload=function(d){function e(a){A.href=a,A.href=A.href;var b=A.protocol+A.host;return b===p}function f(){u.log("html2canvas: start: images: "+t.numLoaded+" / "+t.numTotal+" (failed: "+t.numFailed+")"),!t.firstRun&&t.numLoaded>=t.numTotal&&(u.log("Finished loading images: # "+t.numTotal+" (failed: "+t.numFailed+")"),"function"==typeof d.complete&&d.complete(t))}function g(b,e,g){var h,i,j=d.proxy;A.href=b,b=A.href,h="html2canvas_"+v++,g.callbackname=h,j+=j.indexOf("?")>-1?"&":"?",j+="url="+encodeURIComponent(b)+"&callback="+h,i=x.createElement("script"),a[h]=function(b){"error:"===b.substring(0,6)?(g.succeeded=!1,t.numLoaded++,t.numFailed++,f()):(o(e,g),e.src=b),a[h]=c;try{delete a[h]}catch(d){}i.parentNode.removeChild(i),i=null,delete g.script,delete g.callbackname},i.setAttribute("type","text/javascript"),i.setAttribute("src",j),g.script=i,a.document.body.appendChild(i)}function h(b,c){var d=a.getComputedStyle(b,c),e=d.content;"url"===e.substr(0,3)&&q.loadImage(l.Util.parseBackgroundImage(e)[0].args[0]),m(d.backgroundImage,b)}function i(a){h(a,":before"),h(a,":after")}function j(a,b){var d=l.Generate.Gradient(a,b);d!==c&&(t[a]={img:d,succeeded:!0},t.numTotal++,t.numLoaded++,f())}function k(a){return a&&a.method&&a.args&&a.args.length>0}function m(a,b){var d;l.Util.parseBackgroundImage(a).filter(k).forEach(function(a){"url"===a.method?q.loadImage(a.args[0]):a.method.match(/\-?gradient$/)&&(d===c&&(d=l.Util.Bounds(b)),j(a.value,d))})}function n(a){var b=!1;try{u.Children(a).forEach(n)}catch(d){}try{b=a.nodeType}catch(e){b=!1,u.log("html2canvas: failed to access some element's nodeType - Exception: "+e.message)}if(1===b||b===c){i(a);try{m(u.getCSS(a,"backgroundImage"),a)}catch(d){u.log("html2canvas: failed to get background-image - Exception: "+d.message)}m(a)}}function o(b,e){b.onload=function(){e.timer!==c&&a.clearTimeout(e.timer),t.numLoaded++,e.succeeded=!0,b.onerror=b.onload=null,f()},b.onerror=function(){if("anonymous"===b.crossOrigin&&(a.clearTimeout(e.timer),d.proxy)){var h=b.src;return b=new Image,e.img=b,b.src=h,g(b.src,b,e),c}t.numLoaded++,t.numFailed++,e.succeeded=!1,b.onerror=b.onload=null,f()}}var p,q,r,s,t={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},u=l.Util,v=0,w=d.elements[0]||b.body,x=w.ownerDocument,y=w.getElementsByTagName("img"),z=y.length,A=x.createElement("a"),B=function(a){return a.crossOrigin!==c}(new Image);for(A.href=a.location.href,p=A.protocol+A.host,q={loadImage:function(a){var b,f;a&&t[a]===c&&(b=new Image,a.match(/data:image\/.*;base64,/i)?(b.src=a.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),f=t[a]={img:b},t.numTotal++,o(b,f)):e(a)||d.allowTaint===!0?(f=t[a]={img:b},t.numTotal++,o(b,f),b.src=a):B&&!d.allowTaint&&d.useCORS?(b.crossOrigin="anonymous",f=t[a]={img:b},t.numTotal++,o(b,f),b.src=a):d.proxy&&(f=t[a]={img:b},t.numTotal++,g(a,b,f)))},cleanupDOM:function(e){var g,h;if(!t.cleanupDone){u.log(e&&"string"==typeof e?"html2canvas: Cleanup because: "+e:"html2canvas: Cleanup after timeout: "+d.timeout+" ms.");for(h in t)if(t.hasOwnProperty(h)&&(g=t[h],"object"==typeof g&&g.callbackname&&g.succeeded===c)){a[g.callbackname]=c;try{delete a[g.callbackname]}catch(i){}g.script&&g.script.parentNode&&(g.script.setAttribute("src","about:blank"),g.script.parentNode.removeChild(g.script)),t.numLoaded++,t.numFailed++,u.log("html2canvas: Cleaned up failed img: '"+h+"' Steps: "+t.numLoaded+" / "+t.numTotal)}a.stop!==c?a.stop():b.execCommand!==c&&b.execCommand("Stop",!1),b.close!==c&&b.close(),t.cleanupDone=!0,e&&"string"==typeof e||f()}},renderingDone:function(){s&&a.clearTimeout(s)}},d.timeout>0&&(s=a.setTimeout(q.cleanupDOM,d.timeout)),u.log("html2canvas: Preload starts: finding background-images"),t.firstRun=!0,n(w),u.log("html2canvas: Preload: Finding images"),r=0;z>r;r+=1)q.loadImage(y[r].getAttribute("src"));return t.firstRun=!1,u.log("html2canvas: Preload: Done."),t.numTotal===t.numLoaded&&f(),q},l.Renderer=function(a,d){function e(a){function b(a){Object.keys(a).sort().forEach(function(c){var d=[],f=[],g=[],h=[];a[c].forEach(function(a){a.node.zIndex.isPositioned||1>a.node.zIndex.opacity?g.push(a):a.node.zIndex.isFloated?f.push(a):d.push(a)}),function i(a){a.forEach(function(a){h.push(a),a.children&&i(a.children)})}(d.concat(f,g)),h.forEach(function(a){a.context?b(a.context):e.push(a.node)})})}var d,e=[];return d=function(a){function b(a,d,e){var f="auto"===d.zIndex.zindex?0:Number(d.zIndex.zindex),g=a,h=d.zIndex.isPositioned,i=d.zIndex.isFloated,j={node:d},k=e;d.zIndex.ownStacking?(g=j.context={"!":[{node:d,children:[]}]},k=c):(h||i)&&(k=j.children=[]),0===f&&e?e.push(j):(a[f]||(a[f]=[]),a[f].push(j)),d.zIndex.children.forEach(function(a){b(g,a,k)})}var d={};return b(d,a),d}(a),b(d),e}function f(a){var b;if("string"==typeof d.renderer&&l.Renderer[a]!==c)b=l.Renderer[a](d);else{if("function"!=typeof a)throw Error("Unknown renderer");b=a(d)}if("function"!=typeof b)throw Error("Invalid renderer defined");return b}return f(d.renderer)(a,d,b,e(a.stack),l)},l.Util.Support=function(a,b){function d(){var a=new Image,d=b.createElement("canvas"),e=d.getContext===c?!1:d.getContext("2d");if(e===!1)return!1;d.width=d.height=10,a.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{e.drawImage(a,0,0),d.toDataURL()}catch(f){return!1}return l.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}function e(){var a,c,d,e,f=!1;return b.createRange&&(a=b.createRange(),a.getBoundingClientRect&&(c=b.createElement("boundtest"),c.style.height="123px",c.style.display="block",b.body.appendChild(c),a.selectNode(c),d=a.getBoundingClientRect(),e=d.height,123===e&&(f=!0),b.body.removeChild(c))),f}return{rangeBounds:e(),svgRendering:a.svgRendering&&d()}},a.html2canvas=function(b,c){b=b.length?b:[b];var d,e,f={logging:!1,elements:b,background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"};return f=l.Util.Extend(c,f),l.logging=f.logging,f.complete=function(a){("function"!=typeof f.onpreloaded||f.onpreloaded(a)!==!1)&&(d=l.Parse(a,f),("function"!=typeof f.onparsed||f.onparsed(d)!==!1)&&(e=l.Renderer(d,f),"function"==typeof f.onrendered&&f.onrendered(e)))},a.setTimeout(function(){l.Preload(f)},0),{render:function(a,b){return l.Renderer(a,l.Util.Extend(b,f))},parse:function(a,b){return l.Parse(a,l.Util.Extend(b,f))},preload:function(a){return l.Preload(l.Util.Extend(a,f))},log:l.Util.log}},a.html2canvas.log=l.Util.log,a.html2canvas.Renderer={Canvas:c},l.Renderer.Canvas=function(a){function d(a,b){a.beginPath(),b.forEach(function(b){a[b.name].apply(a,b.arguments)}),a.closePath()}function e(a){if(-1===h.indexOf(a.arguments[0].src)){j.drawImage(a.arguments[0],0,0);try{j.getImageData(0,0,1,1)}catch(b){return i=g.createElement("canvas"),j=i.getContext("2d"),!1}h.push(a.arguments[0].src)}return!0}function f(b,c){switch(c.type){case"variable":b[c.name]=c.arguments;break;case"function":switch(c.name){case"createPattern":if(c.arguments[0].width>0&&c.arguments[0].height>0)try{b.fillStyle=b.createPattern(c.arguments[0],"repeat")}catch(f){k.log("html2canvas: Renderer: Error creating pattern",f.message)}break;case"drawShape":d(b,c.arguments);break;case"drawImage":c.arguments[8]>0&&c.arguments[7]>0&&(!a.taintTest||a.taintTest&&e(c))&&b.drawImage.apply(b,c.arguments);break;default:b[c.name].apply(b,c.arguments)}}}a=a||{};var g=b,h=[],i=b.createElement("canvas"),j=i.getContext("2d"),k=l.Util,m=a.canvas||g.createElement("canvas");return function(a,b,d,e,g){var h,i,j,l=m.getContext("2d"),n=a.stack;return m.width=m.style.width=b.width||n.ctx.width,m.height=m.style.height=b.height||n.ctx.height,j=l.fillStyle,l.fillStyle=k.isTransparent(n.backgroundColor)&&b.background!==c?b.background:a.backgroundColor,l.fillRect(0,0,m.width,m.height),l.fillStyle=j,e.forEach(function(a){l.textBaseline="bottom",l.save(),a.transform.matrix&&(l.translate(a.transform.origin[0],a.transform.origin[1]),l.transform.apply(l,a.transform.matrix),l.translate(-a.transform.origin[0],-a.transform.origin[1])),a.clip&&(l.beginPath(),l.rect(a.clip.left,a.clip.top,a.clip.width,a.clip.height),l.clip()),a.ctx.storage&&a.ctx.storage.forEach(function(a){f(l,a)}),l.restore()}),k.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===b.elements.length&&"object"==typeof b.elements[0]&&"BODY"!==b.elements[0].nodeName?(i=g.Util.Bounds(b.elements[0]),h=d.createElement("canvas"),h.width=Math.ceil(i.width),h.height=Math.ceil(i.height),l=h.getContext("2d"),l.drawImage(m,i.left,i.top,i.width,i.height,0,0,i.width,i.height),m=null,h):m}}})(window,document),function(a,b,c){"use strict";function d(c,d){this.el=c,this.$el=a(c),this.options=a.extend({},g,d),this.$document=a(this.$el[0].ownerDocument),this.$window=a(b),this._defaults=g,this._name="Pep",this.moveTrigger=this.isTouch()?"touchmove":"mousemove",this.startTrigger=this.isTouch()?"touchstart":"mousedown",this.stopTrigger=this.isTouch()?"touchend":"mouseup",this.stopEvents=[this.stopTrigger,this.options.stopEvents].join(" "),this.$container=this.options.constrainTo&&"parent"===this.options.constrainTo?this.$el.parent():this.$document,this.CSSEaseHash=this.getCSSEaseHash(),this.scale=1,this.disabled=!1,this.resetVelocityQueue(),this.init()}var e="pep",f=b.document,g={debug:!1,activeClass:"pep-active",multiplier:1,velocityMultiplier:1.9,shouldPreventDefault:!0,stopEvents:"",hardwareAccelerate:!0,useCSSTranslation:!0,disableSelect:!0,cssEaseString:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",cssEaseDuration:750,shouldEase:!0,droppable:!1,droppableActiveClass:"pep-dpa",overlapFunction:!1,constrainTo:!1,removeMargins:!0,axis:null,forceNonCSS3Movement:!1,drag:function(){},start:function(){},stop:function(){},rest:function(){}};d.prototype.init=function(){this.options.debug&&this.buildDebugDiv(),this.options.disableSelect&&this.disableSelect(),this.positionParent(),this.placeObject(),this.ev={},this.pos={},this.subscribe()},d.prototype.subscribe=function(){var a=this;this.$el.bind(this.startTrigger,function(b){a.handleStart(b)}),this.$document.bind(this.stopEvents,function(b){a.handleStop(b)}),this.$document.bind(this.moveTrigger,function(b){a.moveEvent=b})},d.prototype.handleStart=function(b){var c=this;this.isValidMoveEvent(b)&&!this.disabled&&(this.log({type:"event",event:b.type}),this.options.hardwareAccelerate&&!this.hardwareAccelerated&&(this.hardwareAccelerate(),this.hardwareAccelerated=!0),this.options.start(b,this),clearTimeout(this.restTimeout),this.$el.addClass(this.options.activeClass),this.removeCSSEasing(),this.ev.x=this.isTouch()?b.originalEvent.pageX:b.pageX,this.ev.y=this.isTouch()?b.originalEvent.pageY:b.pageY,this.moveEvent=b,this.active=!0,this.options.shouldPreventDefault&&b.preventDefault(),function d(){c.active&&(c.handleMove(),c.requestAnimationFrame(d))}(a,c))},d.prototype.handleMove=function(){var a=this.moveEvent;if("undefined"!=typeof a){var b=this.isTouch()?a.originalEvent.touches[0].pageX:a.pageX,c=this.isTouch()?a.originalEvent.touches[0].pageY:a.pageY;this.addToLIFO({time:a.timeStamp,x:b,y:c});var d,e;if(a.type===this.startTrigger?(d=0,e=0):(d=b-this.ev.x,e=c-this.ev.y),this.dx=d,this.dy=e,this.ev.x=b,this.ev.y=c,0===d&&0===e)return void this.log({type:"event",event:"** stopped **"});this.options.droppable&&this.calculateActiveDropRegions();var f=this.options.drag(a,this);if(f===!1)return void this.resetVelocityQueue();this.log({type:"event",event:a.type}),this.log({type:"event-coords",x:this.ev.x,y:this.ev.y}),this.log({type:"velocity"});var g=this.handleConstraint(d,e);if(this.shouldUseCSSTranslation())d=d/this.scale*this.options.multiplier,e=e/this.scale*this.options.multiplier,this.options.constrainTo&&(d=g.x===!1?d:0,e=g.y===!1?e:0),this.moveToUsingTransforms(d,e);else{var h=d>=0?"+="+Math.abs(d/this.scale)*this.options.multiplier:"-="+Math.abs(d/this.scale)*this.options.multiplier,i=e>=0?"+="+Math.abs(e/this.scale)*this.options.multiplier:"-="+Math.abs(e/this.scale)*this.options.multiplier;this.options.constrainTo&&(h=g.x!==!1?g.x:h,i=g.y!==!1?g.y:i),this.moveTo(h,i)}}},d.prototype.handleStop=function(a){this.active&&(this.log({type:"event",event:a.type}),this.active=!1,this.options.droppable&&this.calculateActiveDropRegions(),this.options.shouldEase&&this.ease(a),this.options.stop(a,this),this.resetVelocityQueue())},d.prototype.resetVelocityQueue=function(){this.velocityQueue=new Array(5)},d.prototype.moveTo=function(a,b,c){c=c===!1||"undefined"==typeof c?!1:!0,"x"===this.options.axis?b="+=0":"y"===this.options.axis&&(a="+=0");var d=300;this.log({type:"delta",x:a,y:b}),c?this.$el.animate({top:b,left:a},d,"easeOutCirc",{queue:!1}):this.$el.stop(!0,!1).css({top:b,left:a})},d.prototype.moveToUsingTransforms=function(a,b){"x"===this.options.axis?b=0:"y"===this.options.axis&&(a=0),this.cssX=this.cssX?this.cssX+a:a,this.cssY=this.cssY?this.cssY+b:b,this.log({type:"delta",x:a,y:b}),this.translation="translate("+this.cssX+"px, "+this.cssY+"px)",this.$el.css({"-webkit-transform":this.translation,"-moz-transform":this.translation,"-ms-transform":this.translation,"-o-transform":this.translation,transform:this.translation})},d.prototype.addToLIFO=function(a){var b=this.velocityQueue;b=b.slice(1,b.length),b.push(a),this.velocityQueue=b},d.prototype.ease=function(a){var b=(this.$el.position(),this.velocity()),c=(this.dt,b.x/this.scale*this.options.multiplier),d=b.y/this.scale*this.options.multiplier,e=this.handleConstraint(c,d);this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash());var f=b.x>0?"+="+c:"-="+Math.abs(c),g=b.y>0?"+="+d:"-="+Math.abs(d);this.options.constrainTo&&(f=e.x!==!1?e.x:f,g=e.y!==!1?e.y:g);var h=!this.cssAnimationsSupported()||this.options.forceNonCSS3Movement;this.moveTo(f,g,h);var i=this;this.restTimeout=setTimeout(function(){i.options.droppable&&i.calculateActiveDropRegions(),i.options.rest(a,i),i.$el.removeClass(i.options.activeClass)},this.options.cssEaseDuration)},d.prototype.velocity=function(){for(var a=0,b=0,c=0;c<this.velocityQueue.length-1;c++)this.velocityQueue[c]&&(a+=this.velocityQueue[c+1].x-this.velocityQueue[c].x,b+=this.velocityQueue[c+1].y-this.velocityQueue[c].y,this.dt=this.velocityQueue[c+1].time-this.velocityQueue[c].time);return{x:a*this.options.velocityMultiplier,y:b*this.options.velocityMultiplier}},d.prototype.requestAnimationFrame=function(a){return b.requestAnimationFrame&&b.requestAnimationFrame(a)||b.webkitRequestAnimationFrame&&b.webkitRequestAnimationFrame(a)||b.mozRequestAnimationFrame&&b.mozRequestAnimationFrame(a)||b.oRequestAnimationFrame&&b.mozRequestAnimationFrame(a)||b.msRequestAnimationFrame&&b.msRequestAnimationFrame(a)||b.setTimeout(a,1e3/60)},d.prototype.positionParent=function(){this.options.constrainTo&&!this.parentPositioned&&(this.parentPositioned=!0,this.$container.css("parent"===this.options.constrainTo?{position:"relative"}:{position:"static"}))},d.prototype.placeObject=function(){this.objectPlaced||(this.objectPlaced=!0,this.offset="parent"===this.options.constrainTo||this.hasNonBodyRelative()?this.$el.position():this.$el.offset(),this.options.removeMargins&&this.$el.css({margin:0}),this.$el.css({position:"absolute",top:this.offset.top,left:this.offset.left}))},d.prototype.hasNonBodyRelative=function(){return this.$el.parents().filter(function(){var b=a(this);return b.is("body")||"relative"===b.css("position")}).length>1},d.prototype.setScale=function(a){this.scale=a},d.prototype.setMultiplier=function(a){this.options.multiplier=a},d.prototype.removeCSSEasing=function(){this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash(!0))},d.prototype.disableSelect=function(){this.$el.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})},d.prototype.handleConstraint=function(a,b){var c=this.$el.position();this.pos.x=c.left,this.pos.y=c.top,this.log({type:"pos-coords",x:this.pos.x,y:this.pos.y});var d=this.$container.width()-this.$el.outerWidth(),e=this.$container.height()-this.$el.outerHeight(),f={x:!1,y:!1};return this.pos.x+a>d&&(f.x=d),this.pos.x+a<0&&(f.x=0),this.pos.y+b>e&&(f.y=e),this.pos.y+b<0&&(f.y=0),f},d.prototype.getCSSEaseHash=function(a){"undefined"==typeof a&&(a=!1);var b;if(a)b="";else{if(this.CSSEaseHash)return this.CSSEaseHash;b=["all",this.options.cssEaseDuration+"ms",this.options.cssEaseString].join(" ")}return{"-webkit-transition":b,"-moz-transition":b,"-ms-transition":b,"-o-transition":b,transition:b}},d.prototype.calculateActiveDropRegions=function(){var b=this;this.activeDropRegions=[],a.each(a(this.options.droppable),function(c,d){var e=a(d);b.isOverlapping(e,b.$el)?(e.addClass(b.options.droppableActiveClass),b.activeDropRegions.push(e)):e.removeClass(b.options.droppableActiveClass)})},d.prototype.isOverlapping=function(a,b){if(this.options.overlapFunction)return this.options.overlapFunction(a,b);var c=a[0].getBoundingClientRect(),d=b[0].getBoundingClientRect();return!(c.right<d.left||c.left>d.right||c.bottom<d.top||c.top>d.bottom)},d.prototype.isTouch=function(){return"undefined"!=typeof Modernizr?Modernizr.touch:"ontouchstart"in b||b.DocumentTouch&&f instanceof DocumentTouch?!0:!1},d.prototype.isValidMoveEvent=function(a){return!this.isTouch()||this.isTouch()&&a.originalEvent.hasOwnProperty("touches")&&1===a.originalEvent.touches.length?!0:!1},d.prototype.shouldUseCSSTranslation=function(){if("undefined"!=typeof this.useCSSTranslation)return this.useCSSTranslation;var a=!1;return a=!this.options.useCSSTranslation||"undefined"!=typeof Modernizr&&!Modernizr.csstransforms?!1:!0,this.useCSSTranslation=a,a},d.prototype.cssAnimationsSupported=function(){if("undefined"!=typeof this.cssAnimationsSupport)return this.cssAnimationsSupport;if("undefined"!=typeof Modernizr&&Modernizr.cssanimations)return this.cssAnimationsSupport=!0,!0;var a=!1,b=f.createElement("div"),d="animation",e="",g="Webkit Moz O ms Khtml".split(" "),h="";if(b.style.animationName&&(a=!0),a===!1)for(var i=0;i<g.length;i++)if(b.style[g[i]+"AnimationName"]!==c){h=g[i],d=h+"Animation",e="-"+h.toLowerCase()+"-",a=!0;break}return this.cssAnimationsSupport=a,a},d.prototype.hardwareAccelerate=function(){this.$el.css({"-webkit-transform":"translateZ(0)",transform:"translateZ(0)","-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})},d.prototype.getMovementValues=function(){return{ev:this.ev,pos:this.pos,velocity:this.velocity()}},d.prototype.buildDebugDiv=function(){var b;0===a("#pep-debug").length&&(b=a("<div></div>"),b.attr("id","pep-debug").append("<div style='font-weight:bold; background: red; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({position:"fixed",bottom:5,right:5,zIndex:99999,textAlign:"right",fontFamily:"Arial, sans",fontSize:10,border:"1px solid #DDD",padding:"3px",background:"white",color:"#333"}));var c=this;setTimeout(function(){c.debugElements={$event:a("#pep-debug-event"),$velocityX:a("#pep-debug-velocity .pep-x"),$velocityY:a("#pep-debug-velocity .pep-y"),$dX:a("#pep-debug-delta .pep-x"),$dY:a("#pep-debug-delta .pep-y"),$evCoordsX:a("#pep-debug-ev-coords .pep-x"),$evCoordsY:a("#pep-debug-ev-coords .pep-y"),$posCoordsX:a("#pep-debug-pos-coords .pep-x"),$posCoordsY:a("#pep-debug-pos-coords .pep-y")}},0),a("body").append(b)},d.prototype.log=function(a){if(this.options.debug)switch(a.type){case"event":this.debugElements.$event.text(a.event);break;case"pos-coords":this.debugElements.$posCoordsX.text(a.x),this.debugElements.$posCoordsY.text(a.y);break;case"event-coords":this.debugElements.$evCoordsX.text(a.x),this.debugElements.$evCoordsY.text(a.y);break;case"delta":this.debugElements.$dX.text(a.x),this.debugElements.$dY.text(a.y);break;case"velocity":var b=this.velocity();this.debugElements.$velocityX.text(Math.round(b.x)),this.debugElements.$velocityY.text(Math.round(b.y))}},d.prototype.toggle=function(a){this.disabled="undefined"==typeof a?!this.disabled:!a},a.fn[e]=function(b){return this.each(function(){if(!a.data(this,"plugin_"+e)){var c=new d(this,b);a.data(this,"plugin_"+e,c),a.pep.peps.push(c)}})},a.pep={},a.pep.peps=[],a.pep.toggleAll=function(b){a.each(this.peps,function(a,c){c.toggle(b)})}}(jQuery,window);